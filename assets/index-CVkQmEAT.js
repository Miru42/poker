(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */console.log("Poker Script v1.2.3 Loaded - Impossible AI with Future Sight.");const ya=["♠","♥","♣","♦"],Tn=[{rank:"2",value:2},{rank:"3",value:3},{rank:"4",value:4},{rank:"5",value:5},{rank:"6",value:6},{rank:"7",value:7},{rank:"8",value:8},{rank:"9",value:9},{rank:"10",value:10},{rank:"J",value:11},{rank:"Q",value:12},{rank:"K",value:13},{rank:"A",value:14}],Dn=[{kor:"로열 플러시",eng:"Royal Flush",desc:"A, K, Q, J, 10 (모두 같은 무늬)",exampleCards:[{suit:"♥",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♥",rank:"Q",value:12},{suit:"♥",rank:"J",value:11},{suit:"♥",rank:"10",value:10}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트 플러시",eng:"Straight Flush",desc:"연속된 숫자 5장 (모두 같은 무늬, 로열 플러시 제외)",exampleCards:[{suit:"♠",rank:"9",value:9},{suit:"♠",rank:"8",value:8},{suit:"♠",rank:"7",value:7},{suit:"♠",rank:"6",value:6},{suit:"♠",rank:"5",value:5}],highlightIndices:[0,1,2,3,4]},{kor:"포 카드",eng:"Four of a Kind",desc:"같은 숫자 4장 + 아무 카드 1장",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"A",value:14},{suit:"♣",rank:"A",value:14},{suit:"♠",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"풀 하우스",eng:"Full House",desc:"같은 숫자 3장 + 같은 숫자 2장 (트리플 + 원 페어)",exampleCards:[{suit:"♥",rank:"K",value:13},{suit:"♠",rank:"K",value:13},{suit:"♦",rank:"K",value:13},{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12}],highlightIndices:[0,1,2,3,4]},{kor:"플러시",eng:"Flush",desc:"무늬가 같은 카드 5장 (숫자는 연속되지 않음)",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♦",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♦",rank:"5",value:5},{suit:"♦",rank:"2",value:2}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트",eng:"Straight",desc:"연속된 숫자 5장 (무늬는 달라도 됨)",exampleCards:[{suit:"♠",rank:"10",value:10},{suit:"♥",rank:"9",value:9},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"7",value:7},{suit:"♥",rank:"6",value:6}],highlightIndices:[0,1,2,3,4]},{kor:"트리플",eng:"Three of a Kind",desc:"같은 숫자 3장 + 서로 다른 숫자 2장",exampleCards:[{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12},{suit:"♠",rank:"Q",value:12},{suit:"♦",rank:"A",value:14},{suit:"♣",rank:"K",value:13}],highlightIndices:[0,1,2]},{kor:"투 페어",eng:"Two Pair",desc:"같은 숫자 2장 + 같은 숫자 2장 + 아무 카드 1장",exampleCards:[{suit:"♥",rank:"J",value:11},{suit:"♠",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"8",value:8},{suit:"♥",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"원 페어",eng:"One Pair",desc:"같은 숫자 2장 + 서로 다른 숫자 3장",exampleCards:[{suit:"♥",rank:"10",value:10},{suit:"♠",rank:"10",value:10},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♥",rank:"9",value:9}],highlightIndices:[0,1]},{kor:"하이 카드",eng:"High Card",desc:"위 족보에 해당하지 않는 경우, 가장 높은 숫자의 카드로 결정",exampleCards:[{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♣",rank:"9",value:9}],highlightIndices:[0]}],Qt=10,be=20;let at=Qt,Y=be,te=[],F=[],D=null,s=null,c=null,j=0,ne=null,re=1,me="ai",V="pre_deal",M=null,v=0,U=be,L=!1,se=null,Nn=1e3;const Hn=document.getElementById("game-board"),dn=document.getElementById("player-hole-cards"),cn=document.getElementById("community-cards"),m=document.getElementById("message-area"),un=document.getElementById("player-coins-display"),hn=document.getElementById("player-action-display"),Ia=document.getElementById("dealer-chip-player"),Xe=document.getElementById("ai-player-area"),fn=document.getElementById("ai-name"),mn=document.getElementById("ai-coins-display"),pn=document.getElementById("ai-action-display"),Aa=document.getElementById("dealer-chip-ai"),yn=document.getElementById("ai-hole-cards"),ga=document.getElementById("pot-amount"),pe=document.getElementById("marathonLevelDisplay"),ka=document.getElementById("player-action-animation"),Ca=document.getElementById("ai-action-animation"),X=document.getElementById("setup-game-button"),Ye=document.getElementById("practice-mode-actions"),gt=document.getElementById("deal-new-hand-practice-button"),kt=document.getElementById("deal-flop-button"),Ct=document.getElementById("deal-turn-button"),Bt=document.getElementById("deal-river-button"),bt=document.getElementById("deal-fifth-street-button"),vt=document.getElementById("evaluate-button"),Ze=document.getElementById("player-betting-actions"),$t=document.getElementById("foldButton"),Rt=document.getElementById("checkButton"),Se=document.getElementById("callButton"),Ae=document.getElementById("confirmBetButton"),Ee=document.getElementById("startNextHandButton"),Ce=document.getElementById("betPercentageSlider"),In=document.getElementById("betPercentageValue"),pt=document.getElementById("calculatedBetAmountDisplay"),xt=document.getElementById("allInButton"),_n=document.getElementById("show-rankings-button"),ot=document.getElementById("rankings-modal"),Pn=ot.querySelector(".close-button"),An=document.getElementById("hand-rankings-list"),Jt=document.getElementById("game-setup-modal"),Ba=document.getElementById("close-setup-modal-button"),Et=document.getElementById("gameModePractice"),Wt=document.getElementById("gameModeSoloAI"),wt=document.getElementById("solo-ai-options"),Vn=document.getElementById("startingCoinsSelect"),Kn=document.getElementById("aiDifficultySelect"),ba=document.getElementById("start-configured-game-button");let _e=null,Pe=null;function ve(t,e){const a=t==="human"?ka:Ca;if(!a)return;t==="human"&&_e?clearTimeout(_e):t==="ai"&&Pe&&clearTimeout(Pe),a.textContent=e,a.classList.remove("show"),a.offsetWidth,a.classList.add("show");const l=window.setTimeout(()=>{a.classList.remove("show"),t==="human"&&_e===l?_e=null:t==="ai"&&Pe===l&&(Pe=null)},1800);t==="human"?_e=l:Pe=l}function Gn(){const t=[];for(const e of ya)for(const a of Tn)t.push({suit:e,rank:a.rank,value:a.value});return t}function On(t){const e=[...t];for(let a=e.length-1;a>0;a--){const l=Math.floor(Math.random()*(a+1));[e[a],e[l]]=[e[l],e[a]]}return e}function Me(t){return te.length<t?(m.textContent="덱에 카드가 부족합니다!",console.error("Deck depleted. Requested:",t,"Available:",te.length),te.splice(0,te.length)):te.splice(0,t)}function rt(t,e=!1,a=!1,l=!1){const o=document.createElement("div");o.classList.add("card"),e&&o.classList.add("example-card"),a&&o.classList.add("highlighted-card-component"),l?(o.classList.add("face-down"),o.setAttribute("aria-label","숨겨진 카드")):(t.suit==="♥"?o.classList.add("hearts"):t.suit==="♦"?o.classList.add("diamonds"):t.suit==="♣"?o.classList.add("clubs"):t.suit==="♠"&&o.classList.add("spades"),o.setAttribute("aria-label",`${t.rank==="10"?"10":oe(t.value)} ${va(t.suit)}`));const r=document.createElement("span");r.classList.add("rank"),r.textContent=t.rank;const d=document.createElement("span");return d.classList.add("suit"),d.textContent=t.suit,o.appendChild(r),o.appendChild(d),o.setAttribute("role","img"),o}function va(t){switch(t){case"♠":return"스페이드";case"♥":return"하트";case"♣":return"클럽";case"♦":return"다이아몬드";default:return""}}function Qn(){dn.innerHTML="",s&&s.holeCards&&s.holeCards.forEach(t=>{dn.appendChild(rt(t))})}function Ut(t=!1){yn.innerHTML="",c&&c.holeCards&&c.holeCards.forEach(e=>{yn.appendChild(rt(e,!1,!1,!t&&!c.isAllIn))})}function it(){cn.innerHTML="",F.forEach(t=>{cn.appendChild(rt(t))})}function $a(){ga.textContent=String(j)}function qt(){s?(un.textContent=`코인: ${s.coins}`,hn.textContent=s.lastAction&&s.lastAction!=="none"?`(${We(s.lastAction)}${s.currentBetInRound>0&&s.lastAction!=="blind"?" "+s.currentBetInRound:""})`:""):(un.textContent="코인: 0",hn.textContent=""),c?(fn.textContent=ne==="marathon"?`AI 상대 (레벨 ${re})`:"AI 상대 (불가능)",mn.textContent=`코인: ${c.coins}`,pn.textContent=c.lastAction&&c.lastAction!=="none"?`(${We(c.lastAction)}${c.currentBetInRound>0&&c.lastAction!=="blind"?" "+c.currentBetInRound:""})`:"",pe.textContent=ne==="marathon"?`레벨: ${re}`:"",pe.style.display=ne==="marathon"&&D==="solo_ai"?"inline":"none"):(fn.textContent="AI 상대",mn.textContent="코인: 0",pn.textContent="",pe.style.display="none"),$a(),Ra()}function Ra(){Ia.style.display=D==="solo_ai"&&me==="human"?"flex":"none",Aa.style.display=D==="solo_ai"&&me==="ai"?"flex":"none"}function oe(t){const e=Tn.find(a=>a.value===t);return e?e.rank==="A"?"에이스":e.rank==="K"?"킹":e.rank==="Q"?"퀸":e.rank==="J"?"잭":e.rank:String(t)}function Ge(t){const e=Dn.find(a=>a.eng===t);return e?e.kor:t}function We(t){switch(t){case"fold":return"폴드";case"check":return"체크";case"call":return"콜";case"bet":return"벳";case"raise":return"레이즈";case"blind":return"블라인드";default:return""}}function xa(t){if(t.length!==5)throw new Error("패는 반드시 5장의 카드로 구성되어야 합니다.");const e=[...t].sort((u,h)=>u.value-h.value),a=e.map(u=>u.value),l=e.map(u=>u.suit),o={};a.forEach(u=>o[u]=(o[u]||0)+1);const r=Object.values(o).sort((u,h)=>h-u),d=Object.keys(o).map(Number).sort((u,h)=>h-u),R=new Set(l).size===1;let A=!1,k=0;const p=[...new Set(a)].sort((u,h)=>u-h);if(p.length>=5){for(let u=p.length-1;u>=4;u--)if(p[u]-p[u-4]===4){A=!0,k=p[u];break}}!A&&p.includes(14)&&p.includes(2)&&p.includes(3)&&p.includes(4)&&p.includes(5)&&(A=!0,k=5);let g=e;if(A&&k===5){const u=e.find(y=>y.value===14),h=e.filter(y=>y.value!==14).sort((y,B)=>y.value-B.value);g=[u,...h.filter(y=>y.value<=5)]}if(A&&R){const u=k;return u===14?{name:"Royal Flush",rankValue:10,detailedName:"로열 플러시",bestHandCards:g}:{name:"Straight Flush",rankValue:9,detailedName:`${oe(u)}-high 스트레이트 플러시`,bestHandCards:g}}if(r[0]===4)return{name:"Four of a Kind",rankValue:8,detailedName:`포 카드, ${oe(d.find(h=>o[h]===4))}s`,bestHandCards:e};if(r[0]===3&&r[1]===2){const u=oe(d.find(y=>o[y]===3)),h=oe(d.find(y=>o[y]===2));return{name:"Full House",rankValue:7,detailedName:`풀 하우스, ${u}s over ${h}s`,bestHandCards:e}}if(R)return{name:"Flush",rankValue:6,detailedName:`${oe(e[e.length-1].value)}-high 플러시`,bestHandCards:e};if(A)return{name:"Straight",rankValue:5,detailedName:`${oe(k)}-high 스트레이트`,bestHandCards:g};if(r[0]===3)return{name:"Three of a Kind",rankValue:4,detailedName:`트리플, ${oe(d.find(h=>o[h]===3))}s`,bestHandCards:e};if(r[0]===2&&r[1]===2){const u=oe(d.filter(y=>o[y]===2).sort((y,B)=>B-y)[0]),h=oe(d.filter(y=>o[y]===2).sort((y,B)=>B-y)[1]);return{name:"Two Pair",rankValue:3,detailedName:`투 페어, ${u}s and ${h}s`,bestHandCards:e}}return r[0]===2?{name:"One Pair",rankValue:2,detailedName:`원 페어, ${oe(d.find(h=>o[h]===2))}s`,bestHandCards:e}:{name:"High Card",rankValue:1,detailedName:`하이 카드, ${oe(e[e.length-1].value)}`,bestHandCards:e}}function st(t,e){if(e===0)return[[]];if(e>t.length)return[];if(e===t.length)return[t];const[a,...l]=t,o=st(l,e);return[...st(l,e-1).map(d=>[a,...d]),...o]}function Oe(t,e){if(t.rankValue>e.rankValue)return t;if(e.rankValue>t.rankValue)return e;if(!t.bestHandCards||!e.bestHandCards)return t.rankValue>=e.rankValue?t:e;const a=r=>{if(!r.bestHandCards)return 0;const d=r.bestHandCards.map(R=>R.value).sort((R,A)=>A-R);return(r.name==="Straight"||r.name==="Straight Flush")&&d.includes(14)&&d.includes(5)&&d.includes(4)&&d.includes(3)&&d.includes(2)?5:d[0]};if((t.name==="Straight"||t.name==="Straight Flush")&&(e.name==="Straight"||e.name==="Straight Flush")){const r=a(t),d=a(e);return r>d?t:d>r?e:t}const l=t.bestHandCards.map(r=>r.value).sort((r,d)=>d-r),o=e.bestHandCards.map(r=>r.value).sort((r,d)=>d-r);for(let r=0;r<Math.min(l.length,o.length);r++){if(l[r]>o[r])return t;if(o[r]>l[r])return e}return t}function De(t,e){const a=[...t,...e];if(a.length<5)return{name:"카드가 부족합니다",rankValue:0,detailedName:"패를 확인하려면 최소 5장의 카드가 필요합니다."};const l=st(a,5);let o=null;for(const r of l){const d=xa(r);o?o=Oe(o,d):o=d}return o||{name:"오류",rankValue:0,detailedName:"패를 평가할 수 없습니다."}}function Jn(t=!0){t&&(Hn.style.display="none",Xe.style.display="none",D=null,s=null,c=null,ne=null,L=!1,m.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.',at=Qt,Y=be,re=1,pe.style.display="none"),s&&(s.holeCards=[],s.currentBetInRound=0,s.isFolded=!1,s.isAllIn=!1,s.lastAction="none",s.hasActedThisRound=!1),c&&(c.holeCards=[],c.currentBetInRound=0,c.isFolded=!1,c.isAllIn=!1,c.lastAction="none",c.hasActedThisRound=!1),F=[],j=0,v=0,U=D==="solo_ai"?Y:be,M=null,V="pre_deal",se=null,Qn(),Ut(),it(),qt(),X.disabled=!1,X.style.display="inline-block",Ye.style.display="none",Ze.style.display="none",Ee.style.display="none"}function Q(){D==="practice"?(Ye.style.display="flex",Ze.style.display="none",Ee.style.display="none",Xe.style.display="none",pe.style.display="none",gt.style.display=s?"inline-block":"none",kt.style.display=s&&s.holeCards.length>0&&F.length===0?"inline-block":"none",Ct.style.display=F.length===2?"inline-block":"none",Bt.style.display=F.length===3?"inline-block":"none",bt.style.display=F.length===4?"inline-block":"none",vt.style.display=F.length===5?"inline-block":"none",gt.disabled=L&&s&&s.holeCards.length>0,kt.disabled=!(s&&s.holeCards.length>0&&F.length===0),Ct.disabled=F.length!==2,Bt.disabled=F.length!==3,bt.disabled=F.length!==4,vt.disabled=F.length!==5):D==="solo_ai"?(Ye.style.display="none",Ze.style.display=L&&M==="human"?"flex":"none",Ee.style.display=!L&&s&&c&&s.coins>0&&c.coins>0?"inline-block":"none",Xe.style.display="block",ne==="marathon"?(pe.style.display="inline",pe.textContent=`레벨: ${re}`):pe.style.display="none",L&&M==="human"&&Un()):(Ye.style.display="none",Ze.style.display="none",Ee.style.display="none",Xe.style.display="none",pe.style.display="none"),qt(),Qn(),Ut(),it(),!L&&s&&c&&(s.coins===0||c.coins===0)&&(ne==="marathon"&&c.coins===0&&s.coins>0&&re<=10||(s.coins===0&&c.coins===0?m.textContent="무승부! 양쪽 플레이어 모두 코인이 없습니다.":s.coins===0?m.textContent="AI 승리! 당신의 코인이 모두 소진되었습니다.":c.coins===0&&(m.textContent="당신 승리! AI의 코인이 모두 소진되었습니다."),X.disabled=!1,X.style.display="inline-block",Ee.style.display="none"))}function Mt(){if(!s||D!=="solo_ai"||M!=="human"||!L){Ce.disabled=!0,In.textContent="-",pt.textContent="(금액: -)";return}Ce.disabled=s.isAllIn;const t=parseInt(Ce.value);if(In.textContent=`${t}%`,s.coins>0){const e=Math.min(s.coins,Math.max(1,Math.floor(s.coins*(t/100))));pt.textContent=`(금액: ${e})`}else pt.textContent="(금액: 0)"}function Wn(){if(!s||D==="solo_ai"&&!c){m.textContent="플레이어 정보가 없습니다. 게임을 먼저 설정하세요.";return}if(ne==="marathon"&&re>10){m.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.',L=!1,Ee.style.display="none",X.disabled=!1,X.style.display="inline-block",Q();return}if(s.coins===0||c&&c.coins===0&&!(ne==="marathon"&&re<=10)){m.textContent="게임 종료. 한 플레이어의 코인이 없습니다. '새 게임 설정'으로 다시 시작하세요.",Q();return}if(L=!0,te=Gn(),te=On(te),s.holeCards=[],s.currentBetInRound=0,s.isFolded=!1,s.isAllIn=!1,s.lastAction="none",s.hasActedThisRound=!1,c&&(c.holeCards=[],c.currentBetInRound=0,c.isFolded=!1,c.isAllIn=!1,c.lastAction="none",c.hasActedThisRound=!1),F=[],j=0,se=null,D==="solo_ai"?(me=me==="human"?"ai":"human",U=Y):U=be,s.holeCards=Me(2),c&&(c.holeCards=Me(2)),D==="solo_ai"&&c){V="preflop";const t=me==="human"?s:c,e=me==="human"?c:s;gn(t,at),gn(e,Y),v=Y,se=e.seat,M=me==="human"?"human":"ai"}else D==="practice"&&(m.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",V="pre_deal");if(Q(),X.disabled=!0,X.style.display="none",D==="solo_ai"&&M==="ai"&&c&&!c.isFolded&&!c.isAllIn&&L){const t=`AI의 턴입니다. (${V==="preflop"?"프리플랍":"플랍 전"})`;m.textContent=t,setTimeout(Fe,1200)}else D==="solo_ai"&&M==="human"&&s&&!s.isFolded&&!s.isAllIn&&L&&(m.textContent=`당신의 턴입니다. (${V==="preflop"?"프리플랍":"플랍 전"})`)}function gn(t,e,a){const l=Math.min(t.coins,e);t.coins-=l,t.currentBetInRound=l,j+=l,t.lastAction="blind",t.coins===0&&(t.isAllIn=!0)}function Un(){if(D!=="solo_ai"||!s||!L||M!=="human"){$t.disabled=!0,Rt.disabled=!0,Se.disabled=!0,Ae.disabled=!0,xt.disabled=!0,Ce.disabled=!0,Mt();return}Mt(),$t.disabled=s.isAllIn,xt.disabled=s.isAllIn;const t=s.currentBetInRound===v&&!s.isAllIn;Rt.disabled=!t;const e=v-s.currentBetInRound;if(Se.disabled=!(e>0&&!s.isAllIn),e>0?Se.textContent=s.coins>e?`콜 (${e})`:`올인 콜 (${s.coins})`:Se.textContent="콜",s.isAllIn&&(Se.disabled=!0),Ae.disabled=s.isAllIn,Ce.disabled=s.isAllIn,s.isAllIn)Ae.textContent="올인됨",Ae.disabled=!0;else{const a=parseInt(Ce.value),l=Math.min(s.coins,Math.max(1,Math.floor(s.coins*(a/100)))),o=v>0,r=s.currentBetInRound+l;let d=!1;o?(Ae.textContent="레이즈",(l===s.coins||r>=v+U)&&(d=!0)):(Ae.textContent="벳",(l===s.coins||r>=Y)&&(d=!0)),Ae.disabled=!d||l===0||l>s.coins}}function Ea(){!s||M!=="human"||!L||s.isFolded||(s.isFolded=!0,s.lastAction="fold",ve("human","폴드"),m.textContent="당신은 폴드했습니다.",L=!1,c&&dt(c),ct())}function wa(){if(!(!s||M!=="human"||!L||s.isAllIn)){if(s.currentBetInRound<v){m.textContent="체크할 수 없습니다. 현재 벳에 콜하거나 레이즈해야 합니다.";return}s.lastAction="check",s.hasActedThisRound=!0,ve("human","체크"),m.textContent="당신은 체크했습니다.",M="ai",Q(),setTimeout(Fe,1e3)}}function Ma(){if(!s||M!=="human"||!L||s.isAllIn)return;const t=v-s.currentBetInRound;if(t<=0){m.textContent="콜할 금액이 없습니다. 체크하거나 벳/레이즈 하세요.";return}const e=Math.min(t,s.coins);s.coins-=e,j+=e,s.currentBetInRound+=e,s.lastAction="call",s.hasActedThisRound=!0,s.coins===0?(s.isAllIn=!0,m.textContent=`당신은 올인 콜했습니다 (총 ${s.currentBetInRound}).`,ve("human",`올인 콜 (${e})`)):(m.textContent=`당신은 ${e}을 콜했습니다. (총 ${s.currentBetInRound})`,ve("human",`콜 (${e})`)),M="ai",Q(),setTimeout(Fe,1e3)}function Fa(){if(!s||M!=="human"||!L||s.isAllIn)return;const t=s.coins;if(t<=0)return;const e=s.currentBetInRound+t;s.coins=0,j+=t,s.currentBetInRound=e,s.isAllIn=!0;const a=e>v,l=e===v&&v>0,o=v===0&&e>0;a?(s.lastAction="raise",se="human",U=e-v,v=e,m.textContent=`당신은 올인 레이즈하여 총 ${e}(으)로 만들었습니다!`):l?(s.lastAction="call",m.textContent=`당신은 올인 콜하여 총 ${e}을 맞췄습니다!`):o?(s.lastAction="bet",se="human",v=e,U=e,m.textContent=`당신은 올인 (${e}) 벳했습니다!`):(s.lastAction="call",m.textContent=`당신은 올인 (${t}) 했습니다. 총 ${e}.`),ve("human",`올인 (${t})`),s.hasActedThisRound=!0,M="ai",Q(),setTimeout(Fe,1e3)}function Sa(){if(!s||M!=="human"||!L||s.isAllIn)return;let t=0;if(s.coins>0){const l=parseInt(Ce.value);t=Math.min(s.coins,Math.max(1,Math.floor(s.coins*(l/100))))}if(t<=0){m.textContent="벳할 금액이 없습니다.";return}if(t>s.coins){m.textContent="코인이 부족합니다.";return}const e=v>0,a=s.currentBetInRound+t;if(e){if(t<s.coins&&a<v+U){m.textContent=`최소 레이즈는 총 ${v+U}이 되도록 해야 합니다. (현재 베팅액에서 ${U} 만큼 더 필요). 또는 올인하세요.`;return}}else{const l=D==="solo_ai"?Y:be;if(t<s.coins&&a<l){m.textContent=`최소 벳 금액은 ${l} 입니다. 또는 올인하세요.`;return}}s.coins-=t,j+=t,s.currentBetInRound=a,s.lastAction=e?"raise":"bet",s.hasActedThisRound=!0,s.coins===0&&(s.isAllIn=!0),s.lastAction==="bet"?(v=a,U=a,se="human"):s.lastAction==="raise"&&(U=a-v,v=a,se="human"),m.textContent=`당신이 ${t}을(를) ${We(s.lastAction)}하여 총 ${a}(으)로 만들었습니다.`,ve("human",`${We(s.lastAction)}: ${t}`),M="ai",Q(),setTimeout(Fe,1e3)}function La(t,e,a,l,o,r,d,R){if(t===10)return qn(e,a,l,o,r,d,R);const A=o-e.currentBetInRound<=0,k=o-e.currentBetInRound,g=De(e.holeCards,l).rankValue;if(t===1)if(A){if(g>=2&&Math.random()<.3){const I=Math.min(e.coins,d);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else return g<2&&k>e.coins*.05&&Math.random()<.95?{type:"fold"}:g<3&&k>e.coins*.15&&Math.random()<.8?{type:"fold"}:e.coins<=k?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"};const P=.5,u=t/20,h=t/25,y=st(e.holeCards.concat(l),4).some(I=>new Set(I.map(C=>C.suit)).size===1&&I.length===4),B=[...new Set(e.holeCards.concat(l).map(I=>I.value))].sort((I,C)=>I-C);let x=!1;if(B.length>=4)for(let I=0;I<=B.length-4;I++)B[I+3]-B[I]===3&&(x=!0),B.includes(14)&&B.includes(2)&&B.includes(3)&&B.includes(4)&&I===0&&(x=!0);const J=y||x;if(A){if(g>=4||J&&Math.random()<.6+h){const I=(Math.floor(Math.random()*(t*2))+5)*5;let C=Math.min(e.coins,Math.max(d,Math.floor(e.coins*(I/100))));if(C=Math.max(C,d),e.coins===C)return{type:"allin",amount:e.currentBetInRound+C};if(C>0)return{type:"bet",amount:e.currentBetInRound+C}}if(Math.random()<.2+u){const I=Math.min(e.coins,d);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else{if(g<2&&k>d*2&&Math.random()<P+.2-u)return{type:"fold"};if((g>=5||J&&Math.random()<.5+h)&&e.coins>k+r){const I=Math.min(e.coins+e.currentBetInRound,o+Math.max(r,d*(1+Math.floor(t/2))));return e.coins<=I-e.currentBetInRound?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"raise",amount:I}}return k>e.coins*(.4-u*.1)&&Math.random()<P-u?{type:"fold"}:e.coins<=k?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"}}}function Ta(t,e){const a=[...t],l=[...e],o=5-l.length;for(let r=0;r<o&&!(a.length===0||(a.length>0&&a.shift(),a.length===0));r++)l.push(a.shift());return l}function qn(t,e,a,l,o,r,d){const R=[...te],A=Ta(R,a),k=De(t.holeCards,A),p=De(e.holeCards,A);let g="human_wins";if(k.rankValue>p.rankValue)g="ai_wins";else if(p.rankValue>k.rankValue)g="human_wins";else{const h=k.bestHandCards.map(x=>x.value).sort((x,J)=>J-x),y=p.bestHandCards.map(x=>x.value).sort((x,J)=>J-x);let B=!0;for(let x=0;x<5;x++){if(h[x]>y[x]){g="ai_wins",B=!1;break}if(y[x]>h[x]){g="human_wins",B=!1;break}}B&&(g="split")}const P=l-t.currentBetInRound<=0,u=l-t.currentBetInRound;if(g==="ai_wins"){if(e.isAllIn)return{type:t.coins<=u?"allin":"call",amount:t.currentBetInRound+Math.min(t.coins,u)};if(P){if(a.length<4&&Math.random()<.3)return{type:"check"};let h=Math.min(t.coins,Math.max(r,Math.floor(d*(.6+Math.random()*.4))));return h=Math.max(h,r),t.coins===h?{type:"allin",amount:t.currentBetInRound+h}:{type:"bet",amount:t.currentBetInRound+h}}else{if(u<=d*.5&&a.length<4&&Math.random()<.4)return t.coins<=u?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"};let h=.6+Math.random()*.6,y=Math.max(o,Math.floor(d*h)),B=u+y,x=Math.min(t.coins,B),J=t.currentBetInRound+x;return t.coins===x?{type:"allin",amount:J}:{type:"raise",amount:J}}}else return g==="human_wins"?P?{type:"check"}:{type:"fold"}:P?{type:"check"}:e.isAllIn||u<=r/2?t.coins<=u?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"}:{type:"fold"}}function Fe(){if(!c||M!=="ai"||!L||!s){L||console.warn("triggerAIAction called but hand is not in progress.");return}if(m.textContent="AI가 생각 중...",Q(),c.isFolded||c.isAllIn){c.hasActedThisRound=!0,lt();return}setTimeout(()=>{let t;ne==="impossible"?t=qn(c,s,F,v,U,Y,j):ne==="marathon"?t=La(re,c,s,F,v,U,Y,j):(console.error("알 수 없는 AI 난이도:",ne),t={type:"check"});let e=0,a="";switch(t.type){case"fold":c.isFolded=!0,c.lastAction="fold",a="AI 폴드",m.textContent="AI가 폴드했습니다.",ve("ai",a),dt(s),ct();return;case"check":v-c.currentBetInRound>0?(e=Math.min(c.coins,v-c.currentBetInRound),c.lastAction="call",a=`AI 콜: ${e}`,m.textContent=`AI가 (강제) ${e}을 콜했습니다.`):(c.lastAction="check",a="AI 체크",m.textContent="AI가 체크했습니다.");break;case"call":e=Math.min(c.coins,v-c.currentBetInRound),e<0&&(e=0),c.lastAction="call",a=`AI 콜: ${e}`,m.textContent=`AI가 ${e}을 콜했습니다.`;break;case"bet":e=Math.min(c.coins,(t.amount||0)-c.currentBetInRound),e<0&&(e=0),e<Y&&e<c.coins&&(e=Math.min(c.coins,Y)),c.lastAction="bet",v=c.currentBetInRound+e,U=v,se="ai",a=`AI 벳: ${e}`,m.textContent=`AI가 ${e}을 벳하여 총 ${v}(으)로 만들었습니다.`;break;case"raise":e=Math.min(c.coins,(t.amount||0)-c.currentBetInRound),e<0&&(e=0);const l=c.currentBetInRound+e;l<v+U&&e<c.coins?(e=Math.min(c.coins,v-c.currentBetInRound),e<0&&(e=0),c.lastAction="call",a=`AI 콜: ${e}`,m.textContent=`AI가 (잘못된 레이즈 시도 후) ${e}을 콜했습니다.`):(c.lastAction="raise",U=l-v,v=l,se="ai",a=`AI 레이즈: ${e}`,m.textContent=`AI가 ${e}을 레이즈하여 총 ${v}(으)로 만들었습니다.`);break;case"allin":e=c.coins;const o=c.currentBetInRound+e;o>v?(c.lastAction=v===0?"bet":"raise",U=o-v,v=o,se="ai",m.textContent=`AI가 올인 ${We(c.lastAction)} (${e}) 하여 총 ${v}(으)로 만들었습니다!`):(c.lastAction="call",m.textContent=`AI가 올인 콜 (${e}) 했습니다.`),a=`AI 올인 (${e})`;break}c.coins-=e,j+=e,c.currentBetInRound+=e,c.coins===0&&(c.isAllIn=!0),c.hasActedThisRound=!0,ve("ai",a),lt()},1500)}function lt(){if(!s||!c||!L)return;const t=s,e=c,a=(t.hasActedThisRound||t.isAllIn||t.isFolded)&&(e.hasActedThisRound||e.isAllIn||e.isFolded),l=t.currentBetInRound===e.currentBetInRound||t.isAllIn||e.isAllIn||t.isFolded||e.isFolded;if(t.isFolded||e.isFolded){if(!L)return;const r=t.isFolded?e:t;dt(r),ct();return}let o=!1;if(a&&l)if(se){const r=se==="human"?e:t;(r.hasActedThisRound||r.isAllIn||r.isFolded)&&(o=!0)}else t.hasActedThisRound&&e.hasActedThisRound&&(o=!0);if(o){Da();return}if(M=M==="human"?"ai":"human",M==="human"){if(s.isFolded||s.isAllIn){M="ai",lt();return}m.textContent=`당신의 턴입니다. (${V})`,Q()}else{if(c.isFolded||c.isAllIn){M="human",lt();return}Q(),setTimeout(Fe,100)}}function Da(){if(!s||!c)return;if(s.currentBetInRound=0,c.currentBetInRound=0,s.hasActedThisRound=!1,c.hasActedThisRound=!1,v=0,U=D==="solo_ai"?Y:be,se=null,(s.isAllIn||c.isAllIn)&&!(s.isFolded||c.isFolded)&&(s.isAllIn&&c.currentBetInRound>=s.currentBetInRound||c.isAllIn&&s.currentBetInRound>=c.currentBetInRound||s.isAllIn&&c.isAllIn)){m.textContent="한 명 이상 올인 상태. 남은 커뮤니티 카드를 모두 공개합니다.";const e=5-F.length;if(e>0){for(let a=0;a<e;a++){te.length>0&&Me(1);const l=Me(1);if(l.length>0)F.push(...l);else break}it()}V="showdown"}switch(V){case"preflop":V="flop",ke("flop",2),m.textContent="플랍 카드 (2장)가 공개되었습니다.";break;case"flop":V="turn",ke("turn",1),m.textContent="3번째 커뮤니티 카드가 공개되었습니다.";break;case"turn":V="river",ke("river",1),m.textContent="4번째 커뮤니티 카드가 공개되었습니다.";break;case"river":V="fifth_street",ke("fifth_street",1),m.textContent="5번째 커뮤니티 카드가 공개되었습니다.";break;case"fifth_street":V="showdown";break;default:if(V!=="showdown")return}if(it(),V==="showdown")kn();else if(L){if(me==="ai"?M=s.isFolded||s.isAllIn?"ai":"human":M=c.isFolded||c.isAllIn?"human":"ai",M==="human"&&(s.isFolded||s.isAllIn)&&(M="ai"),M==="ai"&&(c.isFolded||c.isAllIn)&&(M="human"),(s.isFolded||s.isAllIn)&&(c.isFolded||c.isAllIn)){kn();return}M==="ai"?(m.textContent+=` AI의 턴입니다. (${V})`,setTimeout(Fe,1e3)):m.textContent+=` 당신의 턴입니다. (${V})`,Q()}}function ke(t,e){te.length>0&&Me(1);const a=Me(e);a.length>0?F.push(...a):console.warn(`덱에 카드가 부족하여 ${t}에 카드를 딜할 수 없습니다. (요청: ${e}, 딜됨: ${a.length})`),F.length>5&&(F=F.slice(0,5))}function kn(){if((!s||!c||!L&&V!=="showdown")&&V==="hand_over")return;V="showdown",m.textContent="쇼다운!",L=!1,Ut(!0);const t=s.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:De(s.holeCards,F),e=c.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:De(c.holeCards,F);let a=null,l="";if(s.isFolded)a=c,l=`당신 폴드. AI 승리 (${Ge(e.name)}${e.detailedName&&e.name!==e.detailedName?" - "+e.detailedName:""}).`;else if(c.isFolded)a=s,l=`AI 폴드. 당신 승리 (${Ge(t.name)}${t.detailedName&&t.name!==t.detailedName?" - "+t.detailedName:""}).`;else{const o=Oe(t,e);o===t&&t.rankValue>e.rankValue?a=s:o===e&&e.rankValue>t.rankValue?a=c:Oe(t,e)===t&&Oe(e,t)===e?a="split":Oe(t,e)===t?a=s:a=c,l=`당신: ${Ge(t.name)}${t.detailedName&&t.name!==t.detailedName?" ("+t.detailedName+")":""}. AI: ${Ge(e.name)}${e.detailedName&&e.name!==e.detailedName?" ("+e.detailedName+")":""}. `,a===s?l+="당신 승리!":a===c?l+="AI 승리!":l+="무승부 (팟 분배)!"}m.textContent=l,dt(a),ct()}function dt(t){if(t==="split"&&s&&c){const e=Math.floor(j/2);s.coins+=e,c.coins+=j-e,m.textContent+=` 각각 ${e} 코인 획득.`}else t&&t!=="split"&&(t.coins+=j,m.textContent+=` ${t.name}이(가) 팟 ${j}을(를) 획득했습니다.`);j=0,D==="solo_ai"&&ne==="marathon"&&c&&c.coins===0&&s&&s.coins>0&&(re++,re>10?m.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.':(m.textContent=`AI 파산! 마라톤 레벨 ${re}(으)로 진입합니다. AI 코인이 초기화됩니다.`,c.coins=Nn)),qt()}function ct(){L=!1,V="hand_over",M=null,s&&(s.lastAction="none"),c&&(c.lastAction="none"),Q()}function jn(){D==="practice"&&(L=!0,te=Gn(),te=On(te),s&&(s.holeCards=Me(2),s.currentBetInRound=0,s.isFolded=!1,s.lastAction="none"),F=[],j=0,m.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",Q(),X.disabled=!0,X.style.display="none")}function Na(){D!=="practice"||F.length!==0||(ke("flop",2),m.textContent="플랍 카드 (2장)가 공개되었습니다.",Q())}function Ha(){D!=="practice"||F.length!==2||(ke("turn",1),m.textContent="3번째 커뮤니티 카드가 공개되었습니다.",Q())}function _a(){D!=="practice"||F.length!==3||(ke("river",1),m.textContent="4번째 커뮤니티 카드가 공개되었습니다.",Q())}function Pa(){D!=="practice"||F.length!==4||(ke("fifth_street",1),m.textContent="5번째 커뮤니티 카드가 공개되었습니다.",Q())}function Va(){if(D!=="practice"||!s||s.holeCards.length===0||F.length<5){m.textContent="아직 카드가 충분하지 않습니다. 딜을 완료해주세요.";return}const t=De(s.holeCards,F),e=Ge(t.name);m.textContent=`최고의 패: ${e}${t.detailedName&&t.name!==t.detailedName?` (${t.detailedName})`:""}`,L=!1,Q(),X.disabled=!1,X.style.display="inline-block"}function Ka(){An.innerHTML="",Dn.forEach(t=>{const e=document.createElement("li"),a=document.createElement("strong");a.textContent=`${t.kor} (${t.eng})`,e.appendChild(a);const l=document.createElement("div");l.classList.add("ranking-details-wrapper");const o=document.createElement("div");o.classList.add("ranking-example-cards"),t.exampleCards.forEach((d,R)=>{const A=t.highlightIndices?t.highlightIndices.includes(R):!1;o.appendChild(rt(d,!0,A))}),l.appendChild(o);const r=document.createElement("p");r.classList.add("ranking-description"),r.textContent=t.desc,l.appendChild(r),e.appendChild(l),An.appendChild(e)})}function Ga(){Ka(),ot.style.display="block",Pn.focus()}function zn(){ot.style.display="none",_n.focus()}function Oa(){Jn(!0),Jt.style.display="block",Et.checked=!0,wt.style.display="none",Vn.value="1000",Kn.value="marathon",Et.focus()}function jt(){Jt.style.display="none",X.focus()}function Xn(){Wt.checked?wt.style.display="block":wt.style.display="none"}function Qa(){const t=Wt.checked?"solo_ai":"practice";let e=0;if(t==="solo_ai"){if(e=parseInt(Vn.value,10),isNaN(e)){alert("유효한 코인 금액을 선택해주세요.");return}Nn=e,ne=Kn.value,ne==="marathon"&&(re=1),me="ai",Y=Math.max(10,Math.floor(e/100)),at=Math.max(5,Math.floor(Y/2))}else at=Qt,Y=be;D=t,s={name:"나",holeCards:[],coins:t==="solo_ai"?e:0,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"human",hasActedThisRound:!1},t==="solo_ai"?c={name:"AI 상대",holeCards:[],coins:e,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"ai",hasActedThisRound:!1}:c=null,Hn.style.display="flex",jt(),t==="solo_ai"?Wn():jn(),X.disabled=!0,X.style.display="none"}X.addEventListener("click",Oa);Ba.addEventListener("click",jt);Et.addEventListener("change",Xn);Wt.addEventListener("change",Xn);ba.addEventListener("click",Qa);gt.addEventListener("click",jn);kt.addEventListener("click",Na);Ct.addEventListener("click",Ha);Bt.addEventListener("click",_a);bt.addEventListener("click",Pa);vt.addEventListener("click",Va);$t.addEventListener("click",Ea);Rt.addEventListener("click",wa);Se.addEventListener("click",Ma);Ae.addEventListener("click",Sa);xt.addEventListener("click",Fa);Ee.addEventListener("click",Wn);Ce.addEventListener("input",Un);_n.addEventListener("click",Ga);Pn.addEventListener("click",zn);window.addEventListener("keydown",t=>{t.key==="Escape"&&(ot.style.display==="block"&&zn(),Jt.style.display==="block"&&jt())});document.addEventListener("DOMContentLoaded",()=>{Jn(!0),Mt(),Q(),m.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.'});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */console.log("Poker Script v1.3.3 Loaded - Flop 3 cards, Burn Logic, No Fifth Street.");const Ja=["♠","♥","♣","♦"],Yn=[{rank:"2",value:2},{rank:"3",value:3},{rank:"4",value:4},{rank:"5",value:5},{rank:"6",value:6},{rank:"7",value:7},{rank:"8",value:8},{rank:"9",value:9},{rank:"10",value:10},{rank:"J",value:11},{rank:"Q",value:12},{rank:"K",value:13},{rank:"A",value:14}];function ue(t){return t.map((e,a)=>({...e,id:`example-${e.suit}${e.rank}-${a}`}))}const Zn=[{kor:"로열 플러시",eng:"Royal Flush",desc:"A, K, Q, J, 10 (모두 같은 무늬)",exampleCards:ue([{suit:"♥",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♥",rank:"Q",value:12},{suit:"♥",rank:"J",value:11},{suit:"♥",rank:"10",value:10}]),highlightIndices:[0,1,2,3,4]},{kor:"스트레이트 플러시",eng:"Straight Flush",desc:"연속된 숫자 5장 (모두 같은 무늬, 로열 플러시 제외)",exampleCards:ue([{suit:"♠",rank:"9",value:9},{suit:"♠",rank:"8",value:8},{suit:"♠",rank:"7",value:7},{suit:"♠",rank:"6",value:6},{suit:"♠",rank:"5",value:5}]),highlightIndices:[0,1,2,3,4]},{kor:"포 카드",eng:"Four of a Kind",desc:"같은 숫자 4장 + 아무 카드 1장",exampleCards:ue([{suit:"♦",rank:"A",value:14},{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"A",value:14},{suit:"♣",rank:"A",value:14},{suit:"♠",rank:"K",value:13}]),highlightIndices:[0,1,2,3]},{kor:"풀 하우스",eng:"Full House",desc:"같은 숫자 3장 + 같은 숫자 2장 (트리플 + 원 페어)",exampleCards:ue([{suit:"♥",rank:"K",value:13},{suit:"♠",rank:"K",value:13},{suit:"♦",rank:"K",value:13},{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12}]),highlightIndices:[0,1,2,3,4]},{kor:"플러시",eng:"Flush",desc:"무늬가 같은 카드 5장 (숫자는 연속되지 않음)",exampleCards:ue([{suit:"♦",rank:"A",value:14},{suit:"♦",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♦",rank:"5",value:5},{suit:"♦",rank:"2",value:2}]),highlightIndices:[0,1,2,3,4]},{kor:"스트레이트",eng:"Straight",desc:"연속된 숫자 5장 (무늬는 달라도 됨)",exampleCards:ue([{suit:"♠",rank:"10",value:10},{suit:"♥",rank:"9",value:9},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"7",value:7},{suit:"♥",rank:"6",value:6}]),highlightIndices:[0,1,2,3,4]},{kor:"트리플",eng:"Three of a Kind",desc:"같은 숫자 3장 + 서로 다른 숫자 2장",exampleCards:ue([{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12},{suit:"♠",rank:"Q",value:12},{suit:"♦",rank:"A",value:14},{suit:"♣",rank:"K",value:13}]),highlightIndices:[0,1,2]},{kor:"투 페어",eng:"Two Pair",desc:"같은 숫자 2장 + 같은 숫자 2장 + 아무 카드 1장",exampleCards:ue([{suit:"♥",rank:"J",value:11},{suit:"♠",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"8",value:8},{suit:"♥",rank:"K",value:13}]),highlightIndices:[0,1,2,3]},{kor:"원 페어",eng:"One Pair",desc:"같은 숫자 2장 + 서로 다른 숫자 3장",exampleCards:ue([{suit:"♥",rank:"10",value:10},{suit:"♠",rank:"10",value:10},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♥",rank:"9",value:9}]),highlightIndices:[0,1]},{kor:"하이 카드",eng:"High Card",desc:"위 족보에 해당하지 않는 경우, 가장 높은 숫자의 카드로 결정",exampleCards:ue([{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♣",rank:"9",value:9}]),highlightIndices:[0]}],zt=10,$e=20;let Te=zt,H=$e,N=[],E=[],Ue=new Set,qe=new Set,Je=new Set,T=null,n=null,i=null,z=0,G=null,le=1,de="ai",S="pre_deal",$=null,b=0,O=$e,w=!1,Z=null,ea=1e3,K=1e5;const Wa=1e8,ta="texasHoldemGlobalPlayerChips";let W=!1;const na=document.getElementById("game-board"),Cn=document.getElementById("player-hole-cards"),Bn=document.getElementById("community-cards"),f=document.getElementById("message-area"),bn=document.getElementById("global-chips-display"),vn=document.getElementById("player-chips-display"),$n=document.getElementById("player-action-display"),Ua=document.getElementById("dealer-chip-player"),et=document.getElementById("ai-player-area"),Rn=document.getElementById("ai-name"),xn=document.getElementById("ai-chips-display"),En=document.getElementById("ai-action-display"),qa=document.getElementById("dealer-chip-ai"),wn=document.getElementById("ai-hole-cards"),ja=document.getElementById("pot-amount"),ye=document.getElementById("marathonLevelDisplay"),za=document.getElementById("player-action-animation"),Xa=document.getElementById("ai-action-animation"),_=document.getElementById("setup-game-button"),ee=document.getElementById("exit-game-button"),tt=document.getElementById("practice-mode-actions"),Ft=document.getElementById("deal-new-hand-practice-button"),St=document.getElementById("deal-flop-button"),Lt=document.getElementById("deal-turn-button"),Tt=document.getElementById("deal-river-button"),Dt=document.getElementById("evaluate-button"),we=document.getElementById("player-betting-actions"),Nt=document.getElementById("foldButton"),Ht=document.getElementById("checkButton"),Le=document.getElementById("callButton"),ge=document.getElementById("confirmBetButton"),Ie=document.getElementById("startNextHandButton"),Be=document.getElementById("betPercentageSlider"),Mn=document.getElementById("betPercentageValue"),yt=document.getElementById("calculatedBetAmountDisplay"),_t=document.getElementById("allInButton"),aa=document.getElementById("show-rankings-button"),ut=document.getElementById("rankings-modal"),ia=ut.querySelector(".close-button"),Fn=document.getElementById("hand-rankings-list"),Xt=document.getElementById("game-setup-modal"),Ya=document.getElementById("close-setup-modal-button"),Pt=document.getElementById("gameModePractice"),Yt=document.getElementById("gameModeSoloAI"),Vt=document.getElementById("solo-ai-options"),sa=document.getElementById("startingChipsSelect"),la=document.getElementById("aiDifficultySelect"),Za=document.getElementById("start-configured-game-button"),Zt=document.getElementById("exit-game-confirmation-modal"),oa=document.getElementById("confirm-exit-game-button"),ei=document.getElementById("cancel-exit-game-button");let Ve=null,Ke=null;function Re(t,e){const a=t==="human"?za:Xa;if(!a)return;t==="human"&&Ve?clearTimeout(Ve):t==="ai"&&Ke&&clearTimeout(Ke),a.textContent=e,a.classList.remove("show"),a.offsetWidth,a.classList.add("show");const l=window.setTimeout(()=>{a.classList.remove("show"),t==="human"&&Ve===l?Ve=null:t==="ai"&&Ke===l&&(Ke=null)},1800);t==="human"?Ve=l:Ke=l}function ti(t,e){return`${t}-${e}-${Math.random().toString(36).substring(2,7)}`}function Kt(){const t=[];for(const e of Ja)for(const a of Yn)t.push({suit:e,rank:a.rank,value:a.value,id:ti(e,a.rank)});return t}function nt(t){const e=[...t];for(let a=e.length-1;a>0;a--){const l=Math.floor(Math.random()*(a+1));[e[a],e[l]]=[e[l],e[a]]}return e}function q(t){return N.length<t?(f.textContent="덱에 카드가 부족합니다!",console.error("Deck depleted. Requested:",t,"Available:",N.length),N.splice(0,N.length)):N.splice(0,t)}function ht(t,e=!1,a=!1,l=!1){const o=document.createElement("div");if(o.classList.add("card-container"),o.dataset.cardId=t.id,e){const p=document.createElement("div");p.classList.add("card","example-card"),a&&p.classList.add("highlighted-card-component"),t.suit==="♥"?p.classList.add("hearts"):t.suit==="♦"?p.classList.add("diamonds"):t.suit==="♣"?p.classList.add("clubs"):t.suit==="♠"&&p.classList.add("spades"),p.setAttribute("aria-label",`${t.rank==="10"?"10":ie(t.value)} ${Sn(t.suit)}`);const g=document.createElement("span");g.classList.add("rank"),g.textContent=t.rank,p.appendChild(g);const P=document.createElement("span");return P.classList.add("suit"),P.textContent=t.suit,p.appendChild(P),p}const r=document.createElement("div");r.classList.add("card-flipper");const d=document.createElement("div");d.classList.add("card-face","card-front-face"),t.suit==="♥"?d.classList.add("hearts"):t.suit==="♦"?d.classList.add("diamonds"):t.suit==="♣"?d.classList.add("clubs"):t.suit==="♠"&&d.classList.add("spades");const R=document.createElement("span");R.classList.add("rank"),R.textContent=t.rank,d.appendChild(R);const A=document.createElement("span");A.classList.add("suit"),A.textContent=t.suit,d.appendChild(A),d.setAttribute("aria-label",`${t.rank==="10"?"10":ie(t.value)} ${Sn(t.suit)}`);const k=document.createElement("div");return k.classList.add("card-face","card-back-face"),k.setAttribute("aria-label","숨겨진 카드"),r.appendChild(k),r.appendChild(d),o.appendChild(r),l&&r.classList.add("is-flipped"),o.setAttribute("role","img"),o}async function en(t,e=0){if(!t)return;const a=t.querySelector(".card-flipper");if(a&&!a.classList.contains("is-flipped")){e>0&&await new Promise(o=>setTimeout(o,e)),a.classList.add("is-flipped");const l=600;await new Promise(o=>setTimeout(o,l))}}function Sn(t){switch(t){case"♠":return"스페이드";case"♥":return"하트";case"♣":return"클럽";case"♦":return"다이아몬드";default:return""}}async function ra(){if(Cn.innerHTML="",n&&n.holeCards)for(let t=0;t<n.holeCards.length;t++){const e=n.holeCards[t],a=qe.has(e.id),l=ht(e,!1,!1,a);Cn.appendChild(l),a||(await en(l,100+t*200),qe.add(e.id))}}async function tn(t=!1){if(wn.innerHTML="",i&&i.holeCards)for(let e=0;e<i.holeCards.length;e++){const a=i.holeCards[e],l=t||i.isAllIn,o=Je.has(a.id);let r=!1;l&&o&&(r=!0);const d=ht(a,!1,!1,r);wn.appendChild(d),l&&!o?(await en(d,100+e*200),Je.add(a.id)):!l&&o&&Je.delete(a.id)}}async function nn(){Bn.innerHTML="";let t=0;for(let e=0;e<E.length;e++){const a=E[e],l=Ue.has(a.id),o=ht(a,!1,!1,l);Bn.appendChild(o),l||(await en(o,100+t*150),Ue.add(a.id),t++)}}function ni(){ja.textContent=String(z)}function an(){n?(vn.textContent=`칩: ${n.chips}`,$n.textContent=n.lastAction&&n.lastAction!=="none"?`(${je(n.lastAction)}${n.currentBetInRound>0&&n.lastAction!=="blind"?" "+n.currentBetInRound:""})`:""):(vn.textContent="칩: 0",$n.textContent=""),i?(Rn.textContent=G==="marathon"?`AI 상대 (레벨 ${le})`:"AI 상대 (불가능)",xn.textContent=`칩: ${i.chips}`,En.textContent=i.lastAction&&i.lastAction!=="none"?`(${je(i.lastAction)}${i.currentBetInRound>0&&i.lastAction!=="blind"?" "+i.currentBetInRound:""})`:"",ye.textContent=G==="marathon"?`레벨: ${le}`:"",ye.style.display=G==="marathon"&&T==="solo_ai"?"inline":"none"):(Rn.textContent="AI 상대",xn.textContent="칩: 0",En.textContent="",ye.style.display="none"),ni(),ai(),Ne()}function ai(){Ua.style.display=T==="solo_ai"&&de==="human"?"flex":"none",qa.style.display=T==="solo_ai"&&de==="ai"?"flex":"none"}function ie(t){const e=Yn.find(a=>a.value===t);return e?e.rank==="A"?"에이스":e.rank==="K"?"킹":e.rank==="Q"?"퀸":e.rank==="J"?"잭":e.rank:String(t)}function Qe(t){const e=Zn.find(a=>a.eng===t);return e?e.kor:t}function je(t){switch(t){case"fold":return"폴드";case"check":return"체크";case"call":return"콜";case"bet":return"벳";case"raise":return"레이즈";case"blind":return"블라인드";default:return""}}function ii(t){if(t.length!==5)throw new Error("패는 반드시 5장의 카드로 구성되어야 합니다.");const e=[...t].sort((u,h)=>u.value-h.value),a=e.map(u=>u.value),l=e.map(u=>u.suit),o={};a.forEach(u=>o[u]=(o[u]||0)+1);const r=Object.values(o).sort((u,h)=>h-u),d=Object.keys(o).map(Number).sort((u,h)=>h-u),R=new Set(l).size===1;let A=!1,k=0;const p=[...new Set(a)].sort((u,h)=>u-h);if(p.length>=5){for(let u=p.length-1;u>=4;u--)if(p[u]-p[u-4]===4){A=!0,k=p[u];break}}!A&&p.includes(14)&&p.includes(2)&&p.includes(3)&&p.includes(4)&&p.includes(5)&&(A=!0,k=5);let g=e;if(A&&k===5){const u=e.find(y=>y.value===14),h=e.filter(y=>y.value!==14).sort((y,B)=>y.value-B.value);g=[u,...h.filter(y=>y.value<=5).reverse()]}if(A&&R){const u=k;return u===14?{name:"Royal Flush",rankValue:10,detailedName:"로열 플러시",bestHandCards:g}:{name:"Straight Flush",rankValue:9,detailedName:`${ie(u)}-high 스트레이트 플러시`,bestHandCards:g}}if(r[0]===4)return{name:"Four of a Kind",rankValue:8,detailedName:`포 카드, ${ie(d.find(h=>o[h]===4))}s`,bestHandCards:e};if(r[0]===3&&r[1]===2){const u=ie(d.find(y=>o[y]===3)),h=ie(d.find(y=>o[y]===2));return{name:"Full House",rankValue:7,detailedName:`풀 하우스, ${u}s over ${h}s`,bestHandCards:e}}if(R)return{name:"Flush",rankValue:6,detailedName:`${ie(e[e.length-1].value)}-high 플러시`,bestHandCards:e};if(A)return{name:"Straight",rankValue:5,detailedName:`${ie(k)}-high 스트레이트`,bestHandCards:g};if(r[0]===3)return{name:"Three of a Kind",rankValue:4,detailedName:`트리플, ${ie(d.find(h=>o[h]===3))}s`,bestHandCards:e};if(r[0]===2&&r[1]===2){const u=ie(d.filter(y=>o[y]===2).sort((y,B)=>B-y)[0]),h=ie(d.filter(y=>o[y]===2).sort((y,B)=>B-y)[1]);return{name:"Two Pair",rankValue:3,detailedName:`투 페어, ${u}s and ${h}s`,bestHandCards:e}}return r[0]===2?{name:"One Pair",rankValue:2,detailedName:`원 페어, ${ie(d.find(h=>o[h]===2))}s`,bestHandCards:e}:{name:"High Card",rankValue:1,detailedName:`하이 카드, ${ie(e[e.length-1].value)}`,bestHandCards:e}}function Gt(t,e){if(e===0)return[[]];if(e>t.length)return[];if(e===t.length)return[t];const[a,...l]=t,o=Gt(l,e);return[...Gt(l,e-1).map(d=>[a,...d]),...o]}function ft(t,e){if(t.rankValue>e.rankValue)return t;if(e.rankValue>t.rankValue)return e;if(!t.bestHandCards||!e.bestHandCards)return t.rankValue>=e.rankValue?t:e;const a=r=>{if(!r.bestHandCards)return 0;const d=r.bestHandCards.map(R=>R.value).sort((R,A)=>A-R);return(r.name==="Straight"||r.name==="Straight Flush")&&d.includes(14)&&d.includes(5)&&d.includes(4)&&d.includes(3)&&d.includes(2)?5:d[0]};if((t.name==="Straight"||t.name==="Straight Flush")&&(e.name==="Straight"||e.name==="Straight Flush")){const r=a(t),d=a(e);return r>d?t:d>r?e:t}const l=t.bestHandCards.map(r=>r.value).sort((r,d)=>d-r),o=e.bestHandCards.map(r=>r.value).sort((r,d)=>d-r);for(let r=0;r<Math.min(l.length,o.length);r++){if(l[r]>o[r])return t;if(o[r]>l[r])return e}return t}function xe(t,e){const a=[...t,...e];if(a.length<5)return{name:"카드가 부족합니다",rankValue:0,detailedName:"패를 확인하려면 최소 5장의 카드가 필요합니다."};const l=Gt(a,5);let o=null;for(const r of l){const d=ii(r);o?o=ft(o,d):o=d}return o||{name:"오류",rankValue:0,detailedName:"패를 평가할 수 없습니다."}}function sn(t=!0){t&&(na.style.display="none",et.style.display="none",ee.style.display="none",T=null,n=null,i=null,G=null,w=!1,f.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.',Te=zt,H=$e,le=1,ye.style.display="none"),n&&(n.holeCards=[],n.currentBetInRound=0,n.isFolded=!1,n.isAllIn=!1,n.lastAction="none",n.hasActedThisRound=!1),i&&(i.holeCards=[],i.currentBetInRound=0,i.isFolded=!1,i.isAllIn=!1,i.lastAction="none",i.hasActedThisRound=!1),E=[],Ue.clear(),qe.clear(),Je.clear(),z=0,b=0,O=T==="solo_ai"?H:$e,$=null,S="pre_deal",Z=null,W=!1,ra(),tn(),nn(),an(),_.disabled=!1,_.style.display="inline-block",t&&(ee.style.display="none"),tt.style.display="none",we.style.display="none",Ie.style.display="none"}async function ae(){T==="practice"?(tt.style.display="flex",we.style.display="none",Ie.style.display="none",et.style.display="none",ye.style.display="none",ee.style.display="none",Ft.style.display=n?"inline-block":"none",St.style.display=n&&n.holeCards.length>0&&E.length===0?"inline-block":"none",Lt.style.display=E.length===3?"inline-block":"none",Tt.style.display=E.length===4?"inline-block":"none",Dt.style.display=E.length===5?"inline-block":"none",Ft.disabled=w&&n&&n.holeCards.length>0,St.disabled=!(n&&n.holeCards.length>0&&E.length===0),Lt.disabled=E.length!==3,Tt.disabled=E.length!==4,Dt.disabled=E.length!==5):T==="solo_ai"?(tt.style.display="none",we.style.display=w&&$==="human"&&!W?"flex":"none",Ie.style.display=!w&&n&&i&&n.chips>0&&i.chips>0?"inline-block":"none",et.style.display="block",ee.style.display="inline-block",G==="marathon"?(ye.style.display="inline",ye.textContent=`레벨: ${le}`):ye.style.display="none",w&&$==="human"&&!W?ca():W&&(we.style.display="none")):(tt.style.display="none",we.style.display="none",Ie.style.display="none",et.style.display="none",ye.style.display="none",ee.style.display="none"),an(),await ra(),await tn(S==="showdown"||S==="hand_over"||((i==null?void 0:i.isAllIn)??!1)),await nn(),!w&&n&&i&&(n.chips===0||i.chips===0)&&(G==="marathon"&&i.chips===0&&n.chips>0&&le<=10||(n.chips===0&&i.chips===0?f.textContent="무승부! 양쪽 플레이어 모두 칩이 없습니다.":n.chips===0?f.textContent="AI 승리! 당신의 칩이 모두 소진되었습니다.":i.chips===0&&(f.textContent="당신 승리! AI의 칩이 모두 소진되었습니다."),(n.chips===0||i.chips===0&&G!=="marathon")&&n&&ce(K+n.chips),_.disabled=!1,_.style.display="inline-block",ee.style.display="none",Ie.style.display="none"))}function Ot(){if(!n||T!=="solo_ai"||$!=="human"||!w){Be.disabled=!0,Mn.textContent="-",yt.textContent="(금액: -)";return}Be.disabled=n.isAllIn;const t=parseInt(Be.value);if(Mn.textContent=`${t}%`,n.chips>0){const e=Math.min(n.chips,Math.max(1,Math.floor(n.chips*(t/100))));yt.textContent=`(금액: ${e})`}else yt.textContent="(금액: 0)"}async function da(){if(!n||T==="solo_ai"&&!i){f.textContent="플레이어 정보가 없습니다. 게임을 먼저 설정하세요.";return}if(G==="marathon"&&le>10){f.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.',w=!1,Ie.style.display="none",_.disabled=!1,_.style.display="inline-block",ee.style.display="none",n&&ce(K+n.chips),n.chips=0,await ae();return}if(n.chips===0||i&&i.chips===0&&!(G==="marathon"&&le<=10&&i.chips===0)){f.textContent="게임 종료. 한 플레이어의 칩이 없습니다. '새 게임 설정'으로 다시 시작하세요.",n.chips>0&&(ce(K+n.chips),n.chips=0),_.disabled=!1,_.style.display="inline-block",ee.style.display="none",await ae();return}if(w=!0,N=Kt(),N=nt(N),Ue.clear(),qe.clear(),Je.clear(),n.holeCards=[],n.currentBetInRound=0,n.isFolded=!1,n.isAllIn=!1,n.lastAction="none",n.hasActedThisRound=!1,i&&(i.holeCards=[],i.currentBetInRound=0,i.isFolded=!1,i.isAllIn=!1,i.lastAction="none",i.hasActedThisRound=!1),E=[],z=0,Z=null,T==="solo_ai"?(de=de==="human"?"ai":"human",O=H):O=$e,G==="impossible"&&i&&n&&i.chips<=H){let t=50,e=!1,a=Kt();for(;t>0&&!e;){N=nt([...a]);const l=q(2),o=q(2);let r=[...N];r.length>0&&r.shift();const d=ua(r,[]),R=xe(l,d),A=xe(o,d);ft(A,R)===A&&A.rankValue>R.rankValue&&(n.holeCards=l,i.holeCards=o,e=!0),t--}e?console.log("Impossible AI adjusted hand to win due to low chips vs blind."):(console.warn("Impossible AI couldn't ensure a win before blind bust after retries. Proceeding with current deal."),N=nt([...a]),n.holeCards=q(2),i&&(i.holeCards=q(2)))}else n.holeCards=q(2),i&&(i.holeCards=q(2));if(T==="solo_ai"&&i){S="preflop";const t=de==="human"?n:i,e=de==="human"?i:n;Ln(t,Te),Ln(e,H),b=H,Z=e.seat,$=de==="human"?"human":"ai"}else T==="practice"&&(f.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",S="pre_deal");if(await ae(),_.disabled=!0,_.style.display="none",ee.style.display="inline-block",T==="solo_ai"&&$==="ai"&&i&&!i.isFolded&&!i.isAllIn&&w){const t="AI의 턴입니다. (프리플랍)";f.textContent=t,setTimeout(ln,1200)}else T==="solo_ai"&&$==="human"&&n&&!n.isFolded&&!n.isAllIn&&w&&(f.textContent="당신의 턴입니다. (프리플랍)")}function Ln(t,e,a){const l=Math.min(t.chips,e);t.chips-=l,t.currentBetInRound=l,z+=l,t.lastAction="blind",t.chips===0&&(t.isAllIn=!0)}function ca(){if(T!=="solo_ai"||!n||!w||$!=="human"||W){Nt.disabled=!0,Ht.disabled=!0,Le.disabled=!0,ge.disabled=!0,_t.disabled=!0,Be.disabled=!0,Ot();return}Ot(),Nt.disabled=n.isAllIn,_t.disabled=n.isAllIn;const t=n.currentBetInRound>=b&&!n.isAllIn;Ht.disabled=!t;const e=b-n.currentBetInRound;if(Le.disabled=!(e>0&&!n.isAllIn),e>0?Le.textContent=n.chips>e?`콜 (${e})`:`올인 콜 (${n.chips})`:Le.textContent="콜",(n.isAllIn||e<=0)&&(Le.disabled=!0),ge.disabled=n.isAllIn,Be.disabled=n.isAllIn,n.isAllIn)ge.textContent="올인됨",ge.disabled=!0;else{const a=parseInt(Be.value),l=Math.min(n.chips,Math.max(1,Math.floor(n.chips*(a/100)))),o=b>0,r=n.currentBetInRound+l;let d=!1;o?(ge.textContent="레이즈",(l===n.chips||r-b>=O)&&(d=!0)):(ge.textContent="벳",(l===n.chips||r>=H)&&(d=!0)),ge.disabled=!d||l===0||l>n.chips}}async function si(){!n||$!=="human"||!w||n.isFolded||(n.isFolded=!0,n.lastAction="fold",Re("human","폴드"),f.textContent="당신은 폴드했습니다.",w=!1,i&&mt(i),await ze())}async function li(){if(!(!n||$!=="human"||!w||n.isAllIn)){if(n.currentBetInRound<b){f.textContent="체크할 수 없습니다. 현재 벳에 콜하거나 레이즈해야 합니다.";return}n.lastAction="check",n.hasActedThisRound=!0,Re("human","체크"),f.textContent="당신은 체크했습니다.",await he()}}async function oi(){if(!n||$!=="human"||!w||n.isAllIn)return;const t=b-n.currentBetInRound;if(t<=0){f.textContent="콜할 금액이 없습니다. 체크하거나 벳/레이즈 하세요.";return}const e=Math.min(t,n.chips);n.chips-=e,z+=e,n.currentBetInRound+=e,n.lastAction="call",n.hasActedThisRound=!0,n.chips===0?(n.isAllIn=!0,f.textContent=`당신은 올인 콜했습니다 (총 ${n.currentBetInRound}).`,Re("human",`올인 콜 (${e})`)):(f.textContent=`당신은 ${e}을 콜했습니다. (총 ${n.currentBetInRound})`,Re("human",`콜 (${e})`)),await he()}async function ri(){if(!n||$!=="human"||!w||n.isAllIn)return;const t=n.chips;if(t<=0)return;const e=n.currentBetInRound+t;n.chips=0,z+=t,n.currentBetInRound=e,n.isAllIn=!0;const a=e>b,l=e===b&&b>0,o=b===0&&e>0;a?(n.lastAction="raise",O=e-b,b=e,Z="human",i&&(i.hasActedThisRound=!1),f.textContent=`당신은 올인 레이즈하여 총 ${e}(으)로 만들었습니다!`):l?(n.lastAction="call",f.textContent=`당신은 올인 콜하여 총 ${e}을 맞췄습니다!`):o?(n.lastAction="bet",b=e,O=e,Z="human",i&&(i.hasActedThisRound=!1),f.textContent=`당신은 올인 (${e}) 벳했습니다!`):(n.lastAction="call",f.textContent=`당신은 올인 (${t}) 했습니다. 총 ${e}.`),Re("human",`올인 (${t})`),n.hasActedThisRound=!0,await he()}async function di(){if(!n||$!=="human"||!w||n.isAllIn)return;let t=0;if(n.chips>0){const l=parseInt(Be.value);t=Math.min(n.chips,Math.max(1,Math.floor(n.chips*(l/100))))}if(t<=0){f.textContent="벳할 금액이 없습니다.";return}if(t>n.chips){f.textContent="칩이 부족합니다.";return}const e=b>0,a=n.currentBetInRound+t;if(e){const l=a-b;if(t<n.chips&&l<O){f.textContent=`최소 레이즈는 ${O} 만큼 더 올려서 총 ${b+O}이 되도록 해야 합니다. 또는 올인하세요.`;return}}else{const l=T==="solo_ai"?H:$e;if(t<n.chips&&a<l){f.textContent=`최소 벳 금액은 ${l} 입니다. 또는 올인하세요.`;return}}n.chips-=t,z+=t,n.currentBetInRound=a,n.lastAction=e?"raise":"bet",n.hasActedThisRound=!0,n.chips===0&&(n.isAllIn=!0),n.lastAction==="bet"?(b=a,O=a,Z="human"):n.lastAction==="raise"&&(O=a-b,b=a,Z="human"),i&&(i.hasActedThisRound=!1),f.textContent=`당신이 ${t}을(를) ${je(n.lastAction)}하여 총 ${a}(으)로 만들었습니다.`,Re("human",`${je(n.lastAction)}: ${t}`),await he()}function ci(t,e,a,l,o,r,d,R){if(t===10)return ha(e,a,l,o,r,d,R);const A=o-e.currentBetInRound<=0,k=o-e.currentBetInRound,g=xe(e.holeCards,l).rankValue;if(t===1)if(A){if(g>=2&&Math.random()<.3){const I=Math.min(e.chips,d);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else return g<2&&k>e.chips*.05&&Math.random()<.95?{type:"fold"}:g<3&&k>e.chips*.15&&Math.random()<.8?{type:"fold"}:e.chips<=k?{type:"allin",amount:e.currentBetInRound+e.chips}:{type:"call"};const P=.5,u=t/20,h=t/25,y=e.holeCards.concat(l);let B=!1;if(y.length>=4){const I={};y.forEach(C=>I[C.suit]=(I[C.suit]||0)+1),Object.values(I).some(C=>C===4)&&(B=!0)}let x=!1;if(y.length>=4){const I=[...new Set(y.map(C=>C.value))].sort((C,He)=>C-He);if(I.length>=4)for(let C=0;C<=I.length-4;C++)I[C+3]-I[C]===3&&(x=!0),I.includes(14)&&I.includes(2)&&I.includes(3)&&I.includes(4)&&C===0&&(x=!0)}const J=B||x;if(A){if(g>=4||J&&Math.random()<.6+h){const I=(Math.floor(Math.random()*(t*2))+5)*5;let C=Math.min(e.chips,Math.max(d,Math.floor(e.chips*(I/100))));if(C=Math.max(C,d),e.chips===C)return{type:"allin",amount:e.currentBetInRound+C};if(C>0)return{type:"bet",amount:e.currentBetInRound+C}}if(Math.random()<.2+u){const I=Math.min(e.chips,d);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else{if(g<2&&!J&&k>d*2&&Math.random()<P+.25-u)return{type:"fold"};if((g>=5||J&&Math.random()<.5+h)&&e.chips>k+r){const I=Math.min(e.chips+e.currentBetInRound,o+Math.max(r,d*(1+Math.floor(t/2)),k*(1+t/10)));return e.chips<=I-e.currentBetInRound?{type:"allin",amount:e.currentBetInRound+e.chips}:{type:"raise",amount:I}}return!J&&k>e.chips*(.45-u*.15)&&Math.random()<P-u?{type:"fold"}:e.chips<=k?{type:"allin",amount:e.currentBetInRound+e.chips}:{type:"call"}}}function ua(t,e){let a=[...t];const l=[...e],o=5-l.length;for(let r=0;r<o&&a.length!==0;r++)l.push(a.shift());return l}function ha(t,e,a,l,o,r,d){let A=[...[...N]],k=[...a];k.length===0||k.length===3?A.length>0&&A.shift():k.length===4&&A.length>0&&A.shift();const p=ua(A,k),g=xe(t.holeCards,p),P=xe(e.holeCards,p),u=ft(g,P);let h;if(u===g&&g.rankValue>P.rankValue)h="ai_wins";else if(u===P&&P.rankValue>g.rankValue)h="human_wins";else if(u===g){if(h=g.rankValue===P.rankValue?"split":"ai_wins",h==="split"){const x=g.bestHandCards.map(C=>C.value).sort((C,He)=>He-C),J=P.bestHandCards.map(C=>C.value).sort((C,He)=>He-C);let I=!0;for(let C=0;C<5;C++)if(x[C]!==J[C]){I=!1;break}I||(h=u===g?"ai_wins":"human_wins")}}else h="human_wins";const y=l-t.currentBetInRound<=0,B=l-t.currentBetInRound;if(h==="human_wins"&&!y&&B>0)return{type:"fold"};if(h==="human_wins"&&B>=t.chips&&B>0)return{type:"fold"};if(h==="ai_wins"){if(e.isAllIn)return t.chips<=B&&B>0?{type:"allin",amount:t.currentBetInRound+t.chips}:{type:"call",amount:t.currentBetInRound+Math.min(t.chips,B)};if(y){if(a.length<4&&Math.random()<.3)return{type:"check"};let x=Math.min(t.chips,Math.max(r,Math.floor(d*(.6+Math.random()*.4))));return x=Math.max(x,r),t.chips===x?{type:"allin",amount:t.currentBetInRound+x}:{type:"bet",amount:t.currentBetInRound+x}}else{if(B<=d*.5&&a.length<4&&Math.random()<.4)return t.chips<=B?{type:"allin",amount:t.currentBetInRound+t.chips}:{type:"call"};let x=.7+Math.random()*.8,J=Math.max(o,Math.floor((d+B)*x)),I=l+J;return t.chips<=I-t.currentBetInRound?{type:"allin",amount:t.currentBetInRound+t.chips}:{type:"raise",amount:I}}}else return h==="human_wins"?y?{type:"check"}:{type:"fold"}:y?{type:"check"}:e.isAllIn||B<=r/2||B>=t.chips?t.chips<=B?{type:"allin",amount:t.currentBetInRound+t.chips}:{type:"call"}:{type:"fold"}}async function ln(){if(!i||$!=="ai"||!w||!n||W){!w&&!W&&console.warn("triggerAIAction called but hand is not in progress or reveal is pending.");return}if(f.textContent="AI가 생각 중...",await ae(),i.isFolded||i.isAllIn){i.hasActedThisRound=!0,await he();return}await new Promise(l=>setTimeout(l,1500+Math.random()*500));let t;G==="impossible"?t=ha(i,n,E,b,O,H,z):G==="marathon"?t=ci(le,i,n,E,b,O,H,z):(console.error("알 수 없는 AI 난이도:",G),t={type:"check"});let e=0,a="";switch(t.type){case"fold":i.isFolded=!0,i.lastAction="fold",a="AI 폴드",f.textContent="AI가 폴드했습니다.",Re("ai",a),mt(n),await ze();return;case"check":b-i.currentBetInRound>0?(e=Math.min(i.chips,b-i.currentBetInRound),i.lastAction="call",a=`AI 콜: ${e}`,f.textContent=`AI가 (강제) ${e}을 콜했습니다.`):(i.lastAction="check",a="AI 체크",f.textContent="AI가 체크했습니다.");break;case"call":e=Math.min(i.chips,b-i.currentBetInRound),e<0&&(e=0),i.lastAction="call",a=`AI 콜: ${e}`,f.textContent=`AI가 ${e}을 콜했습니다.`;break;case"bet":if(e=Math.min(i.chips,(t.amount||0)-i.currentBetInRound),e<0&&(e=0),e<H&&e<i.chips&&(e=Math.min(i.chips,H)),e<=0&&i.chips>0){i.lastAction="check",a="AI 체크",f.textContent="AI가 체크했습니다 (잘못된 벳 시도).";break}i.lastAction="bet",b=i.currentBetInRound+e,O=b,Z="ai",n&&(n.hasActedThisRound=!1),a=`AI 벳: ${e}`,f.textContent=`AI가 ${e}을 벳하여 총 ${b}(으)로 만들었습니다.`;break;case"raise":const l=t.amount||0;e=Math.min(i.chips,l-i.currentBetInRound),e<0&&(e=0);const o=i.currentBetInRound+e,r=o-b;if(e<i.chips&&r<O){const R=Math.min(i.chips,b-i.currentBetInRound);R>0?(e=R,i.lastAction="call",a=`AI 콜: ${e}`,f.textContent=`AI가 (잘못된 레이즈 시도 후) ${e}을 콜했습니다.`):(e=0,i.lastAction="check",a="AI 체크",f.textContent="AI가 체크했습니다 (잘못된 레이즈 시도 후).")}else i.lastAction="raise",O=r,b=o,Z="ai",n&&(n.hasActedThisRound=!1),a=`AI 레이즈: ${e}`,f.textContent=`AI가 ${e}을 레이즈하여 총 ${b}(으)로 만들었습니다.`;break;case"allin":e=i.chips;const d=i.currentBetInRound+e;d>b?(i.lastAction=b===0?"bet":"raise",i.lastAction==="raise"?O=d-b:O=d,b=d,Z="ai",n&&(n.hasActedThisRound=!1),f.textContent=`AI가 올인 ${je(i.lastAction)} (${e}) 하여 총 ${b}(으)로 만들었습니다!`):(i.lastAction=d===b?"call":"check",b-i.currentBetInRound<=0&&d<=b?(i.lastAction="check",f.textContent=`AI가 올인 체크 (${e}) 했습니다.`):(i.lastAction="call",f.textContent=`AI가 올인 콜 (${e}) 했습니다.`)),a=`AI 올인 (${e})`;break}i.chips-=e,z+=e,i.currentBetInRound+=e,i.chips===0&&(i.isAllIn=!0),i.hasActedThisRound=!0,Re("ai",a),await he()}async function he(){if(!n||!i||!w||W)return;const t=n,e=i,a=!t.isFolded&&!t.isAllIn,l=!e.isFolded&&!e.isAllIn;if(t.isFolded||e.isFolded){if(!w)return;const r=t.isFolded?e:t;mt(r),await ze();return}let o=!1;if((t.isAllIn||t.isFolded)&&(e.isAllIn||e.isFolded)?o=!0:t.currentBetInRound===e.currentBetInRound&&t.hasActedThisRound&&e.hasActedThisRound&&(S==="preflop"&&Z===(de==="human"?"ai":"human")?($===e.seat&&e.lastAction==="check"&&e.currentBetInRound===H||$===t.seat&&t.lastAction==="check"&&t.currentBetInRound===H||t.lastAction!=="blind"&&e.lastAction!=="blind")&&(o=!0):t.lastAction!=="blind"&&e.lastAction!=="blind"&&(o=!0),(t.isAllIn&&e.currentBetInRound>=t.currentBetInRound||e.isAllIn&&t.currentBetInRound>=e.currentBetInRound)&&(o=!0)),o){await It();return}if(Z?$==="human"&&Z==="human"?$="ai":$==="ai"&&Z==="ai"?$="human":$==="human"?$="ai":$="human":$==="human"?$="ai":$="human",$==="human"&&!a){if($="ai",!l){await It();return}}else if($==="ai"&&!l&&($="human",!a)){await It();return}if($==="human"){if(n.isFolded||n.isAllIn){await he();return}f.textContent=`당신의 턴입니다. (${S==="preflop"?"프리플랍":S})`,await ae()}else{if(i.isFolded||i.isAllIn){await he();return}await ae(),setTimeout(ln,100)}}async function It(){if(!n||!i||W)return;if(n.currentBetInRound=0,i.currentBetInRound=0,n.hasActedThisRound=!1,i.hasActedThisRound=!1,b=0,O=T==="solo_ai"?H:$e,Z=null,(n.isAllIn||i.isAllIn)&&!(n.isFolded||i.isFolded)&&(n.isAllIn&&n.currentBetInRound<=i.currentBetInRound&&!i.isFolded||i.isAllIn&&i.currentBetInRound<=n.currentBetInRound&&!n.isFolded||n.isAllIn&&i.isAllIn)&&S!=="river"&&S!=="showdown"&&S!=="hand_over"){W=!0,f.textContent="한 명 이상 올인 상태. 남은 커뮤니티 카드를 순차적으로 공개합니다...",we.style.display="none";const e=800;(S==="preflop"||E.length<3)&&(N.length>0&&E.length===0&&q(1),await fe(3-E.length),S="flop",W&&w&&await new Promise(a=>setTimeout(a,e))),W&&w&&E.length<4&&(N.length>0&&q(1),await fe(1),S="turn",W&&w&&await new Promise(a=>setTimeout(a,e))),W&&w&&E.length<5&&(N.length>0&&q(1),await fe(1),S="river",W&&w&&await new Promise(a=>setTimeout(a,e/2))),W=!1,S="showdown",await At();return}switch(S){case"preflop":S="flop",N.length>0&&q(1),await fe(3),f.textContent="플랍 카드 (3장)가 공개되었습니다.";break;case"flop":S="turn",N.length>0&&q(1),await fe(1),f.textContent="턴 카드 (4번째)가 공개되었습니다.";break;case"turn":S="river",N.length>0&&q(1),await fe(1),f.textContent="리버 카드 (5번째)가 공개되었습니다.";break;case"river":S="showdown";break;default:if(!(S==="showdown"||S==="hand_over"))return}if(S==="showdown")await At();else if(w){if(de==="ai"?$=n.isFolded||n.isAllIn?"ai":"human":$=i.isFolded||i.isAllIn?"human":"ai",$==="human"&&(n.isFolded||n.isAllIn)&&($="ai"),$==="ai"&&(i.isFolded||i.isAllIn)&&($="human"),(n.isFolded||n.isAllIn)&&(i.isFolded||i.isAllIn)){await At();return}const e=S==="flop"?"플랍":S==="turn"?"턴":"리버";$==="ai"?i.isFolded||i.isAllIn?await he():(f.textContent+=` AI의 턴입니다. (${e})`,setTimeout(ln,1e3)):n.isFolded||n.isAllIn?await he():f.textContent+=` 당신의 턴입니다. (${e})`,await ae()}}async function fe(t){let e=0;for(let a=0;a<t;a++){const l=q(1);if(l.length>0&&E.length<5)E.push(l[0]),e++;else{console.warn("덱에 카드가 부족하거나 커뮤니티 카드가 5장이라 카드를 더 딜할 수 없습니다.");break}}E.length>5&&(E=E.slice(0,5)),e>0&&await nn()}async function At(){var o,r;if((!n||!i)&&T==="solo_ai"){if(console.warn("Showdown called without players."),S==="hand_over")return;await ze();return}W=!1,we.style.display="none",S="showdown",f.textContent="쇼다운!",w=!1,await tn(!0);const t=n&&!n.isFolded?xe(n.holeCards,E):{name:"Folded",rankValue:-1,detailedName:"폴드"},e=i&&!i.isFolded?xe(i.holeCards,E):{name:"Folded",rankValue:-1,detailedName:"폴드"};let a=null,l="";if(n&&n.isFolded)a=i,l=`당신 폴드. AI 승리 (${i?Qe(e.name)+(e.detailedName&&e.name!==e.detailedName?" - "+e.detailedName:""):"N/A"}).`;else if(i&&i.isFolded)a=n,l=`AI 폴드. 당신 승리 (${n?Qe(t.name)+(t.detailedName&&t.name!==t.detailedName?" - "+t.detailedName:""):"N/A"}).`;else if(n&&i){const d=ft(t,e);if(d===t&&t.rankValue>e.rankValue)a=n;else if(d===e&&e.rankValue>e.rankValue)a=i;else{const R=((o=t.bestHandCards)==null?void 0:o.map(p=>p.value).sort((p,g)=>g-p))||[],A=((r=e.bestHandCards)==null?void 0:r.map(p=>p.value).sort((p,g)=>g-p))||[];let k=t.rankValue===e.rankValue;if(k)for(let p=0;p<Math.min(R.length,A.length);p++){if(R[p]>A[p]){a=n,k=!1;break}if(A[p]>R[p]){a=i,k=!1;break}}k?a="split":a||(a=d===t?n:i)}l=`당신: ${Qe(t.name)}${t.detailedName&&t.name!==t.detailedName?` (${t.detailedName})`:""}. AI: ${Qe(e.name)}${e.detailedName&&e.name!==e.detailedName?` (${e.detailedName})`:""}. `,a===n?l+="당신 승리!":a===i?l+="AI 승리!":l+="무승부 (팟 분배)!"}else l="쇼다운 오류: 플레이어 정보 누락.";f.textContent=l,mt(a),await ze()}function mt(t){if(n==null||n.chips,i==null||i.chips,t==="split"&&n&&i){const e=Math.floor(z/2),a=z%2;n.chips+=e,i.chips+=e,a>0&&(de==="human"&&i?i.chips+=a:n&&(n.chips+=a)),f.textContent+=` 각각 ${e} 칩 획득.`}else t&&t!=="split"&&t.name&&(t.chips+=z,f.textContent+=` ${t.name===(n==null?void 0:n.name)?"당신":"AI"}이(가) 팟 ${z}을(를) 획득했습니다.`);z=0,n&&(n.currentBetInRound=0),i&&(i.currentBetInRound=0),T==="solo_ai"&&G==="marathon"&&i&&i.chips===0&&n&&n.chips>0?le>=10?(f.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.',n&&(ce(K+n.chips),n.chips=0)):(le++,f.textContent=`AI 파산! 마라톤 레벨 ${le}(으)로 진입합니다. AI 칩이 초기화됩니다.`,i.chips=ea):T==="solo_ai"&&G==="impossible"&&n&&i&&i.chips<=0&&(f.textContent+=" AI가 모든 칩을 잃었습니다! 당신의 압도적인 승리!",n&&(ce(K+n.chips),n.chips=0)),an()}async function ze(){w=!1,S="hand_over",$=null,W=!1,n&&(n.lastAction="none"),i&&(i.lastAction="none"),await ae(),n&&i&&(n.chips===0||i.chips===0&&G!=="marathon")?(n.chips>0&&i.chips===0?(ce(K+n.chips),n.chips=0):n.chips===0?ce(K):G==="marathon"&&i.chips===0&&le>10,_.disabled=!1,_.style.display="inline-block",ee.style.display="none",Ie.style.display="none"):G==="marathon"&&i&&i.chips>0&&n&&n.chips===0&&(f.textContent="당신의 칩이 모두 소진되었습니다. 마라톤 실패!",ce(K),_.disabled=!1,_.style.display="inline-block",ee.style.display="none",Ie.style.display="none")}async function fa(){T==="practice"&&(w=!0,qe.clear(),Ue.clear(),N=Kt(),N=nt(N),n&&(n.holeCards=q(2),n.currentBetInRound=0,n.isFolded=!1,n.lastAction="none"),E=[],z=0,f.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",await ae(),_.disabled=!0,_.style.display="none")}async function ui(){T!=="practice"||E.length!==0||(N.length>0&&q(1),await fe(3),f.textContent="플랍 카드 (3장)가 공개되었습니다.",await ae())}async function hi(){T!=="practice"||E.length!==3||(N.length>0&&q(1),await fe(1),f.textContent="턴 카드 (4번째)가 공개되었습니다.",await ae())}async function fi(){T!=="practice"||E.length!==4||(N.length>0&&q(1),await fe(1),f.textContent="리버 카드 (5번째)가 공개되었습니다.",await ae())}async function mi(){if(T!=="practice"||!n||n.holeCards.length===0||E.length<5){f.textContent="아직 카드가 충분하지 않습니다. 딜을 완료해주세요.";return}const t=xe(n.holeCards,E),e=Qe(t.name);f.textContent=`최고의 패: ${e}${t.detailedName&&t.name!==t.detailedName?` (${t.detailedName})`:""}`,w=!1,await ae(),_.disabled=!1,_.style.display="inline-block"}function pi(){Fn.innerHTML="",Zn.forEach(t=>{const e=document.createElement("li"),a=document.createElement("strong");a.textContent=`${t.kor} (${t.eng})`,e.appendChild(a);const l=document.createElement("div");l.classList.add("ranking-details-wrapper");const o=document.createElement("div");o.classList.add("ranking-example-cards"),t.exampleCards.forEach((d,R)=>{const A=t.highlightIndices?t.highlightIndices.includes(R):!1;o.appendChild(ht(d,!0,A))}),l.appendChild(o);const r=document.createElement("p");r.classList.add("ranking-description"),r.textContent=t.desc,l.appendChild(r),e.appendChild(l),Fn.appendChild(e)})}function yi(){pi(),ut.style.display="block",ia.focus()}function ma(){ut.style.display="none",aa.focus()}function Ii(){sn(!0),Xt.style.display="block",Pt.checked=!0,Vt.style.display="none",sa.value="1000",la.value="marathon",Pt.focus(),Ne()}function on(){Xt.style.display="none",_.focus()}function pa(){Yt.checked?Vt.style.display="block":Vt.style.display="none"}async function Ai(){const t=Yt.checked?"solo_ai":"practice";let e=0;if(t==="solo_ai"){if(e=parseInt(sa.value,10),isNaN(e)||e<=0){alert("유효한 칩 금액을 선택해주세요.");return}if(K<e){alert(`보유 칩이 부족합니다. (현재 보유: ${K}, 필요: ${e})`);return}K-=e,ce(K),Ne(),ea=e,G=la.value,G==="marathon"&&(le=1),de="ai",H=Math.max(10,Math.floor(e/100/5)*5),H===0&&e>0&&(H=5),Te=Math.max(5,Math.floor(H/2)),Te===0&&H>0&&(Te=Math.max(1,Math.floor(H/2)))}else e=0,Te=zt,H=$e;if(T=t,n={name:"나",holeCards:[],chips:e,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"human",hasActedThisRound:!1},t==="solo_ai"){let a=e;G==="impossible"&&(a=Math.floor(e/10),a=Math.max(a,H*5,50)),i={name:"AI 상대",holeCards:[],chips:a,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"ai",hasActedThisRound:!1}}else i=null;na.style.display="flex",on(),t==="solo_ai"?await da():await fa(),_.disabled=!0,_.style.display="none",ee.style.display=t==="solo_ai"?"inline-block":"none"}function gi(){const t=localStorage.getItem(ta);t?K=parseInt(t,10):(K=1e5,ce(K)),Ne()}function ce(t){K=Math.min(t,Wa),K=Math.max(0,K),localStorage.setItem(ta,String(K)),Ne()}function Ne(){bn&&(bn.textContent=K.toLocaleString())}function ki(){Zt.style.display="block",oa.focus()}function rn(){Zt.style.display="none",ee.focus()}async function Ci(){n&&T==="solo_ai"&&ce(K+n.chips),sn(!0),rn(),_.style.display="inline-block",ee.style.display="none",f.textContent='게임이 종료되었습니다. "새 게임 설정"으로 다시 시작하세요.',Ne()}_.addEventListener("click",Ii);ee.addEventListener("click",ki);oa.addEventListener("click",Ci);ei.addEventListener("click",rn);Ya.addEventListener("click",on);Pt.addEventListener("change",pa);Yt.addEventListener("change",pa);Za.addEventListener("click",Ai);Ft.addEventListener("click",fa);St.addEventListener("click",ui);Lt.addEventListener("click",hi);Tt.addEventListener("click",fi);Dt.addEventListener("click",mi);Nt.addEventListener("click",si);Ht.addEventListener("click",li);Le.addEventListener("click",oi);ge.addEventListener("click",di);_t.addEventListener("click",ri);Ie.addEventListener("click",da);Be.addEventListener("input",ca);aa.addEventListener("click",yi);ia.addEventListener("click",ma);window.addEventListener("keydown",t=>{t.key==="Escape"&&(ut.style.display==="block"&&ma(),Xt.style.display==="block"&&on(),Zt.style.display==="block"&&rn())});document.addEventListener("DOMContentLoaded",()=>{gi(),sn(!0),Ot(),ae(),f.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.'});
