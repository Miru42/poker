(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */console.log("Poker Script v1.2.3 Loaded - Impossible AI with Future Sight.");const Yn=["♠","♥","♣","♦"],In=[{rank:"2",value:2},{rank:"3",value:3},{rank:"4",value:4},{rank:"5",value:5},{rank:"6",value:6},{rank:"7",value:7},{rank:"8",value:8},{rank:"9",value:9},{rank:"10",value:10},{rank:"J",value:11},{rank:"Q",value:12},{rank:"K",value:13},{rank:"A",value:14}],yn=[{kor:"로열 플러시",eng:"Royal Flush",desc:"A, K, Q, J, 10 (모두 같은 무늬)",exampleCards:[{suit:"♥",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♥",rank:"Q",value:12},{suit:"♥",rank:"J",value:11},{suit:"♥",rank:"10",value:10}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트 플러시",eng:"Straight Flush",desc:"연속된 숫자 5장 (모두 같은 무늬, 로열 플러시 제외)",exampleCards:[{suit:"♠",rank:"9",value:9},{suit:"♠",rank:"8",value:8},{suit:"♠",rank:"7",value:7},{suit:"♠",rank:"6",value:6},{suit:"♠",rank:"5",value:5}],highlightIndices:[0,1,2,3,4]},{kor:"포 카드",eng:"Four of a Kind",desc:"같은 숫자 4장 + 아무 카드 1장",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"A",value:14},{suit:"♣",rank:"A",value:14},{suit:"♠",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"풀 하우스",eng:"Full House",desc:"같은 숫자 3장 + 같은 숫자 2장 (트리플 + 원 페어)",exampleCards:[{suit:"♥",rank:"K",value:13},{suit:"♠",rank:"K",value:13},{suit:"♦",rank:"K",value:13},{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12}],highlightIndices:[0,1,2,3,4]},{kor:"플러시",eng:"Flush",desc:"무늬가 같은 카드 5장 (숫자는 연속되지 않음)",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♦",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♦",rank:"5",value:5},{suit:"♦",rank:"2",value:2}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트",eng:"Straight",desc:"연속된 숫자 5장 (무늬는 달라도 됨)",exampleCards:[{suit:"♠",rank:"10",value:10},{suit:"♥",rank:"9",value:9},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"7",value:7},{suit:"♥",rank:"6",value:6}],highlightIndices:[0,1,2,3,4]},{kor:"트리플",eng:"Three of a Kind",desc:"같은 숫자 3장 + 서로 다른 숫자 2장",exampleCards:[{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12},{suit:"♠",rank:"Q",value:12},{suit:"♦",rank:"A",value:14},{suit:"♣",rank:"K",value:13}],highlightIndices:[0,1,2]},{kor:"투 페어",eng:"Two Pair",desc:"같은 숫자 2장 + 같은 숫자 2장 + 아무 카드 1장",exampleCards:[{suit:"♥",rank:"J",value:11},{suit:"♠",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"8",value:8},{suit:"♥",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"원 페어",eng:"One Pair",desc:"같은 숫자 2장 + 서로 다른 숫자 3장",exampleCards:[{suit:"♥",rank:"10",value:10},{suit:"♠",rank:"10",value:10},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♥",rank:"9",value:9}],highlightIndices:[0,1]},{kor:"하이 카드",eng:"High Card",desc:"위 족보에 해당하지 않는 경우, 가장 높은 숫자의 카드로 결정",exampleCards:[{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♣",rank:"9",value:9}],highlightIndices:[0]}],Lt=10,pe=20;let Je=Lt,W=pe,j=[],x=[],T=null,a=null,r=null,O=0,X=null,ae=1,se="ai",D="pre_deal",v=null,g=0,K=pe,M=!1,Z=null,An=1e3;const gn=document.getElementById("game-board"),Jt=document.getElementById("player-hole-cards"),Ut=document.getElementById("community-cards"),h=document.getElementById("message-area"),Wt=document.getElementById("player-coins-display"),qt=document.getElementById("player-action-display"),Zn=document.getElementById("dealer-chip-player"),Pe=document.getElementById("ai-player-area"),jt=document.getElementById("ai-name"),zt=document.getElementById("ai-coins-display"),Xt=document.getElementById("ai-action-display"),ea=document.getElementById("dealer-chip-ai"),Yt=document.getElementById("ai-hole-cards"),ta=document.getElementById("pot-amount"),le=document.getElementById("marathonLevelDisplay"),na=document.getElementById("player-action-animation"),aa=document.getElementById("ai-action-animation"),Q=document.getElementById("setup-game-button"),Ke=document.getElementById("practice-mode-actions"),dt=document.getElementById("deal-new-hand-practice-button"),ut=document.getElementById("deal-flop-button"),ct=document.getElementById("deal-turn-button"),ft=document.getElementById("deal-river-button"),ht=document.getElementById("deal-fifth-street-button"),mt=document.getElementById("evaluate-button"),Ve=document.getElementById("player-betting-actions"),pt=document.getElementById("foldButton"),It=document.getElementById("checkButton"),ve=document.getElementById("callButton"),de=document.getElementById("confirmBetButton"),ge=document.getElementById("startNextHandButton"),he=document.getElementById("betPercentageSlider"),Zt=document.getElementById("betPercentageValue"),ot=document.getElementById("calculatedBetAmountDisplay"),yt=document.getElementById("allInButton"),kn=document.getElementById("show-rankings-button"),Ze=document.getElementById("rankings-modal"),Cn=Ze.querySelector(".close-button"),en=document.getElementById("hand-rankings-list"),St=document.getElementById("game-setup-modal"),ia=document.getElementById("close-setup-modal-button"),At=document.getElementById("gameModePractice"),Dt=document.getElementById("gameModeSoloAI"),gt=document.getElementById("solo-ai-options"),Bn=document.getElementById("startingCoinsSelect"),$n=document.getElementById("aiDifficultySelect"),sa=document.getElementById("start-configured-game-button");let Me=null,Fe=null;function Ie(t,e){const n=t==="human"?na:aa;if(!n)return;t==="human"&&Me?clearTimeout(Me):t==="ai"&&Fe&&clearTimeout(Fe),n.textContent=e,n.classList.remove("show"),n.offsetWidth,n.classList.add("show");const l=window.setTimeout(()=>{n.classList.remove("show"),t==="human"&&Me===l?Me=null:t==="ai"&&Fe===l&&(Fe=null)},1800);t==="human"?Me=l:Fe=l}function bn(){const t=[];for(const e of Yn)for(const n of In)t.push({suit:e,rank:n.rank,value:n.value});return t}function vn(t){const e=[...t];for(let n=e.length-1;n>0;n--){const l=Math.floor(Math.random()*(n+1));[e[n],e[l]]=[e[l],e[n]]}return e}function Ce(t){return j.length<t?(h.textContent="덱에 카드가 부족합니다!",console.error("Deck depleted. Requested:",t,"Available:",j.length),j.splice(0,j.length)):j.splice(0,t)}function et(t,e=!1,n=!1,l=!1){const s=document.createElement("div");s.classList.add("card"),e&&s.classList.add("example-card"),n&&s.classList.add("highlighted-card-component"),l?(s.classList.add("face-down"),s.setAttribute("aria-label","숨겨진 카드")):(t.suit==="♥"?s.classList.add("hearts"):t.suit==="♦"?s.classList.add("diamonds"):t.suit==="♣"?s.classList.add("clubs"):t.suit==="♠"&&s.classList.add("spades"),s.setAttribute("aria-label",`${t.rank==="10"?"10":te(t.value)} ${la(t.suit)}`));const o=document.createElement("span");o.classList.add("rank"),o.textContent=t.rank;const u=document.createElement("span");return u.classList.add("suit"),u.textContent=t.suit,s.appendChild(o),s.appendChild(u),s.setAttribute("role","img"),s}function la(t){switch(t){case"♠":return"스페이드";case"♥":return"하트";case"♣":return"클럽";case"♦":return"다이아몬드";default:return""}}function Rn(){Jt.innerHTML="",a&&a.holeCards&&a.holeCards.forEach(t=>{Jt.appendChild(et(t))})}function Nt(t=!1){Yt.innerHTML="",r&&r.holeCards&&r.holeCards.forEach(e=>{Yt.appendChild(et(e,!1,!1,!t&&!r.isAllIn))})}function Ue(){Ut.innerHTML="",x.forEach(t=>{Ut.appendChild(et(t))})}function oa(){ta.textContent=String(O)}function Ht(){a?(Wt.textContent=`코인: ${a.coins}`,qt.textContent=a.lastAction&&a.lastAction!=="none"?`(${He(a.lastAction)}${a.currentBetInRound>0&&a.lastAction!=="blind"?" "+a.currentBetInRound:""})`:""):(Wt.textContent="코인: 0",qt.textContent=""),r?(jt.textContent=X==="marathon"?`AI 상대 (레벨 ${ae})`:"AI 상대 (불가능)",zt.textContent=`코인: ${r.coins}`,Xt.textContent=r.lastAction&&r.lastAction!=="none"?`(${He(r.lastAction)}${r.currentBetInRound>0&&r.lastAction!=="blind"?" "+r.currentBetInRound:""})`:"",le.textContent=X==="marathon"?`레벨: ${ae}`:"",le.style.display=X==="marathon"&&T==="solo_ai"?"inline":"none"):(jt.textContent="AI 상대",zt.textContent="코인: 0",Xt.textContent="",le.style.display="none"),oa(),ra()}function ra(){Zn.style.display=T==="solo_ai"&&se==="human"?"flex":"none",ea.style.display=T==="solo_ai"&&se==="ai"?"flex":"none"}function te(t){const e=In.find(n=>n.value===t);return e?e.rank==="A"?"에이스":e.rank==="K"?"킹":e.rank==="Q"?"퀸":e.rank==="J"?"잭":e.rank:String(t)}function Le(t){const e=yn.find(n=>n.eng===t);return e?e.kor:t}function He(t){switch(t){case"fold":return"폴드";case"check":return"체크";case"call":return"콜";case"bet":return"벳";case"raise":return"레이즈";case"blind":return"블라인드";default:return""}}function da(t){if(t.length!==5)throw new Error("패는 반드시 5장의 카드로 구성되어야 합니다.");const e=[...t].sort((c,f)=>c.value-f.value),n=e.map(c=>c.value),l=e.map(c=>c.suit),s={};n.forEach(c=>s[c]=(s[c]||0)+1);const o=Object.values(s).sort((c,f)=>f-c),u=Object.keys(s).map(Number).sort((c,f)=>f-c),w=new Set(l).size===1;let $=!1,B=0;const b=[...new Set(n)].sort((c,f)=>c-f);if(b.length>=5){for(let c=b.length-1;c>=4;c--)if(b[c]-b[c-4]===4){$=!0,B=b[c];break}}!$&&b.includes(14)&&b.includes(2)&&b.includes(3)&&b.includes(4)&&b.includes(5)&&($=!0,B=5);let C=e;if($&&B===5){const c=e.find(p=>p.value===14),f=e.filter(p=>p.value!==14).sort((p,A)=>p.value-A.value);C=[c,...f.filter(p=>p.value<=5)]}if($&&w){const c=B;return c===14?{name:"Royal Flush",rankValue:10,detailedName:"로열 플러시",bestHandCards:C}:{name:"Straight Flush",rankValue:9,detailedName:`${te(c)}-high 스트레이트 플러시`,bestHandCards:C}}if(o[0]===4)return{name:"Four of a Kind",rankValue:8,detailedName:`포 카드, ${te(u.find(f=>s[f]===4))}s`,bestHandCards:e};if(o[0]===3&&o[1]===2){const c=te(u.find(p=>s[p]===3)),f=te(u.find(p=>s[p]===2));return{name:"Full House",rankValue:7,detailedName:`풀 하우스, ${c}s over ${f}s`,bestHandCards:e}}if(w)return{name:"Flush",rankValue:6,detailedName:`${te(e[e.length-1].value)}-high 플러시`,bestHandCards:e};if($)return{name:"Straight",rankValue:5,detailedName:`${te(B)}-high 스트레이트`,bestHandCards:C};if(o[0]===3)return{name:"Three of a Kind",rankValue:4,detailedName:`트리플, ${te(u.find(f=>s[f]===3))}s`,bestHandCards:e};if(o[0]===2&&o[1]===2){const c=te(u.filter(p=>s[p]===2).sort((p,A)=>A-p)[0]),f=te(u.filter(p=>s[p]===2).sort((p,A)=>A-p)[1]);return{name:"Two Pair",rankValue:3,detailedName:`투 페어, ${c}s and ${f}s`,bestHandCards:e}}return o[0]===2?{name:"One Pair",rankValue:2,detailedName:`원 페어, ${te(u.find(f=>s[f]===2))}s`,bestHandCards:e}:{name:"High Card",rankValue:1,detailedName:`하이 카드, ${te(e[e.length-1].value)}`,bestHandCards:e}}function We(t,e){if(e===0)return[[]];if(e>t.length)return[];if(e===t.length)return[t];const[n,...l]=t,s=We(l,e);return[...We(l,e-1).map(u=>[n,...u]),...s]}function Se(t,e){if(t.rankValue>e.rankValue)return t;if(e.rankValue>t.rankValue)return e;if(!t.bestHandCards||!e.bestHandCards)return t.rankValue>=e.rankValue?t:e;const n=o=>{if(!o.bestHandCards)return 0;const u=o.bestHandCards.map(w=>w.value).sort((w,$)=>$-w);return(o.name==="Straight"||o.name==="Straight Flush")&&u.includes(14)&&u.includes(5)&&u.includes(4)&&u.includes(3)&&u.includes(2)?5:u[0]};if((t.name==="Straight"||t.name==="Straight Flush")&&(e.name==="Straight"||e.name==="Straight Flush")){const o=n(t),u=n(e);return o>u?t:u>o?e:t}const l=t.bestHandCards.map(o=>o.value).sort((o,u)=>u-o),s=e.bestHandCards.map(o=>o.value).sort((o,u)=>u-o);for(let o=0;o<Math.min(l.length,s.length);o++){if(l[o]>s[o])return t;if(s[o]>l[o])return e}return t}function xe(t,e){const n=[...t,...e];if(n.length<5)return{name:"카드가 부족합니다",rankValue:0,detailedName:"패를 확인하려면 최소 5장의 카드가 필요합니다."};const l=We(n,5);let s=null;for(const o of l){const u=da(o);s?s=Se(s,u):s=u}return s||{name:"오류",rankValue:0,detailedName:"패를 평가할 수 없습니다."}}function xn(t=!0){t&&(gn.style.display="none",Pe.style.display="none",T=null,a=null,r=null,X=null,M=!1,h.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.',Je=Lt,W=pe,ae=1,le.style.display="none"),a&&(a.holeCards=[],a.currentBetInRound=0,a.isFolded=!1,a.isAllIn=!1,a.lastAction="none",a.hasActedThisRound=!1),r&&(r.holeCards=[],r.currentBetInRound=0,r.isFolded=!1,r.isAllIn=!1,r.lastAction="none",r.hasActedThisRound=!1),x=[],O=0,g=0,K=T==="solo_ai"?W:pe,v=null,D="pre_deal",Z=null,Rn(),Nt(),Ue(),Ht(),Q.disabled=!1,Q.style.display="inline-block",Ke.style.display="none",Ve.style.display="none",ge.style.display="none"}function _(){T==="practice"?(Ke.style.display="flex",Ve.style.display="none",ge.style.display="none",Pe.style.display="none",le.style.display="none",dt.style.display=a?"inline-block":"none",ut.style.display=a&&a.holeCards.length>0&&x.length===0?"inline-block":"none",ct.style.display=x.length===2?"inline-block":"none",ft.style.display=x.length===3?"inline-block":"none",ht.style.display=x.length===4?"inline-block":"none",mt.style.display=x.length===5?"inline-block":"none",dt.disabled=M&&a&&a.holeCards.length>0,ut.disabled=!(a&&a.holeCards.length>0&&x.length===0),ct.disabled=x.length!==2,ft.disabled=x.length!==3,ht.disabled=x.length!==4,mt.disabled=x.length!==5):T==="solo_ai"?(Ke.style.display="none",Ve.style.display=M&&v==="human"?"flex":"none",ge.style.display=!M&&a&&r&&a.coins>0&&r.coins>0?"inline-block":"none",Pe.style.display="block",X==="marathon"?(le.style.display="inline",le.textContent=`레벨: ${ae}`):le.style.display="none",M&&v==="human"&&Mn()):(Ke.style.display="none",Ve.style.display="none",ge.style.display="none",Pe.style.display="none",le.style.display="none"),Ht(),Rn(),Nt(),Ue(),!M&&a&&r&&(a.coins===0||r.coins===0)&&(X==="marathon"&&r.coins===0&&a.coins>0&&ae<=10||(a.coins===0&&r.coins===0?h.textContent="무승부! 양쪽 플레이어 모두 코인이 없습니다.":a.coins===0?h.textContent="AI 승리! 당신의 코인이 모두 소진되었습니다.":r.coins===0&&(h.textContent="당신 승리! AI의 코인이 모두 소진되었습니다."),Q.disabled=!1,Q.style.display="inline-block",ge.style.display="none"))}function kt(){if(!a||T!=="solo_ai"||v!=="human"||!M){he.disabled=!0,Zt.textContent="-",ot.textContent="(금액: -)";return}he.disabled=a.isAllIn;const t=parseInt(he.value);if(Zt.textContent=`${t}%`,a.coins>0){const e=Math.min(a.coins,Math.max(1,Math.floor(a.coins*(t/100))));ot.textContent=`(금액: ${e})`}else ot.textContent="(금액: 0)"}function En(){if(!a||T==="solo_ai"&&!r){h.textContent="플레이어 정보가 없습니다. 게임을 먼저 설정하세요.";return}if(X==="marathon"&&ae>10){h.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.',M=!1,ge.style.display="none",Q.disabled=!1,Q.style.display="inline-block",_();return}if(a.coins===0||r&&r.coins===0&&!(X==="marathon"&&ae<=10)){h.textContent="게임 종료. 한 플레이어의 코인이 없습니다. '새 게임 설정'으로 다시 시작하세요.",_();return}if(M=!0,j=bn(),j=vn(j),a.holeCards=[],a.currentBetInRound=0,a.isFolded=!1,a.isAllIn=!1,a.lastAction="none",a.hasActedThisRound=!1,r&&(r.holeCards=[],r.currentBetInRound=0,r.isFolded=!1,r.isAllIn=!1,r.lastAction="none",r.hasActedThisRound=!1),x=[],O=0,Z=null,T==="solo_ai"?(se=se==="human"?"ai":"human",K=W):K=pe,a.holeCards=Ce(2),r&&(r.holeCards=Ce(2)),T==="solo_ai"&&r){D="preflop";const t=se==="human"?a:r,e=se==="human"?r:a;tn(t,Je),tn(e,W),g=W,Z=e.seat,v=se==="human"?"human":"ai"}else T==="practice"&&(h.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",D="pre_deal");if(_(),Q.disabled=!0,Q.style.display="none",T==="solo_ai"&&v==="ai"&&r&&!r.isFolded&&!r.isAllIn&&M){const t=`AI의 턴입니다. (${D==="preflop"?"프리플랍":"플랍 전"})`;h.textContent=t,setTimeout($e,1200)}else T==="solo_ai"&&v==="human"&&a&&!a.isFolded&&!a.isAllIn&&M&&(h.textContent=`당신의 턴입니다. (${D==="preflop"?"프리플랍":"플랍 전"})`)}function tn(t,e,n){const l=Math.min(t.coins,e);t.coins-=l,t.currentBetInRound=l,O+=l,t.lastAction="blind",t.coins===0&&(t.isAllIn=!0)}function Mn(){if(T!=="solo_ai"||!a||!M||v!=="human"){pt.disabled=!0,It.disabled=!0,ve.disabled=!0,de.disabled=!0,yt.disabled=!0,he.disabled=!0,kt();return}kt(),pt.disabled=a.isAllIn,yt.disabled=a.isAllIn;const t=a.currentBetInRound===g&&!a.isAllIn;It.disabled=!t;const e=g-a.currentBetInRound;if(ve.disabled=!(e>0&&!a.isAllIn),e>0?ve.textContent=a.coins>e?`콜 (${e})`:`올인 콜 (${a.coins})`:ve.textContent="콜",a.isAllIn&&(ve.disabled=!0),de.disabled=a.isAllIn,he.disabled=a.isAllIn,a.isAllIn)de.textContent="올인됨",de.disabled=!0;else{const n=parseInt(he.value),l=Math.min(a.coins,Math.max(1,Math.floor(a.coins*(n/100)))),s=g>0,o=a.currentBetInRound+l;let u=!1;s?(de.textContent="레이즈",(l===a.coins||o>=g+K)&&(u=!0)):(de.textContent="벳",(l===a.coins||o>=W)&&(u=!0)),de.disabled=!u||l===0||l>a.coins}}function ua(){!a||v!=="human"||!M||a.isFolded||(a.isFolded=!0,a.lastAction="fold",Ie("human","폴드"),h.textContent="당신은 폴드했습니다.",M=!1,r&&tt(r),nt())}function ca(){if(!(!a||v!=="human"||!M||a.isAllIn)){if(a.currentBetInRound<g){h.textContent="체크할 수 없습니다. 현재 벳에 콜하거나 레이즈해야 합니다.";return}a.lastAction="check",a.hasActedThisRound=!0,Ie("human","체크"),h.textContent="당신은 체크했습니다.",v="ai",_(),setTimeout($e,1e3)}}function fa(){if(!a||v!=="human"||!M||a.isAllIn)return;const t=g-a.currentBetInRound;if(t<=0){h.textContent="콜할 금액이 없습니다. 체크하거나 벳/레이즈 하세요.";return}const e=Math.min(t,a.coins);a.coins-=e,O+=e,a.currentBetInRound+=e,a.lastAction="call",a.hasActedThisRound=!0,a.coins===0?(a.isAllIn=!0,h.textContent=`당신은 올인 콜했습니다 (총 ${a.currentBetInRound}).`,Ie("human",`올인 콜 (${e})`)):(h.textContent=`당신은 ${e}을 콜했습니다. (총 ${a.currentBetInRound})`,Ie("human",`콜 (${e})`)),v="ai",_(),setTimeout($e,1e3)}function ha(){if(!a||v!=="human"||!M||a.isAllIn)return;const t=a.coins;if(t<=0)return;const e=a.currentBetInRound+t;a.coins=0,O+=t,a.currentBetInRound=e,a.isAllIn=!0;const n=e>g,l=e===g&&g>0,s=g===0&&e>0;n?(a.lastAction="raise",Z="human",K=e-g,g=e,h.textContent=`당신은 올인 레이즈하여 총 ${e}(으)로 만들었습니다!`):l?(a.lastAction="call",h.textContent=`당신은 올인 콜하여 총 ${e}을 맞췄습니다!`):s?(a.lastAction="bet",Z="human",g=e,K=e,h.textContent=`당신은 올인 (${e}) 벳했습니다!`):(a.lastAction="call",h.textContent=`당신은 올인 (${t}) 했습니다. 총 ${e}.`),Ie("human",`올인 (${t})`),a.hasActedThisRound=!0,v="ai",_(),setTimeout($e,1e3)}function ma(){if(!a||v!=="human"||!M||a.isAllIn)return;let t=0;if(a.coins>0){const l=parseInt(he.value);t=Math.min(a.coins,Math.max(1,Math.floor(a.coins*(l/100))))}if(t<=0){h.textContent="벳할 금액이 없습니다.";return}if(t>a.coins){h.textContent="코인이 부족합니다.";return}const e=g>0,n=a.currentBetInRound+t;if(e){if(t<a.coins&&n<g+K){h.textContent=`최소 레이즈는 총 ${g+K}이 되도록 해야 합니다. (현재 베팅액에서 ${K} 만큼 더 필요). 또는 올인하세요.`;return}}else{const l=T==="solo_ai"?W:pe;if(t<a.coins&&n<l){h.textContent=`최소 벳 금액은 ${l} 입니다. 또는 올인하세요.`;return}}a.coins-=t,O+=t,a.currentBetInRound=n,a.lastAction=e?"raise":"bet",a.hasActedThisRound=!0,a.coins===0&&(a.isAllIn=!0),a.lastAction==="bet"?(g=n,K=n,Z="human"):a.lastAction==="raise"&&(K=n-g,g=n,Z="human"),h.textContent=`당신이 ${t}을(를) ${He(a.lastAction)}하여 총 ${n}(으)로 만들었습니다.`,Ie("human",`${He(a.lastAction)}: ${t}`),v="ai",_(),setTimeout($e,1e3)}function pa(t,e,n,l,s,o,u,w){if(t===10)return Fn(e,n,l,s,o,u,w);const $=s-e.currentBetInRound<=0,B=s-e.currentBetInRound,C=xe(e.holeCards,l).rankValue;if(t===1)if($){if(C>=2&&Math.random()<.3){const I=Math.min(e.coins,u);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else return C<2&&B>e.coins*.05&&Math.random()<.95?{type:"fold"}:C<3&&B>e.coins*.15&&Math.random()<.8?{type:"fold"}:e.coins<=B?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"};const U=.5,c=t/20,f=t/25,p=We(e.holeCards.concat(l),4).some(I=>new Set(I.map(S=>S.suit)).size===1&&I.length===4),A=[...new Set(e.holeCards.concat(l).map(I=>I.value))].sort((I,S)=>I-S);let y=!1;if(A.length>=4)for(let I=0;I<=A.length-4;I++)A[I+3]-A[I]===3&&(y=!0),A.includes(14)&&A.includes(2)&&A.includes(3)&&A.includes(4)&&I===0&&(y=!0);const H=p||y;if($){if(C>=4||H&&Math.random()<.6+f){const I=(Math.floor(Math.random()*(t*2))+5)*5;let S=Math.min(e.coins,Math.max(u,Math.floor(e.coins*(I/100))));if(S=Math.max(S,u),e.coins===S)return{type:"allin",amount:e.currentBetInRound+S};if(S>0)return{type:"bet",amount:e.currentBetInRound+S}}if(Math.random()<.2+c){const I=Math.min(e.coins,u);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else{if(C<2&&B>u*2&&Math.random()<U+.2-c)return{type:"fold"};if((C>=5||H&&Math.random()<.5+f)&&e.coins>B+o){const I=Math.min(e.coins+e.currentBetInRound,s+Math.max(o,u*(1+Math.floor(t/2))));return e.coins<=I-e.currentBetInRound?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"raise",amount:I}}return B>e.coins*(.4-c*.1)&&Math.random()<U-c?{type:"fold"}:e.coins<=B?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"}}}function Ia(t,e){const n=[...t],l=[...e],s=5-l.length;for(let o=0;o<s&&!(n.length===0||(n.length>0&&n.shift(),n.length===0));o++)l.push(n.shift());return l}function Fn(t,e,n,l,s,o,u){const w=[...j],$=Ia(w,n),B=xe(t.holeCards,$),b=xe(e.holeCards,$);let C="human_wins";if(B.rankValue>b.rankValue)C="ai_wins";else if(b.rankValue>B.rankValue)C="human_wins";else{const f=B.bestHandCards.map(y=>y.value).sort((y,H)=>H-y),p=b.bestHandCards.map(y=>y.value).sort((y,H)=>H-y);let A=!0;for(let y=0;y<5;y++){if(f[y]>p[y]){C="ai_wins",A=!1;break}if(p[y]>f[y]){C="human_wins",A=!1;break}}A&&(C="split")}const U=l-t.currentBetInRound<=0,c=l-t.currentBetInRound;if(C==="ai_wins"){if(e.isAllIn)return{type:t.coins<=c?"allin":"call",amount:t.currentBetInRound+Math.min(t.coins,c)};if(U){if(n.length<4&&Math.random()<.3)return{type:"check"};let f=Math.min(t.coins,Math.max(o,Math.floor(u*(.6+Math.random()*.4))));return f=Math.max(f,o),t.coins===f?{type:"allin",amount:t.currentBetInRound+f}:{type:"bet",amount:t.currentBetInRound+f}}else{if(c<=u*.5&&n.length<4&&Math.random()<.4)return t.coins<=c?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"};let f=.6+Math.random()*.6,p=Math.max(s,Math.floor(u*f)),A=c+p,y=Math.min(t.coins,A),H=t.currentBetInRound+y;return t.coins===y?{type:"allin",amount:H}:{type:"raise",amount:H}}}else return C==="human_wins"?U?{type:"check"}:{type:"fold"}:U?{type:"check"}:e.isAllIn||c<=o/2?t.coins<=c?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"}:{type:"fold"}}function $e(){if(!r||v!=="ai"||!M||!a){M||console.warn("triggerAIAction called but hand is not in progress.");return}if(h.textContent="AI가 생각 중...",_(),r.isFolded||r.isAllIn){r.hasActedThisRound=!0,qe();return}setTimeout(()=>{let t;X==="impossible"?t=Fn(r,a,x,g,K,W,O):X==="marathon"?t=pa(ae,r,a,x,g,K,W,O):(console.error("알 수 없는 AI 난이도:",X),t={type:"check"});let e=0,n="";switch(t.type){case"fold":r.isFolded=!0,r.lastAction="fold",n="AI 폴드",h.textContent="AI가 폴드했습니다.",Ie("ai",n),tt(a),nt();return;case"check":g-r.currentBetInRound>0?(e=Math.min(r.coins,g-r.currentBetInRound),r.lastAction="call",n=`AI 콜: ${e}`,h.textContent=`AI가 (강제) ${e}을 콜했습니다.`):(r.lastAction="check",n="AI 체크",h.textContent="AI가 체크했습니다.");break;case"call":e=Math.min(r.coins,g-r.currentBetInRound),e<0&&(e=0),r.lastAction="call",n=`AI 콜: ${e}`,h.textContent=`AI가 ${e}을 콜했습니다.`;break;case"bet":e=Math.min(r.coins,(t.amount||0)-r.currentBetInRound),e<0&&(e=0),e<W&&e<r.coins&&(e=Math.min(r.coins,W)),r.lastAction="bet",g=r.currentBetInRound+e,K=g,Z="ai",n=`AI 벳: ${e}`,h.textContent=`AI가 ${e}을 벳하여 총 ${g}(으)로 만들었습니다.`;break;case"raise":e=Math.min(r.coins,(t.amount||0)-r.currentBetInRound),e<0&&(e=0);const l=r.currentBetInRound+e;l<g+K&&e<r.coins?(e=Math.min(r.coins,g-r.currentBetInRound),e<0&&(e=0),r.lastAction="call",n=`AI 콜: ${e}`,h.textContent=`AI가 (잘못된 레이즈 시도 후) ${e}을 콜했습니다.`):(r.lastAction="raise",K=l-g,g=l,Z="ai",n=`AI 레이즈: ${e}`,h.textContent=`AI가 ${e}을 레이즈하여 총 ${g}(으)로 만들었습니다.`);break;case"allin":e=r.coins;const s=r.currentBetInRound+e;s>g?(r.lastAction=g===0?"bet":"raise",K=s-g,g=s,Z="ai",h.textContent=`AI가 올인 ${He(r.lastAction)} (${e}) 하여 총 ${g}(으)로 만들었습니다!`):(r.lastAction="call",h.textContent=`AI가 올인 콜 (${e}) 했습니다.`),n=`AI 올인 (${e})`;break}r.coins-=e,O+=e,r.currentBetInRound+=e,r.coins===0&&(r.isAllIn=!0),r.hasActedThisRound=!0,Ie("ai",n),qe()},1500)}function qe(){if(!a||!r||!M)return;const t=a,e=r,n=(t.hasActedThisRound||t.isAllIn||t.isFolded)&&(e.hasActedThisRound||e.isAllIn||e.isFolded),l=t.currentBetInRound===e.currentBetInRound||t.isAllIn||e.isAllIn||t.isFolded||e.isFolded;if(t.isFolded||e.isFolded){if(!M)return;const o=t.isFolded?e:t;tt(o),nt();return}let s=!1;if(n&&l)if(Z){const o=Z==="human"?e:t;(o.hasActedThisRound||o.isAllIn||o.isFolded)&&(s=!0)}else t.hasActedThisRound&&e.hasActedThisRound&&(s=!0);if(s){ya();return}if(v=v==="human"?"ai":"human",v==="human"){if(a.isFolded||a.isAllIn){v="ai",qe();return}h.textContent=`당신의 턴입니다. (${D})`,_()}else{if(r.isFolded||r.isAllIn){v="human",qe();return}_(),setTimeout($e,100)}}function ya(){if(!a||!r)return;if(a.currentBetInRound=0,r.currentBetInRound=0,a.hasActedThisRound=!1,r.hasActedThisRound=!1,g=0,K=T==="solo_ai"?W:pe,Z=null,(a.isAllIn||r.isAllIn)&&!(a.isFolded||r.isFolded)&&(a.isAllIn&&r.currentBetInRound>=a.currentBetInRound||r.isAllIn&&a.currentBetInRound>=r.currentBetInRound||a.isAllIn&&r.isAllIn)){h.textContent="한 명 이상 올인 상태. 남은 커뮤니티 카드를 모두 공개합니다.";const e=5-x.length;if(e>0){for(let n=0;n<e;n++){j.length>0&&Ce(1);const l=Ce(1);if(l.length>0)x.push(...l);else break}Ue()}D="showdown"}switch(D){case"preflop":D="flop",ce("flop",2),h.textContent="플랍 카드 (2장)가 공개되었습니다.";break;case"flop":D="turn",ce("turn",1),h.textContent="3번째 커뮤니티 카드가 공개되었습니다.";break;case"turn":D="river",ce("river",1),h.textContent="4번째 커뮤니티 카드가 공개되었습니다.";break;case"river":D="fifth_street",ce("fifth_street",1),h.textContent="5번째 커뮤니티 카드가 공개되었습니다.";break;case"fifth_street":D="showdown";break;default:if(D!=="showdown")return}if(Ue(),D==="showdown")nn();else if(M){if(se==="ai"?v=a.isFolded||a.isAllIn?"ai":"human":v=r.isFolded||r.isAllIn?"human":"ai",v==="human"&&(a.isFolded||a.isAllIn)&&(v="ai"),v==="ai"&&(r.isFolded||r.isAllIn)&&(v="human"),(a.isFolded||a.isAllIn)&&(r.isFolded||r.isAllIn)){nn();return}v==="ai"?(h.textContent+=` AI의 턴입니다. (${D})`,setTimeout($e,1e3)):h.textContent+=` 당신의 턴입니다. (${D})`,_()}}function ce(t,e){j.length>0&&Ce(1);const n=Ce(e);n.length>0?x.push(...n):console.warn(`덱에 카드가 부족하여 ${t}에 카드를 딜할 수 없습니다. (요청: ${e}, 딜됨: ${n.length})`),x.length>5&&(x=x.slice(0,5))}function nn(){if((!a||!r||!M&&D!=="showdown")&&D==="hand_over")return;D="showdown",h.textContent="쇼다운!",M=!1,Nt(!0);const t=a.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:xe(a.holeCards,x),e=r.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:xe(r.holeCards,x);let n=null,l="";if(a.isFolded)n=r,l=`당신 폴드. AI 승리 (${Le(e.name)}${e.detailedName&&e.name!==e.detailedName?" - "+e.detailedName:""}).`;else if(r.isFolded)n=a,l=`AI 폴드. 당신 승리 (${Le(t.name)}${t.detailedName&&t.name!==t.detailedName?" - "+t.detailedName:""}).`;else{const s=Se(t,e);s===t&&t.rankValue>e.rankValue?n=a:s===e&&e.rankValue>t.rankValue?n=r:Se(t,e)===t&&Se(e,t)===e?n="split":Se(t,e)===t?n=a:n=r,l=`당신: ${Le(t.name)}${t.detailedName&&t.name!==t.detailedName?" ("+t.detailedName+")":""}. AI: ${Le(e.name)}${e.detailedName&&e.name!==e.detailedName?" ("+e.detailedName+")":""}. `,n===a?l+="당신 승리!":n===r?l+="AI 승리!":l+="무승부 (팟 분배)!"}h.textContent=l,tt(n),nt()}function tt(t){if(t==="split"&&a&&r){const e=Math.floor(O/2);a.coins+=e,r.coins+=O-e,h.textContent+=` 각각 ${e} 코인 획득.`}else t&&t!=="split"&&(t.coins+=O,h.textContent+=` ${t.name}이(가) 팟 ${O}을(를) 획득했습니다.`);O=0,T==="solo_ai"&&X==="marathon"&&r&&r.coins===0&&a&&a.coins>0&&(ae++,ae>10?h.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.':(h.textContent=`AI 파산! 마라톤 레벨 ${ae}(으)로 진입합니다. AI 코인이 초기화됩니다.`,r.coins=An)),Ht()}function nt(){M=!1,D="hand_over",v=null,a&&(a.lastAction="none"),r&&(r.lastAction="none"),_()}function wn(){T==="practice"&&(M=!0,j=bn(),j=vn(j),a&&(a.holeCards=Ce(2),a.currentBetInRound=0,a.isFolded=!1,a.lastAction="none"),x=[],O=0,h.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",_(),Q.disabled=!0,Q.style.display="none")}function Aa(){T!=="practice"||x.length!==0||(ce("flop",2),h.textContent="플랍 카드 (2장)가 공개되었습니다.",_())}function ga(){T!=="practice"||x.length!==2||(ce("turn",1),h.textContent="3번째 커뮤니티 카드가 공개되었습니다.",_())}function ka(){T!=="practice"||x.length!==3||(ce("river",1),h.textContent="4번째 커뮤니티 카드가 공개되었습니다.",_())}function Ca(){T!=="practice"||x.length!==4||(ce("fifth_street",1),h.textContent="5번째 커뮤니티 카드가 공개되었습니다.",_())}function Ba(){if(T!=="practice"||!a||a.holeCards.length===0||x.length<5){h.textContent="아직 카드가 충분하지 않습니다. 딜을 완료해주세요.";return}const t=xe(a.holeCards,x),e=Le(t.name);h.textContent=`최고의 패: ${e}${t.detailedName&&t.name!==t.detailedName?` (${t.detailedName})`:""}`,M=!1,_(),Q.disabled=!1,Q.style.display="inline-block"}function $a(){en.innerHTML="",yn.forEach(t=>{const e=document.createElement("li"),n=document.createElement("strong");n.textContent=`${t.kor} (${t.eng})`,e.appendChild(n);const l=document.createElement("div");l.classList.add("ranking-details-wrapper");const s=document.createElement("div");s.classList.add("ranking-example-cards"),t.exampleCards.forEach((u,w)=>{const $=t.highlightIndices?t.highlightIndices.includes(w):!1;s.appendChild(et(u,!0,$))}),l.appendChild(s);const o=document.createElement("p");o.classList.add("ranking-description"),o.textContent=t.desc,l.appendChild(o),e.appendChild(l),en.appendChild(e)})}function ba(){$a(),Ze.style.display="block",Cn.focus()}function Tn(){Ze.style.display="none",kn.focus()}function va(){xn(!0),St.style.display="block",At.checked=!0,gt.style.display="none",Bn.value="1000",$n.value="marathon",At.focus()}function _t(){St.style.display="none",Q.focus()}function Ln(){Dt.checked?gt.style.display="block":gt.style.display="none"}function Ra(){const t=Dt.checked?"solo_ai":"practice";let e=0;if(t==="solo_ai"){if(e=parseInt(Bn.value,10),isNaN(e)){alert("유효한 코인 금액을 선택해주세요.");return}An=e,X=$n.value,X==="marathon"&&(ae=1),se="ai",W=Math.max(10,Math.floor(e/100)),Je=Math.max(5,Math.floor(W/2))}else Je=Lt,W=pe;T=t,a={name:"나",holeCards:[],coins:t==="solo_ai"?e:0,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"human",hasActedThisRound:!1},t==="solo_ai"?r={name:"AI 상대",holeCards:[],coins:e,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"ai",hasActedThisRound:!1}:r=null,gn.style.display="flex",_t(),t==="solo_ai"?En():wn(),Q.disabled=!0,Q.style.display="none"}Q.addEventListener("click",va);ia.addEventListener("click",_t);At.addEventListener("change",Ln);Dt.addEventListener("change",Ln);sa.addEventListener("click",Ra);dt.addEventListener("click",wn);ut.addEventListener("click",Aa);ct.addEventListener("click",ga);ft.addEventListener("click",ka);ht.addEventListener("click",Ca);mt.addEventListener("click",Ba);pt.addEventListener("click",ua);It.addEventListener("click",ca);ve.addEventListener("click",fa);de.addEventListener("click",ma);yt.addEventListener("click",ha);ge.addEventListener("click",En);he.addEventListener("input",Mn);kn.addEventListener("click",ba);Cn.addEventListener("click",Tn);window.addEventListener("keydown",t=>{t.key==="Escape"&&(Ze.style.display==="block"&&Tn(),St.style.display==="block"&&_t())});document.addEventListener("DOMContentLoaded",()=>{xn(!0),kt(),_(),h.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.'});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */console.log("Poker Script v1.2.3 Loaded - Impossible AI with Future Sight.");const xa=["♠","♥","♣","♦"],Sn=[{rank:"2",value:2},{rank:"3",value:3},{rank:"4",value:4},{rank:"5",value:5},{rank:"6",value:6},{rank:"7",value:7},{rank:"8",value:8},{rank:"9",value:9},{rank:"10",value:10},{rank:"J",value:11},{rank:"Q",value:12},{rank:"K",value:13},{rank:"A",value:14}],Dn=[{kor:"로열 플러시",eng:"Royal Flush",desc:"A, K, Q, J, 10 (모두 같은 무늬)",exampleCards:[{suit:"♥",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♥",rank:"Q",value:12},{suit:"♥",rank:"J",value:11},{suit:"♥",rank:"10",value:10}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트 플러시",eng:"Straight Flush",desc:"연속된 숫자 5장 (모두 같은 무늬, 로열 플러시 제외)",exampleCards:[{suit:"♠",rank:"9",value:9},{suit:"♠",rank:"8",value:8},{suit:"♠",rank:"7",value:7},{suit:"♠",rank:"6",value:6},{suit:"♠",rank:"5",value:5}],highlightIndices:[0,1,2,3,4]},{kor:"포 카드",eng:"Four of a Kind",desc:"같은 숫자 4장 + 아무 카드 1장",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"A",value:14},{suit:"♣",rank:"A",value:14},{suit:"♠",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"풀 하우스",eng:"Full House",desc:"같은 숫자 3장 + 같은 숫자 2장 (트리플 + 원 페어)",exampleCards:[{suit:"♥",rank:"K",value:13},{suit:"♠",rank:"K",value:13},{suit:"♦",rank:"K",value:13},{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12}],highlightIndices:[0,1,2,3,4]},{kor:"플러시",eng:"Flush",desc:"무늬가 같은 카드 5장 (숫자는 연속되지 않음)",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♦",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♦",rank:"5",value:5},{suit:"♦",rank:"2",value:2}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트",eng:"Straight",desc:"연속된 숫자 5장 (무늬는 달라도 됨)",exampleCards:[{suit:"♠",rank:"10",value:10},{suit:"♥",rank:"9",value:9},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"7",value:7},{suit:"♥",rank:"6",value:6}],highlightIndices:[0,1,2,3,4]},{kor:"트리플",eng:"Three of a Kind",desc:"같은 숫자 3장 + 서로 다른 숫자 2장",exampleCards:[{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12},{suit:"♠",rank:"Q",value:12},{suit:"♦",rank:"A",value:14},{suit:"♣",rank:"K",value:13}],highlightIndices:[0,1,2]},{kor:"투 페어",eng:"Two Pair",desc:"같은 숫자 2장 + 같은 숫자 2장 + 아무 카드 1장",exampleCards:[{suit:"♥",rank:"J",value:11},{suit:"♠",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"8",value:8},{suit:"♥",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"원 페어",eng:"One Pair",desc:"같은 숫자 2장 + 서로 다른 숫자 3장",exampleCards:[{suit:"♥",rank:"10",value:10},{suit:"♠",rank:"10",value:10},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♥",rank:"9",value:9}],highlightIndices:[0,1]},{kor:"하이 카드",eng:"High Card",desc:"위 족보에 해당하지 않는 경우, 가장 높은 숫자의 카드로 결정",exampleCards:[{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♣",rank:"9",value:9}],highlightIndices:[0]}],Pt=10,ye=20;let je=Pt,q=ye,z=[],E=[],L=null,i=null,d=null,G=0,Y=null,ie=1,oe="ai",N="pre_deal",R=null,k=0,V=ye,F=!1,ee=null,Nn=1e3;const Hn=document.getElementById("game-board"),an=document.getElementById("player-hole-cards"),sn=document.getElementById("community-cards"),m=document.getElementById("message-area"),ln=document.getElementById("player-coins-display"),on=document.getElementById("player-action-display"),Ea=document.getElementById("dealer-chip-player"),Oe=document.getElementById("ai-player-area"),rn=document.getElementById("ai-name"),dn=document.getElementById("ai-coins-display"),un=document.getElementById("ai-action-display"),Ma=document.getElementById("dealer-chip-ai"),cn=document.getElementById("ai-hole-cards"),Fa=document.getElementById("pot-amount"),re=document.getElementById("marathonLevelDisplay"),wa=document.getElementById("player-action-animation"),Ta=document.getElementById("ai-action-animation"),J=document.getElementById("setup-game-button"),Ge=document.getElementById("practice-mode-actions"),Ct=document.getElementById("deal-new-hand-practice-button"),Bt=document.getElementById("deal-flop-button"),$t=document.getElementById("deal-turn-button"),bt=document.getElementById("deal-river-button"),vt=document.getElementById("deal-fifth-street-button"),Rt=document.getElementById("evaluate-button"),Qe=document.getElementById("player-betting-actions"),xt=document.getElementById("foldButton"),Et=document.getElementById("checkButton"),Re=document.getElementById("callButton"),ue=document.getElementById("confirmBetButton"),ke=document.getElementById("startNextHandButton"),me=document.getElementById("betPercentageSlider"),fn=document.getElementById("betPercentageValue"),rt=document.getElementById("calculatedBetAmountDisplay"),Mt=document.getElementById("allInButton"),_n=document.getElementById("show-rankings-button"),at=document.getElementById("rankings-modal"),Pn=at.querySelector(".close-button"),hn=document.getElementById("hand-rankings-list"),Kt=document.getElementById("game-setup-modal"),La=document.getElementById("close-setup-modal-button"),Ft=document.getElementById("gameModePractice"),Vt=document.getElementById("gameModeSoloAI"),wt=document.getElementById("solo-ai-options"),Kn=document.getElementById("startingCoinsSelect"),Vn=document.getElementById("aiDifficultySelect"),Sa=document.getElementById("start-configured-game-button");let we=null,Te=null;function Ae(t,e){const n=t==="human"?wa:Ta;if(!n)return;t==="human"&&we?clearTimeout(we):t==="ai"&&Te&&clearTimeout(Te),n.textContent=e,n.classList.remove("show"),n.offsetWidth,n.classList.add("show");const l=window.setTimeout(()=>{n.classList.remove("show"),t==="human"&&we===l?we=null:t==="ai"&&Te===l&&(Te=null)},1800);t==="human"?we=l:Te=l}function On(){const t=[];for(const e of xa)for(const n of Sn)t.push({suit:e,rank:n.rank,value:n.value});return t}function Gn(t){const e=[...t];for(let n=e.length-1;n>0;n--){const l=Math.floor(Math.random()*(n+1));[e[n],e[l]]=[e[l],e[n]]}return e}function Be(t){return z.length<t?(m.textContent="덱에 카드가 부족합니다!",console.error("Deck depleted. Requested:",t,"Available:",z.length),z.splice(0,z.length)):z.splice(0,t)}function it(t,e=!1,n=!1,l=!1){const s=document.createElement("div");s.classList.add("card"),e&&s.classList.add("example-card"),n&&s.classList.add("highlighted-card-component"),l?(s.classList.add("face-down"),s.setAttribute("aria-label","숨겨진 카드")):(t.suit==="♥"?s.classList.add("hearts"):t.suit==="♦"?s.classList.add("diamonds"):t.suit==="♣"?s.classList.add("clubs"):t.suit==="♠"&&s.classList.add("spades"),s.setAttribute("aria-label",`${t.rank==="10"?"10":ne(t.value)} ${Da(t.suit)}`));const o=document.createElement("span");o.classList.add("rank"),o.textContent=t.rank;const u=document.createElement("span");return u.classList.add("suit"),u.textContent=t.suit,s.appendChild(o),s.appendChild(u),s.setAttribute("role","img"),s}function Da(t){switch(t){case"♠":return"스페이드";case"♥":return"하트";case"♣":return"클럽";case"♦":return"다이아몬드";default:return""}}function Qn(){an.innerHTML="",i&&i.holeCards&&i.holeCards.forEach(t=>{an.appendChild(it(t))})}function Ot(t=!1){cn.innerHTML="",d&&d.holeCards&&d.holeCards.forEach(e=>{cn.appendChild(it(e,!1,!1,!t&&!d.isAllIn))})}function ze(){sn.innerHTML="",E.forEach(t=>{sn.appendChild(it(t))})}function Na(){Fa.textContent=String(G)}function Gt(){i?(ln.textContent=`코인: ${i.coins}`,on.textContent=i.lastAction&&i.lastAction!=="none"?`(${_e(i.lastAction)}${i.currentBetInRound>0&&i.lastAction!=="blind"?" "+i.currentBetInRound:""})`:""):(ln.textContent="코인: 0",on.textContent=""),d?(rn.textContent=Y==="marathon"?`AI 상대 (레벨 ${ie})`:"AI 상대 (불가능)",dn.textContent=`코인: ${d.coins}`,un.textContent=d.lastAction&&d.lastAction!=="none"?`(${_e(d.lastAction)}${d.currentBetInRound>0&&d.lastAction!=="blind"?" "+d.currentBetInRound:""})`:"",re.textContent=Y==="marathon"?`레벨: ${ie}`:"",re.style.display=Y==="marathon"&&L==="solo_ai"?"inline":"none"):(rn.textContent="AI 상대",dn.textContent="코인: 0",un.textContent="",re.style.display="none"),Na(),Ha()}function Ha(){Ea.style.display=L==="solo_ai"&&oe==="human"?"flex":"none",Ma.style.display=L==="solo_ai"&&oe==="ai"?"flex":"none"}function ne(t){const e=Sn.find(n=>n.value===t);return e?e.rank==="A"?"에이스":e.rank==="K"?"킹":e.rank==="Q"?"퀸":e.rank==="J"?"잭":e.rank:String(t)}function De(t){const e=Dn.find(n=>n.eng===t);return e?e.kor:t}function _e(t){switch(t){case"fold":return"폴드";case"check":return"체크";case"call":return"콜";case"bet":return"벳";case"raise":return"레이즈";case"blind":return"블라인드";default:return""}}function _a(t){if(t.length!==5)throw new Error("패는 반드시 5장의 카드로 구성되어야 합니다.");const e=[...t].sort((c,f)=>c.value-f.value),n=e.map(c=>c.value),l=e.map(c=>c.suit),s={};n.forEach(c=>s[c]=(s[c]||0)+1);const o=Object.values(s).sort((c,f)=>f-c),u=Object.keys(s).map(Number).sort((c,f)=>f-c),w=new Set(l).size===1;let $=!1,B=0;const b=[...new Set(n)].sort((c,f)=>c-f);if(b.length>=5){for(let c=b.length-1;c>=4;c--)if(b[c]-b[c-4]===4){$=!0,B=b[c];break}}!$&&b.includes(14)&&b.includes(2)&&b.includes(3)&&b.includes(4)&&b.includes(5)&&($=!0,B=5);let C=e;if($&&B===5){const c=e.find(p=>p.value===14),f=e.filter(p=>p.value!==14).sort((p,A)=>p.value-A.value);C=[c,...f.filter(p=>p.value<=5)]}if($&&w){const c=B;return c===14?{name:"Royal Flush",rankValue:10,detailedName:"로열 플러시",bestHandCards:C}:{name:"Straight Flush",rankValue:9,detailedName:`${ne(c)}-high 스트레이트 플러시`,bestHandCards:C}}if(o[0]===4)return{name:"Four of a Kind",rankValue:8,detailedName:`포 카드, ${ne(u.find(f=>s[f]===4))}s`,bestHandCards:e};if(o[0]===3&&o[1]===2){const c=ne(u.find(p=>s[p]===3)),f=ne(u.find(p=>s[p]===2));return{name:"Full House",rankValue:7,detailedName:`풀 하우스, ${c}s over ${f}s`,bestHandCards:e}}if(w)return{name:"Flush",rankValue:6,detailedName:`${ne(e[e.length-1].value)}-high 플러시`,bestHandCards:e};if($)return{name:"Straight",rankValue:5,detailedName:`${ne(B)}-high 스트레이트`,bestHandCards:C};if(o[0]===3)return{name:"Three of a Kind",rankValue:4,detailedName:`트리플, ${ne(u.find(f=>s[f]===3))}s`,bestHandCards:e};if(o[0]===2&&o[1]===2){const c=ne(u.filter(p=>s[p]===2).sort((p,A)=>A-p)[0]),f=ne(u.filter(p=>s[p]===2).sort((p,A)=>A-p)[1]);return{name:"Two Pair",rankValue:3,detailedName:`투 페어, ${c}s and ${f}s`,bestHandCards:e}}return o[0]===2?{name:"One Pair",rankValue:2,detailedName:`원 페어, ${ne(u.find(f=>s[f]===2))}s`,bestHandCards:e}:{name:"High Card",rankValue:1,detailedName:`하이 카드, ${ne(e[e.length-1].value)}`,bestHandCards:e}}function Xe(t,e){if(e===0)return[[]];if(e>t.length)return[];if(e===t.length)return[t];const[n,...l]=t,s=Xe(l,e);return[...Xe(l,e-1).map(u=>[n,...u]),...s]}function Ne(t,e){if(t.rankValue>e.rankValue)return t;if(e.rankValue>t.rankValue)return e;if(!t.bestHandCards||!e.bestHandCards)return t.rankValue>=e.rankValue?t:e;const n=o=>{if(!o.bestHandCards)return 0;const u=o.bestHandCards.map(w=>w.value).sort((w,$)=>$-w);return(o.name==="Straight"||o.name==="Straight Flush")&&u.includes(14)&&u.includes(5)&&u.includes(4)&&u.includes(3)&&u.includes(2)?5:u[0]};if((t.name==="Straight"||t.name==="Straight Flush")&&(e.name==="Straight"||e.name==="Straight Flush")){const o=n(t),u=n(e);return o>u?t:u>o?e:t}const l=t.bestHandCards.map(o=>o.value).sort((o,u)=>u-o),s=e.bestHandCards.map(o=>o.value).sort((o,u)=>u-o);for(let o=0;o<Math.min(l.length,s.length);o++){if(l[o]>s[o])return t;if(s[o]>l[o])return e}return t}function Ee(t,e){const n=[...t,...e];if(n.length<5)return{name:"카드가 부족합니다",rankValue:0,detailedName:"패를 확인하려면 최소 5장의 카드가 필요합니다."};const l=Xe(n,5);let s=null;for(const o of l){const u=_a(o);s?s=Ne(s,u):s=u}return s||{name:"오류",rankValue:0,detailedName:"패를 평가할 수 없습니다."}}function Jn(t=!0){t&&(Hn.style.display="none",Oe.style.display="none",L=null,i=null,d=null,Y=null,F=!1,m.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.',je=Pt,q=ye,ie=1,re.style.display="none"),i&&(i.holeCards=[],i.currentBetInRound=0,i.isFolded=!1,i.isAllIn=!1,i.lastAction="none",i.hasActedThisRound=!1),d&&(d.holeCards=[],d.currentBetInRound=0,d.isFolded=!1,d.isAllIn=!1,d.lastAction="none",d.hasActedThisRound=!1),E=[],G=0,k=0,V=L==="solo_ai"?q:ye,R=null,N="pre_deal",ee=null,Qn(),Ot(),ze(),Gt(),J.disabled=!1,J.style.display="inline-block",Ge.style.display="none",Qe.style.display="none",ke.style.display="none"}function P(){L==="practice"?(Ge.style.display="flex",Qe.style.display="none",ke.style.display="none",Oe.style.display="none",re.style.display="none",Ct.style.display=i?"inline-block":"none",Bt.style.display=i&&i.holeCards.length>0&&E.length===0?"inline-block":"none",$t.style.display=E.length===2?"inline-block":"none",bt.style.display=E.length===3?"inline-block":"none",vt.style.display=E.length===4?"inline-block":"none",Rt.style.display=E.length===5?"inline-block":"none",Ct.disabled=F&&i&&i.holeCards.length>0,Bt.disabled=!(i&&i.holeCards.length>0&&E.length===0),$t.disabled=E.length!==2,bt.disabled=E.length!==3,vt.disabled=E.length!==4,Rt.disabled=E.length!==5):L==="solo_ai"?(Ge.style.display="none",Qe.style.display=F&&R==="human"?"flex":"none",ke.style.display=!F&&i&&d&&i.coins>0&&d.coins>0?"inline-block":"none",Oe.style.display="block",Y==="marathon"?(re.style.display="inline",re.textContent=`레벨: ${ie}`):re.style.display="none",F&&R==="human"&&Wn()):(Ge.style.display="none",Qe.style.display="none",ke.style.display="none",Oe.style.display="none",re.style.display="none"),Gt(),Qn(),Ot(),ze(),!F&&i&&d&&(i.coins===0||d.coins===0)&&(Y==="marathon"&&d.coins===0&&i.coins>0&&ie<=10||(i.coins===0&&d.coins===0?m.textContent="무승부! 양쪽 플레이어 모두 코인이 없습니다.":i.coins===0?m.textContent="AI 승리! 당신의 코인이 모두 소진되었습니다.":d.coins===0&&(m.textContent="당신 승리! AI의 코인이 모두 소진되었습니다."),J.disabled=!1,J.style.display="inline-block",ke.style.display="none"))}function Tt(){if(!i||L!=="solo_ai"||R!=="human"||!F){me.disabled=!0,fn.textContent="-",rt.textContent="(금액: -)";return}me.disabled=i.isAllIn;const t=parseInt(me.value);if(fn.textContent=`${t}%`,i.coins>0){const e=Math.min(i.coins,Math.max(1,Math.floor(i.coins*(t/100))));rt.textContent=`(금액: ${e})`}else rt.textContent="(금액: 0)"}function Un(){if(!i||L==="solo_ai"&&!d){m.textContent="플레이어 정보가 없습니다. 게임을 먼저 설정하세요.";return}if(Y==="marathon"&&ie>10){m.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.',F=!1,ke.style.display="none",J.disabled=!1,J.style.display="inline-block",P();return}if(i.coins===0||d&&d.coins===0&&!(Y==="marathon"&&ie<=10)){m.textContent="게임 종료. 한 플레이어의 코인이 없습니다. '새 게임 설정'으로 다시 시작하세요.",P();return}if(F=!0,z=On(),z=Gn(z),i.holeCards=[],i.currentBetInRound=0,i.isFolded=!1,i.isAllIn=!1,i.lastAction="none",i.hasActedThisRound=!1,d&&(d.holeCards=[],d.currentBetInRound=0,d.isFolded=!1,d.isAllIn=!1,d.lastAction="none",d.hasActedThisRound=!1),E=[],G=0,ee=null,L==="solo_ai"?(oe=oe==="human"?"ai":"human",V=q):V=ye,i.holeCards=Be(2),d&&(d.holeCards=Be(2)),L==="solo_ai"&&d){N="preflop";const t=oe==="human"?i:d,e=oe==="human"?d:i;mn(t,je),mn(e,q),k=q,ee=e.seat,R=oe==="human"?"human":"ai"}else L==="practice"&&(m.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",N="pre_deal");if(P(),J.disabled=!0,J.style.display="none",L==="solo_ai"&&R==="ai"&&d&&!d.isFolded&&!d.isAllIn&&F){const t=`AI의 턴입니다. (${N==="preflop"?"프리플랍":"플랍 전"})`;m.textContent=t,setTimeout(be,1200)}else L==="solo_ai"&&R==="human"&&i&&!i.isFolded&&!i.isAllIn&&F&&(m.textContent=`당신의 턴입니다. (${N==="preflop"?"프리플랍":"플랍 전"})`)}function mn(t,e,n){const l=Math.min(t.coins,e);t.coins-=l,t.currentBetInRound=l,G+=l,t.lastAction="blind",t.coins===0&&(t.isAllIn=!0)}function Wn(){if(L!=="solo_ai"||!i||!F||R!=="human"){xt.disabled=!0,Et.disabled=!0,Re.disabled=!0,ue.disabled=!0,Mt.disabled=!0,me.disabled=!0,Tt();return}Tt(),xt.disabled=i.isAllIn,Mt.disabled=i.isAllIn;const t=i.currentBetInRound===k&&!i.isAllIn;Et.disabled=!t;const e=k-i.currentBetInRound;if(Re.disabled=!(e>0&&!i.isAllIn),e>0?Re.textContent=i.coins>e?`콜 (${e})`:`올인 콜 (${i.coins})`:Re.textContent="콜",i.isAllIn&&(Re.disabled=!0),ue.disabled=i.isAllIn,me.disabled=i.isAllIn,i.isAllIn)ue.textContent="올인됨",ue.disabled=!0;else{const n=parseInt(me.value),l=Math.min(i.coins,Math.max(1,Math.floor(i.coins*(n/100)))),s=k>0,o=i.currentBetInRound+l;let u=!1;s?(ue.textContent="레이즈",(l===i.coins||o>=k+V)&&(u=!0)):(ue.textContent="벳",(l===i.coins||o>=q)&&(u=!0)),ue.disabled=!u||l===0||l>i.coins}}function Pa(){!i||R!=="human"||!F||i.isFolded||(i.isFolded=!0,i.lastAction="fold",Ae("human","폴드"),m.textContent="당신은 폴드했습니다.",F=!1,d&&st(d),lt())}function Ka(){if(!(!i||R!=="human"||!F||i.isAllIn)){if(i.currentBetInRound<k){m.textContent="체크할 수 없습니다. 현재 벳에 콜하거나 레이즈해야 합니다.";return}i.lastAction="check",i.hasActedThisRound=!0,Ae("human","체크"),m.textContent="당신은 체크했습니다.",R="ai",P(),setTimeout(be,1e3)}}function Va(){if(!i||R!=="human"||!F||i.isAllIn)return;const t=k-i.currentBetInRound;if(t<=0){m.textContent="콜할 금액이 없습니다. 체크하거나 벳/레이즈 하세요.";return}const e=Math.min(t,i.coins);i.coins-=e,G+=e,i.currentBetInRound+=e,i.lastAction="call",i.hasActedThisRound=!0,i.coins===0?(i.isAllIn=!0,m.textContent=`당신은 올인 콜했습니다 (총 ${i.currentBetInRound}).`,Ae("human",`올인 콜 (${e})`)):(m.textContent=`당신은 ${e}을 콜했습니다. (총 ${i.currentBetInRound})`,Ae("human",`콜 (${e})`)),R="ai",P(),setTimeout(be,1e3)}function Oa(){if(!i||R!=="human"||!F||i.isAllIn)return;const t=i.coins;if(t<=0)return;const e=i.currentBetInRound+t;i.coins=0,G+=t,i.currentBetInRound=e,i.isAllIn=!0;const n=e>k,l=e===k&&k>0,s=k===0&&e>0;n?(i.lastAction="raise",ee="human",V=e-k,k=e,m.textContent=`당신은 올인 레이즈하여 총 ${e}(으)로 만들었습니다!`):l?(i.lastAction="call",m.textContent=`당신은 올인 콜하여 총 ${e}을 맞췄습니다!`):s?(i.lastAction="bet",ee="human",k=e,V=e,m.textContent=`당신은 올인 (${e}) 벳했습니다!`):(i.lastAction="call",m.textContent=`당신은 올인 (${t}) 했습니다. 총 ${e}.`),Ae("human",`올인 (${t})`),i.hasActedThisRound=!0,R="ai",P(),setTimeout(be,1e3)}function Ga(){if(!i||R!=="human"||!F||i.isAllIn)return;let t=0;if(i.coins>0){const l=parseInt(me.value);t=Math.min(i.coins,Math.max(1,Math.floor(i.coins*(l/100))))}if(t<=0){m.textContent="벳할 금액이 없습니다.";return}if(t>i.coins){m.textContent="코인이 부족합니다.";return}const e=k>0,n=i.currentBetInRound+t;if(e){if(t<i.coins&&n<k+V){m.textContent=`최소 레이즈는 총 ${k+V}이 되도록 해야 합니다. (현재 베팅액에서 ${V} 만큼 더 필요). 또는 올인하세요.`;return}}else{const l=L==="solo_ai"?q:ye;if(t<i.coins&&n<l){m.textContent=`최소 벳 금액은 ${l} 입니다. 또는 올인하세요.`;return}}i.coins-=t,G+=t,i.currentBetInRound=n,i.lastAction=e?"raise":"bet",i.hasActedThisRound=!0,i.coins===0&&(i.isAllIn=!0),i.lastAction==="bet"?(k=n,V=n,ee="human"):i.lastAction==="raise"&&(V=n-k,k=n,ee="human"),m.textContent=`당신이 ${t}을(를) ${_e(i.lastAction)}하여 총 ${n}(으)로 만들었습니다.`,Ae("human",`${_e(i.lastAction)}: ${t}`),R="ai",P(),setTimeout(be,1e3)}function Qa(t,e,n,l,s,o,u,w){if(t===10)return qn(e,n,l,s,o,u,w);const $=s-e.currentBetInRound<=0,B=s-e.currentBetInRound,C=Ee(e.holeCards,l).rankValue;if(t===1)if($){if(C>=2&&Math.random()<.3){const I=Math.min(e.coins,u);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else return C<2&&B>e.coins*.05&&Math.random()<.95?{type:"fold"}:C<3&&B>e.coins*.15&&Math.random()<.8?{type:"fold"}:e.coins<=B?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"};const U=.5,c=t/20,f=t/25,p=Xe(e.holeCards.concat(l),4).some(I=>new Set(I.map(S=>S.suit)).size===1&&I.length===4),A=[...new Set(e.holeCards.concat(l).map(I=>I.value))].sort((I,S)=>I-S);let y=!1;if(A.length>=4)for(let I=0;I<=A.length-4;I++)A[I+3]-A[I]===3&&(y=!0),A.includes(14)&&A.includes(2)&&A.includes(3)&&A.includes(4)&&I===0&&(y=!0);const H=p||y;if($){if(C>=4||H&&Math.random()<.6+f){const I=(Math.floor(Math.random()*(t*2))+5)*5;let S=Math.min(e.coins,Math.max(u,Math.floor(e.coins*(I/100))));if(S=Math.max(S,u),e.coins===S)return{type:"allin",amount:e.currentBetInRound+S};if(S>0)return{type:"bet",amount:e.currentBetInRound+S}}if(Math.random()<.2+c){const I=Math.min(e.coins,u);if(I>0)return{type:"bet",amount:e.currentBetInRound+I}}return{type:"check"}}else{if(C<2&&B>u*2&&Math.random()<U+.2-c)return{type:"fold"};if((C>=5||H&&Math.random()<.5+f)&&e.coins>B+o){const I=Math.min(e.coins+e.currentBetInRound,s+Math.max(o,u*(1+Math.floor(t/2))));return e.coins<=I-e.currentBetInRound?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"raise",amount:I}}return B>e.coins*(.4-c*.1)&&Math.random()<U-c?{type:"fold"}:e.coins<=B?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"}}}function Ja(t,e){const n=[...t],l=[...e],s=5-l.length;for(let o=0;o<s&&!(n.length===0||(n.length>0&&n.shift(),n.length===0));o++)l.push(n.shift());return l}function qn(t,e,n,l,s,o,u){const w=[...z],$=Ja(w,n),B=Ee(t.holeCards,$),b=Ee(e.holeCards,$);let C="human_wins";if(B.rankValue>b.rankValue)C="ai_wins";else if(b.rankValue>B.rankValue)C="human_wins";else{const f=B.bestHandCards.map(y=>y.value).sort((y,H)=>H-y),p=b.bestHandCards.map(y=>y.value).sort((y,H)=>H-y);let A=!0;for(let y=0;y<5;y++){if(f[y]>p[y]){C="ai_wins",A=!1;break}if(p[y]>f[y]){C="human_wins",A=!1;break}}A&&(C="split")}const U=l-t.currentBetInRound<=0,c=l-t.currentBetInRound;if(C==="ai_wins"){if(e.isAllIn)return{type:t.coins<=c?"allin":"call",amount:t.currentBetInRound+Math.min(t.coins,c)};if(U){if(n.length<4&&Math.random()<.3)return{type:"check"};let f=Math.min(t.coins,Math.max(o,Math.floor(u*(.6+Math.random()*.4))));return f=Math.max(f,o),t.coins===f?{type:"allin",amount:t.currentBetInRound+f}:{type:"bet",amount:t.currentBetInRound+f}}else{if(c<=u*.5&&n.length<4&&Math.random()<.4)return t.coins<=c?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"};let f=.6+Math.random()*.6,p=Math.max(s,Math.floor(u*f)),A=c+p,y=Math.min(t.coins,A),H=t.currentBetInRound+y;return t.coins===y?{type:"allin",amount:H}:{type:"raise",amount:H}}}else return C==="human_wins"?U?{type:"check"}:{type:"fold"}:U?{type:"check"}:e.isAllIn||c<=o/2?t.coins<=c?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"}:{type:"fold"}}function be(){if(!d||R!=="ai"||!F||!i){F||console.warn("triggerAIAction called but hand is not in progress.");return}if(m.textContent="AI가 생각 중...",P(),d.isFolded||d.isAllIn){d.hasActedThisRound=!0,Ye();return}setTimeout(()=>{let t;Y==="impossible"?t=qn(d,i,E,k,V,q,G):Y==="marathon"?t=Qa(ie,d,i,E,k,V,q,G):(console.error("알 수 없는 AI 난이도:",Y),t={type:"check"});let e=0,n="";switch(t.type){case"fold":d.isFolded=!0,d.lastAction="fold",n="AI 폴드",m.textContent="AI가 폴드했습니다.",Ae("ai",n),st(i),lt();return;case"check":k-d.currentBetInRound>0?(e=Math.min(d.coins,k-d.currentBetInRound),d.lastAction="call",n=`AI 콜: ${e}`,m.textContent=`AI가 (강제) ${e}을 콜했습니다.`):(d.lastAction="check",n="AI 체크",m.textContent="AI가 체크했습니다.");break;case"call":e=Math.min(d.coins,k-d.currentBetInRound),e<0&&(e=0),d.lastAction="call",n=`AI 콜: ${e}`,m.textContent=`AI가 ${e}을 콜했습니다.`;break;case"bet":e=Math.min(d.coins,(t.amount||0)-d.currentBetInRound),e<0&&(e=0),e<q&&e<d.coins&&(e=Math.min(d.coins,q)),d.lastAction="bet",k=d.currentBetInRound+e,V=k,ee="ai",n=`AI 벳: ${e}`,m.textContent=`AI가 ${e}을 벳하여 총 ${k}(으)로 만들었습니다.`;break;case"raise":e=Math.min(d.coins,(t.amount||0)-d.currentBetInRound),e<0&&(e=0);const l=d.currentBetInRound+e;l<k+V&&e<d.coins?(e=Math.min(d.coins,k-d.currentBetInRound),e<0&&(e=0),d.lastAction="call",n=`AI 콜: ${e}`,m.textContent=`AI가 (잘못된 레이즈 시도 후) ${e}을 콜했습니다.`):(d.lastAction="raise",V=l-k,k=l,ee="ai",n=`AI 레이즈: ${e}`,m.textContent=`AI가 ${e}을 레이즈하여 총 ${k}(으)로 만들었습니다.`);break;case"allin":e=d.coins;const s=d.currentBetInRound+e;s>k?(d.lastAction=k===0?"bet":"raise",V=s-k,k=s,ee="ai",m.textContent=`AI가 올인 ${_e(d.lastAction)} (${e}) 하여 총 ${k}(으)로 만들었습니다!`):(d.lastAction="call",m.textContent=`AI가 올인 콜 (${e}) 했습니다.`),n=`AI 올인 (${e})`;break}d.coins-=e,G+=e,d.currentBetInRound+=e,d.coins===0&&(d.isAllIn=!0),d.hasActedThisRound=!0,Ae("ai",n),Ye()},1500)}function Ye(){if(!i||!d||!F)return;const t=i,e=d,n=(t.hasActedThisRound||t.isAllIn||t.isFolded)&&(e.hasActedThisRound||e.isAllIn||e.isFolded),l=t.currentBetInRound===e.currentBetInRound||t.isAllIn||e.isAllIn||t.isFolded||e.isFolded;if(t.isFolded||e.isFolded){if(!F)return;const o=t.isFolded?e:t;st(o),lt();return}let s=!1;if(n&&l)if(ee){const o=ee==="human"?e:t;(o.hasActedThisRound||o.isAllIn||o.isFolded)&&(s=!0)}else t.hasActedThisRound&&e.hasActedThisRound&&(s=!0);if(s){Ua();return}if(R=R==="human"?"ai":"human",R==="human"){if(i.isFolded||i.isAllIn){R="ai",Ye();return}m.textContent=`당신의 턴입니다. (${N})`,P()}else{if(d.isFolded||d.isAllIn){R="human",Ye();return}P(),setTimeout(be,100)}}function Ua(){if(!i||!d)return;if(i.currentBetInRound=0,d.currentBetInRound=0,i.hasActedThisRound=!1,d.hasActedThisRound=!1,k=0,V=L==="solo_ai"?q:ye,ee=null,(i.isAllIn||d.isAllIn)&&!(i.isFolded||d.isFolded)&&(i.isAllIn&&d.currentBetInRound>=i.currentBetInRound||d.isAllIn&&i.currentBetInRound>=d.currentBetInRound||i.isAllIn&&d.isAllIn)){m.textContent="한 명 이상 올인 상태. 남은 커뮤니티 카드를 모두 공개합니다.";const e=5-E.length;if(e>0){for(let n=0;n<e;n++){z.length>0&&Be(1);const l=Be(1);if(l.length>0)E.push(...l);else break}ze()}N="showdown"}switch(N){case"preflop":N="flop",fe("flop",2),m.textContent="플랍 카드 (2장)가 공개되었습니다.";break;case"flop":N="turn",fe("turn",1),m.textContent="3번째 커뮤니티 카드가 공개되었습니다.";break;case"turn":N="river",fe("river",1),m.textContent="4번째 커뮤니티 카드가 공개되었습니다.";break;case"river":N="fifth_street",fe("fifth_street",1),m.textContent="5번째 커뮤니티 카드가 공개되었습니다.";break;case"fifth_street":N="showdown";break;default:if(N!=="showdown")return}if(ze(),N==="showdown")pn();else if(F){if(oe==="ai"?R=i.isFolded||i.isAllIn?"ai":"human":R=d.isFolded||d.isAllIn?"human":"ai",R==="human"&&(i.isFolded||i.isAllIn)&&(R="ai"),R==="ai"&&(d.isFolded||d.isAllIn)&&(R="human"),(i.isFolded||i.isAllIn)&&(d.isFolded||d.isAllIn)){pn();return}R==="ai"?(m.textContent+=` AI의 턴입니다. (${N})`,setTimeout(be,1e3)):m.textContent+=` 당신의 턴입니다. (${N})`,P()}}function fe(t,e){z.length>0&&Be(1);const n=Be(e);n.length>0?E.push(...n):console.warn(`덱에 카드가 부족하여 ${t}에 카드를 딜할 수 없습니다. (요청: ${e}, 딜됨: ${n.length})`),E.length>5&&(E=E.slice(0,5))}function pn(){if((!i||!d||!F&&N!=="showdown")&&N==="hand_over")return;N="showdown",m.textContent="쇼다운!",F=!1,Ot(!0);const t=i.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:Ee(i.holeCards,E),e=d.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:Ee(d.holeCards,E);let n=null,l="";if(i.isFolded)n=d,l=`당신 폴드. AI 승리 (${De(e.name)}${e.detailedName&&e.name!==e.detailedName?" - "+e.detailedName:""}).`;else if(d.isFolded)n=i,l=`AI 폴드. 당신 승리 (${De(t.name)}${t.detailedName&&t.name!==t.detailedName?" - "+t.detailedName:""}).`;else{const s=Ne(t,e);s===t&&t.rankValue>e.rankValue?n=i:s===e&&e.rankValue>t.rankValue?n=d:Ne(t,e)===t&&Ne(e,t)===e?n="split":Ne(t,e)===t?n=i:n=d,l=`당신: ${De(t.name)}${t.detailedName&&t.name!==t.detailedName?" ("+t.detailedName+")":""}. AI: ${De(e.name)}${e.detailedName&&e.name!==e.detailedName?" ("+e.detailedName+")":""}. `,n===i?l+="당신 승리!":n===d?l+="AI 승리!":l+="무승부 (팟 분배)!"}m.textContent=l,st(n),lt()}function st(t){if(t==="split"&&i&&d){const e=Math.floor(G/2);i.coins+=e,d.coins+=G-e,m.textContent+=` 각각 ${e} 코인 획득.`}else t&&t!=="split"&&(t.coins+=G,m.textContent+=` ${t.name}이(가) 팟 ${G}을(를) 획득했습니다.`);G=0,L==="solo_ai"&&Y==="marathon"&&d&&d.coins===0&&i&&i.coins>0&&(ie++,ie>10?m.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.':(m.textContent=`AI 파산! 마라톤 레벨 ${ie}(으)로 진입합니다. AI 코인이 초기화됩니다.`,d.coins=Nn)),Gt()}function lt(){F=!1,N="hand_over",R=null,i&&(i.lastAction="none"),d&&(d.lastAction="none"),P()}function jn(){L==="practice"&&(F=!0,z=On(),z=Gn(z),i&&(i.holeCards=Be(2),i.currentBetInRound=0,i.isFolded=!1,i.lastAction="none"),E=[],G=0,m.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",P(),J.disabled=!0,J.style.display="none")}function Wa(){L!=="practice"||E.length!==0||(fe("flop",2),m.textContent="플랍 카드 (2장)가 공개되었습니다.",P())}function qa(){L!=="practice"||E.length!==2||(fe("turn",1),m.textContent="3번째 커뮤니티 카드가 공개되었습니다.",P())}function ja(){L!=="practice"||E.length!==3||(fe("river",1),m.textContent="4번째 커뮤니티 카드가 공개되었습니다.",P())}function za(){L!=="practice"||E.length!==4||(fe("fifth_street",1),m.textContent="5번째 커뮤니티 카드가 공개되었습니다.",P())}function Xa(){if(L!=="practice"||!i||i.holeCards.length===0||E.length<5){m.textContent="아직 카드가 충분하지 않습니다. 딜을 완료해주세요.";return}const t=Ee(i.holeCards,E),e=De(t.name);m.textContent=`최고의 패: ${e}${t.detailedName&&t.name!==t.detailedName?` (${t.detailedName})`:""}`,F=!1,P(),J.disabled=!1,J.style.display="inline-block"}function Ya(){hn.innerHTML="",Dn.forEach(t=>{const e=document.createElement("li"),n=document.createElement("strong");n.textContent=`${t.kor} (${t.eng})`,e.appendChild(n);const l=document.createElement("div");l.classList.add("ranking-details-wrapper");const s=document.createElement("div");s.classList.add("ranking-example-cards"),t.exampleCards.forEach((u,w)=>{const $=t.highlightIndices?t.highlightIndices.includes(w):!1;s.appendChild(it(u,!0,$))}),l.appendChild(s);const o=document.createElement("p");o.classList.add("ranking-description"),o.textContent=t.desc,l.appendChild(o),e.appendChild(l),hn.appendChild(e)})}function Za(){Ya(),at.style.display="block",Pn.focus()}function zn(){at.style.display="none",_n.focus()}function ei(){Jn(!0),Kt.style.display="block",Ft.checked=!0,wt.style.display="none",Kn.value="1000",Vn.value="marathon",Ft.focus()}function Qt(){Kt.style.display="none",J.focus()}function Xn(){Vt.checked?wt.style.display="block":wt.style.display="none"}function ti(){const t=Vt.checked?"solo_ai":"practice";let e=0;if(t==="solo_ai"){if(e=parseInt(Kn.value,10),isNaN(e)){alert("유효한 코인 금액을 선택해주세요.");return}Nn=e,Y=Vn.value,Y==="marathon"&&(ie=1),oe="ai",q=Math.max(10,Math.floor(e/100)),je=Math.max(5,Math.floor(q/2))}else je=Pt,q=ye;L=t,i={name:"나",holeCards:[],coins:t==="solo_ai"?e:0,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"human",hasActedThisRound:!1},t==="solo_ai"?d={name:"AI 상대",holeCards:[],coins:e,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"ai",hasActedThisRound:!1}:d=null,Hn.style.display="flex",Qt(),t==="solo_ai"?Un():jn(),J.disabled=!0,J.style.display="none"}J.addEventListener("click",ei);La.addEventListener("click",Qt);Ft.addEventListener("change",Xn);Vt.addEventListener("change",Xn);Sa.addEventListener("click",ti);Ct.addEventListener("click",jn);Bt.addEventListener("click",Wa);$t.addEventListener("click",qa);bt.addEventListener("click",ja);vt.addEventListener("click",za);Rt.addEventListener("click",Xa);xt.addEventListener("click",Pa);Et.addEventListener("click",Ka);Re.addEventListener("click",Va);ue.addEventListener("click",Ga);Mt.addEventListener("click",Oa);ke.addEventListener("click",Un);me.addEventListener("input",Wn);_n.addEventListener("click",Za);Pn.addEventListener("click",zn);window.addEventListener("keydown",t=>{t.key==="Escape"&&(at.style.display==="block"&&zn(),Kt.style.display==="block"&&Qt())});document.addEventListener("DOMContentLoaded",()=>{Jn(!0),Tt(),P(),m.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.'});
