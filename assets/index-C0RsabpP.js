(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */console.log("Poker Script v1.2.3 Loaded - Impossible AI with Future Sight.");const dt=["♠","♥","♣","♦"],Je=[{rank:"2",value:2},{rank:"3",value:3},{rank:"4",value:4},{rank:"5",value:5},{rank:"6",value:6},{rank:"7",value:7},{rank:"8",value:8},{rank:"9",value:9},{rank:"10",value:10},{rank:"J",value:11},{rank:"Q",value:12},{rank:"K",value:13},{rank:"A",value:14}],qe=[{kor:"로열 플러시",eng:"Royal Flush",desc:"A, K, Q, J, 10 (모두 같은 무늬)",exampleCards:[{suit:"♥",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♥",rank:"Q",value:12},{suit:"♥",rank:"J",value:11},{suit:"♥",rank:"10",value:10}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트 플러시",eng:"Straight Flush",desc:"연속된 숫자 5장 (모두 같은 무늬, 로열 플러시 제외)",exampleCards:[{suit:"♠",rank:"9",value:9},{suit:"♠",rank:"8",value:8},{suit:"♠",rank:"7",value:7},{suit:"♠",rank:"6",value:6},{suit:"♠",rank:"5",value:5}],highlightIndices:[0,1,2,3,4]},{kor:"포 카드",eng:"Four of a Kind",desc:"같은 숫자 4장 + 아무 카드 1장",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"A",value:14},{suit:"♣",rank:"A",value:14},{suit:"♠",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"풀 하우스",eng:"Full House",desc:"같은 숫자 3장 + 같은 숫자 2장 (트리플 + 원 페어)",exampleCards:[{suit:"♥",rank:"K",value:13},{suit:"♠",rank:"K",value:13},{suit:"♦",rank:"K",value:13},{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12}],highlightIndices:[0,1,2,3,4]},{kor:"플러시",eng:"Flush",desc:"무늬가 같은 카드 5장 (숫자는 연속되지 않음)",exampleCards:[{suit:"♦",rank:"A",value:14},{suit:"♦",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♦",rank:"5",value:5},{suit:"♦",rank:"2",value:2}],highlightIndices:[0,1,2,3,4]},{kor:"스트레이트",eng:"Straight",desc:"연속된 숫자 5장 (무늬는 달라도 됨)",exampleCards:[{suit:"♠",rank:"10",value:10},{suit:"♥",rank:"9",value:9},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"7",value:7},{suit:"♥",rank:"6",value:6}],highlightIndices:[0,1,2,3,4]},{kor:"트리플",eng:"Three of a Kind",desc:"같은 숫자 3장 + 서로 다른 숫자 2장",exampleCards:[{suit:"♣",rank:"Q",value:12},{suit:"♥",rank:"Q",value:12},{suit:"♠",rank:"Q",value:12},{suit:"♦",rank:"A",value:14},{suit:"♣",rank:"K",value:13}],highlightIndices:[0,1,2]},{kor:"투 페어",eng:"Two Pair",desc:"같은 숫자 2장 + 같은 숫자 2장 + 아무 카드 1장",exampleCards:[{suit:"♥",rank:"J",value:11},{suit:"♠",rank:"J",value:11},{suit:"♦",rank:"8",value:8},{suit:"♣",rank:"8",value:8},{suit:"♥",rank:"K",value:13}],highlightIndices:[0,1,2,3]},{kor:"원 페어",eng:"One Pair",desc:"같은 숫자 2장 + 서로 다른 숫자 3장",exampleCards:[{suit:"♥",rank:"10",value:10},{suit:"♠",rank:"10",value:10},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♥",rank:"9",value:9}],highlightIndices:[0,1]},{kor:"하이 카드",eng:"High Card",desc:"위 족보에 해당하지 않는 경우, 가장 높은 숫자의 카드로 결정",exampleCards:[{suit:"♠",rank:"A",value:14},{suit:"♥",rank:"K",value:13},{suit:"♦",rank:"Q",value:12},{suit:"♣",rank:"J",value:11},{suit:"♣",rank:"9",value:9}],highlightIndices:[0]}],Ee=10,Q=20;let le=Ee,F=Q,w=[],m=[],y=null,n=null,a=null,E=0,T=null,D=1,P="ai",k="pre_deal",h=null,c=0,v=Q,p=!1,L=null,Ue=1e3;const We=document.getElementById("game-board"),Le=document.getElementById("player-hole-cards"),Se=document.getElementById("community-cards"),r=document.getElementById("message-area"),Ne=document.getElementById("player-coins-display"),De=document.getElementById("player-action-display"),ut=document.getElementById("dealer-chip-player"),ae=document.getElementById("ai-player-area"),He=document.getElementById("ai-name"),_e=document.getElementById("ai-coins-display"),Pe=document.getElementById("ai-action-display"),ct=document.getElementById("dealer-chip-ai"),Ke=document.getElementById("ai-hole-cards"),ft=document.getElementById("pot-amount"),K=document.getElementById("marathonLevelDisplay"),ht=document.getElementById("player-action-animation"),mt=document.getElementById("ai-action-animation"),$=document.getElementById("setup-game-button"),ie=document.getElementById("practice-mode-actions"),pe=document.getElementById("deal-new-hand-practice-button"),Ie=document.getElementById("deal-flop-button"),ye=document.getElementById("deal-turn-button"),ge=document.getElementById("deal-river-button"),Ae=document.getElementById("deal-fifth-street-button"),ke=document.getElementById("evaluate-button"),se=document.getElementById("player-betting-actions"),Ce=document.getElementById("foldButton"),Be=document.getElementById("checkButton"),z=document.getElementById("callButton"),V=document.getElementById("confirmBetButton"),U=document.getElementById("startNextHandButton"),G=document.getElementById("betPercentageSlider"),Ve=document.getElementById("betPercentageValue"),me=document.getElementById("calculatedBetAmountDisplay"),be=document.getElementById("allInButton"),je=document.getElementById("show-rankings-button"),ue=document.getElementById("rankings-modal"),ze=ue.querySelector(".close-button"),Oe=document.getElementById("hand-rankings-list"),$e=document.getElementById("game-setup-modal"),pt=document.getElementById("close-setup-modal-button"),ve=document.getElementById("gameModePractice"),Me=document.getElementById("gameModeSoloAI"),Re=document.getElementById("solo-ai-options"),Xe=document.getElementById("startingCoinsSelect"),Ye=document.getElementById("aiDifficultySelect"),It=document.getElementById("start-configured-game-button");let Y=null,Z=null;function J(t,e){const i=t==="human"?ht:mt;if(!i)return;t==="human"&&Y?clearTimeout(Y):t==="ai"&&Z&&clearTimeout(Z),i.textContent=e,i.classList.remove("show"),i.offsetWidth,i.classList.add("show");const l=window.setTimeout(()=>{i.classList.remove("show"),t==="human"&&Y===l?Y=null:t==="ai"&&Z===l&&(Z=null)},1800);t==="human"?Y=l:Z=l}function Ze(){const t=[];for(const e of dt)for(const i of Je)t.push({suit:e,rank:i.rank,value:i.value});return t}function et(t){const e=[...t];for(let i=e.length-1;i>0;i--){const l=Math.floor(Math.random()*(i+1));[e[i],e[l]]=[e[l],e[i]]}return e}function W(t){return w.length<t?(r.textContent="덱에 카드가 부족합니다!",console.error("Deck depleted. Requested:",t,"Available:",w.length),w.splice(0,w.length)):w.splice(0,t)}function ce(t,e=!1,i=!1,l=!1){const s=document.createElement("div");s.classList.add("card"),e&&s.classList.add("example-card"),i&&s.classList.add("highlighted-card-component"),l?(s.classList.add("face-down"),s.setAttribute("aria-label","숨겨진 카드")):(t.suit==="♥"?s.classList.add("hearts"):t.suit==="♦"?s.classList.add("diamonds"):t.suit==="♣"?s.classList.add("clubs"):t.suit==="♠"&&s.classList.add("spades"),s.setAttribute("aria-label",`${t.rank==="10"?"10":N(t.value)} ${yt(t.suit)}`));const o=document.createElement("span");o.classList.add("rank"),o.textContent=t.rank;const d=document.createElement("span");return d.classList.add("suit"),d.textContent=t.suit,s.appendChild(o),s.appendChild(d),s.setAttribute("role","img"),s}function yt(t){switch(t){case"♠":return"스페이드";case"♥":return"하트";case"♣":return"클럽";case"♦":return"다이아몬드";default:return""}}function tt(){Le.innerHTML="",n&&n.holeCards&&n.holeCards.forEach(t=>{Le.appendChild(ce(t))})}function Fe(t=!1){Ke.innerHTML="",a&&a.holeCards&&a.holeCards.forEach(e=>{Ke.appendChild(ce(e,!1,!1,!t&&!a.isAllIn))})}function oe(){Se.innerHTML="",m.forEach(t=>{Se.appendChild(ce(t))})}function gt(){ft.textContent=String(E)}function we(){n?(Ne.textContent=`코인: ${n.coins}`,De.textContent=n.lastAction&&n.lastAction!=="none"?`(${ne(n.lastAction)}${n.currentBetInRound>0&&n.lastAction!=="blind"?" "+n.currentBetInRound:""})`:""):(Ne.textContent="코인: 0",De.textContent=""),a?(He.textContent=T==="marathon"?`AI 상대 (레벨 ${D})`:"AI 상대 (불가능)",_e.textContent=`코인: ${a.coins}`,Pe.textContent=a.lastAction&&a.lastAction!=="none"?`(${ne(a.lastAction)}${a.currentBetInRound>0&&a.lastAction!=="blind"?" "+a.currentBetInRound:""})`:"",K.textContent=T==="marathon"?`레벨: ${D}`:"",K.style.display=T==="marathon"&&y==="solo_ai"?"inline":"none"):(He.textContent="AI 상대",_e.textContent="코인: 0",Pe.textContent="",K.style.display="none"),gt(),At()}function At(){ut.style.display=y==="solo_ai"&&P==="human"?"flex":"none",ct.style.display=y==="solo_ai"&&P==="ai"?"flex":"none"}function N(t){const e=Je.find(i=>i.value===t);return e?e.rank==="A"?"에이스":e.rank==="K"?"킹":e.rank==="Q"?"퀸":e.rank==="J"?"잭":e.rank:String(t)}function ee(t){const e=qe.find(i=>i.eng===t);return e?e.kor:t}function ne(t){switch(t){case"fold":return"폴드";case"check":return"체크";case"call":return"콜";case"bet":return"벳";case"raise":return"레이즈";case"blind":return"블라인드";default:return""}}function kt(t){if(t.length!==5)throw new Error("패는 반드시 5장의 카드로 구성되어야 합니다.");const e=[...t].sort((u,f)=>u.value-f.value),i=e.map(u=>u.value),l=e.map(u=>u.suit),s={};i.forEach(u=>s[u]=(s[u]||0)+1);const o=Object.values(s).sort((u,f)=>f-u),d=Object.keys(s).map(Number).sort((u,f)=>f-u),S=new Set(l).size===1;let x=!1,R=0;const M=[...new Set(i)].sort((u,f)=>u-f);if(M.length>=5){for(let u=M.length-1;u>=4;u--)if(M[u]-M[u-4]===4){x=!0,R=M[u];break}}!x&&M.includes(14)&&M.includes(2)&&M.includes(3)&&M.includes(4)&&M.includes(5)&&(x=!0,R=5);let B=e;if(x&&R===5){const u=e.find(I=>I.value===14),f=e.filter(I=>I.value!==14).sort((I,C)=>I.value-C.value);B=[u,...f.filter(I=>I.value<=5)]}if(x&&S){const u=R;return u===14?{name:"Royal Flush",rankValue:10,detailedName:"로열 플러시",bestHandCards:B}:{name:"Straight Flush",rankValue:9,detailedName:`${N(u)}-high 스트레이트 플러시`,bestHandCards:B}}if(o[0]===4)return{name:"Four of a Kind",rankValue:8,detailedName:`포 카드, ${N(d.find(f=>s[f]===4))}s`,bestHandCards:e};if(o[0]===3&&o[1]===2){const u=N(d.find(I=>s[I]===3)),f=N(d.find(I=>s[I]===2));return{name:"Full House",rankValue:7,detailedName:`풀 하우스, ${u}s over ${f}s`,bestHandCards:e}}if(S)return{name:"Flush",rankValue:6,detailedName:`${N(e[e.length-1].value)}-high 플러시`,bestHandCards:e};if(x)return{name:"Straight",rankValue:5,detailedName:`${N(R)}-high 스트레이트`,bestHandCards:B};if(o[0]===3)return{name:"Three of a Kind",rankValue:4,detailedName:`트리플, ${N(d.find(f=>s[f]===3))}s`,bestHandCards:e};if(o[0]===2&&o[1]===2){const u=N(d.filter(I=>s[I]===2).sort((I,C)=>C-I)[0]),f=N(d.filter(I=>s[I]===2).sort((I,C)=>C-I)[1]);return{name:"Two Pair",rankValue:3,detailedName:`투 페어, ${u}s and ${f}s`,bestHandCards:e}}return o[0]===2?{name:"One Pair",rankValue:2,detailedName:`원 페어, ${N(d.find(f=>s[f]===2))}s`,bestHandCards:e}:{name:"High Card",rankValue:1,detailedName:`하이 카드, ${N(e[e.length-1].value)}`,bestHandCards:e}}function re(t,e){if(e===0)return[[]];if(e>t.length)return[];if(e===t.length)return[t];const[i,...l]=t,s=re(l,e);return[...re(l,e-1).map(d=>[i,...d]),...s]}function te(t,e){if(t.rankValue>e.rankValue)return t;if(e.rankValue>t.rankValue)return e;if(!t.bestHandCards||!e.bestHandCards)return t.rankValue>=e.rankValue?t:e;const i=o=>{if(!o.bestHandCards)return 0;const d=o.bestHandCards.map(S=>S.value).sort((S,x)=>x-S);return(o.name==="Straight"||o.name==="Straight Flush")&&d.includes(14)&&d.includes(5)&&d.includes(4)&&d.includes(3)&&d.includes(2)?5:d[0]};if((t.name==="Straight"||t.name==="Straight Flush")&&(e.name==="Straight"||e.name==="Straight Flush")){const o=i(t),d=i(e);return o>d?t:d>o?e:t}const l=t.bestHandCards.map(o=>o.value).sort((o,d)=>d-o),s=e.bestHandCards.map(o=>o.value).sort((o,d)=>d-o);for(let o=0;o<Math.min(l.length,s.length);o++){if(l[o]>s[o])return t;if(s[o]>l[o])return e}return t}function X(t,e){const i=[...t,...e];if(i.length<5)return{name:"카드가 부족합니다",rankValue:0,detailedName:"패를 확인하려면 최소 5장의 카드가 필요합니다."};const l=re(i,5);let s=null;for(const o of l){const d=kt(o);s?s=te(s,d):s=d}return s||{name:"오류",rankValue:0,detailedName:"패를 평가할 수 없습니다."}}function nt(t=!0){t&&(We.style.display="none",ae.style.display="none",y=null,n=null,a=null,T=null,p=!1,r.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.',le=Ee,F=Q,D=1,K.style.display="none"),n&&(n.holeCards=[],n.currentBetInRound=0,n.isFolded=!1,n.isAllIn=!1,n.lastAction="none",n.hasActedThisRound=!1),a&&(a.holeCards=[],a.currentBetInRound=0,a.isFolded=!1,a.isAllIn=!1,a.lastAction="none",a.hasActedThisRound=!1),m=[],E=0,c=0,v=y==="solo_ai"?F:Q,h=null,k="pre_deal",L=null,tt(),Fe(),oe(),we(),$.disabled=!1,$.style.display="inline-block",ie.style.display="none",se.style.display="none",U.style.display="none"}function b(){y==="practice"?(ie.style.display="flex",se.style.display="none",U.style.display="none",ae.style.display="none",K.style.display="none",pe.style.display=n?"inline-block":"none",Ie.style.display=n&&n.holeCards.length>0&&m.length===0?"inline-block":"none",ye.style.display=m.length===2?"inline-block":"none",ge.style.display=m.length===3?"inline-block":"none",Ae.style.display=m.length===4?"inline-block":"none",ke.style.display=m.length===5?"inline-block":"none",pe.disabled=p&&n&&n.holeCards.length>0,Ie.disabled=!(n&&n.holeCards.length>0&&m.length===0),ye.disabled=m.length!==2,ge.disabled=m.length!==3,Ae.disabled=m.length!==4,ke.disabled=m.length!==5):y==="solo_ai"?(ie.style.display="none",se.style.display=p&&h==="human"?"flex":"none",U.style.display=!p&&n&&a&&n.coins>0&&a.coins>0?"inline-block":"none",ae.style.display="block",T==="marathon"?(K.style.display="inline",K.textContent=`레벨: ${D}`):K.style.display="none",p&&h==="human"&&it()):(ie.style.display="none",se.style.display="none",U.style.display="none",ae.style.display="none",K.style.display="none"),we(),tt(),Fe(),oe(),!p&&n&&a&&(n.coins===0||a.coins===0)&&(T==="marathon"&&a.coins===0&&n.coins>0&&D<=10||(n.coins===0&&a.coins===0?r.textContent="무승부! 양쪽 플레이어 모두 코인이 없습니다.":n.coins===0?r.textContent="AI 승리! 당신의 코인이 모두 소진되었습니다.":a.coins===0&&(r.textContent="당신 승리! AI의 코인이 모두 소진되었습니다."),$.disabled=!1,$.style.display="inline-block",U.style.display="none"))}function xe(){if(!n||y!=="solo_ai"||h!=="human"||!p){G.disabled=!0,Ve.textContent="-",me.textContent="(금액: -)";return}G.disabled=n.isAllIn;const t=parseInt(G.value);if(Ve.textContent=`${t}%`,n.coins>0){const e=Math.min(n.coins,Math.max(1,Math.floor(n.coins*(t/100))));me.textContent=`(금액: ${e})`}else me.textContent="(금액: 0)"}function at(){if(!n||y==="solo_ai"&&!a){r.textContent="플레이어 정보가 없습니다. 게임을 먼저 설정하세요.";return}if(T==="marathon"&&D>10){r.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.',p=!1,U.style.display="none",$.disabled=!1,$.style.display="inline-block",b();return}if(n.coins===0||a&&a.coins===0&&!(T==="marathon"&&D<=10)){r.textContent="게임 종료. 한 플레이어의 코인이 없습니다. '새 게임 설정'으로 다시 시작하세요.",b();return}if(p=!0,w=Ze(),w=et(w),n.holeCards=[],n.currentBetInRound=0,n.isFolded=!1,n.isAllIn=!1,n.lastAction="none",n.hasActedThisRound=!1,a&&(a.holeCards=[],a.currentBetInRound=0,a.isFolded=!1,a.isAllIn=!1,a.lastAction="none",a.hasActedThisRound=!1),m=[],E=0,L=null,y==="solo_ai"?(P=P==="human"?"ai":"human",v=F):v=Q,n.holeCards=W(2),a&&(a.holeCards=W(2)),y==="solo_ai"&&a){k="preflop";const t=P==="human"?n:a,e=P==="human"?a:n;Ge(t,le),Ge(e,F),c=F,L=e.seat,h=P==="human"?"human":"ai"}else y==="practice"&&(r.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",k="pre_deal");if(b(),$.disabled=!0,$.style.display="none",y==="solo_ai"&&h==="ai"&&a&&!a.isFolded&&!a.isAllIn&&p){const t=`AI의 턴입니다. (${k==="preflop"?"프리플랍":"플랍 전"})`;r.textContent=t,setTimeout(j,1200)}else y==="solo_ai"&&h==="human"&&n&&!n.isFolded&&!n.isAllIn&&p&&(r.textContent=`당신의 턴입니다. (${k==="preflop"?"프리플랍":"플랍 전"})`)}function Ge(t,e,i){const l=Math.min(t.coins,e);t.coins-=l,t.currentBetInRound=l,E+=l,t.lastAction="blind",t.coins===0&&(t.isAllIn=!0)}function it(){if(y!=="solo_ai"||!n||!p||h!=="human"){Ce.disabled=!0,Be.disabled=!0,z.disabled=!0,V.disabled=!0,be.disabled=!0,G.disabled=!0,xe();return}xe(),Ce.disabled=n.isAllIn,be.disabled=n.isAllIn;const t=n.currentBetInRound===c&&!n.isAllIn;Be.disabled=!t;const e=c-n.currentBetInRound;if(z.disabled=!(e>0&&!n.isAllIn),e>0?z.textContent=n.coins>e?`콜 (${e})`:`올인 콜 (${n.coins})`:z.textContent="콜",n.isAllIn&&(z.disabled=!0),V.disabled=n.isAllIn,G.disabled=n.isAllIn,n.isAllIn)V.textContent="올인됨",V.disabled=!0;else{const i=parseInt(G.value),l=Math.min(n.coins,Math.max(1,Math.floor(n.coins*(i/100)))),s=c>0,o=n.currentBetInRound+l;let d=!1;s?(V.textContent="레이즈",(l===n.coins||o>=c+v)&&(d=!0)):(V.textContent="벳",(l===n.coins||o>=F)&&(d=!0)),V.disabled=!d||l===0||l>n.coins}}function Ct(){!n||h!=="human"||!p||n.isFolded||(n.isFolded=!0,n.lastAction="fold",J("human","폴드"),r.textContent="당신은 폴드했습니다.",p=!1,a&&fe(a),he())}function Bt(){if(!(!n||h!=="human"||!p||n.isAllIn)){if(n.currentBetInRound<c){r.textContent="체크할 수 없습니다. 현재 벳에 콜하거나 레이즈해야 합니다.";return}n.lastAction="check",n.hasActedThisRound=!0,J("human","체크"),r.textContent="당신은 체크했습니다.",h="ai",b(),setTimeout(j,1e3)}}function bt(){if(!n||h!=="human"||!p||n.isAllIn)return;const t=c-n.currentBetInRound;if(t<=0){r.textContent="콜할 금액이 없습니다. 체크하거나 벳/레이즈 하세요.";return}const e=Math.min(t,n.coins);n.coins-=e,E+=e,n.currentBetInRound+=e,n.lastAction="call",n.hasActedThisRound=!0,n.coins===0?(n.isAllIn=!0,r.textContent=`당신은 올인 콜했습니다 (총 ${n.currentBetInRound}).`,J("human",`올인 콜 (${e})`)):(r.textContent=`당신은 ${e}을 콜했습니다. (총 ${n.currentBetInRound})`,J("human",`콜 (${e})`)),h="ai",b(),setTimeout(j,1e3)}function vt(){if(!n||h!=="human"||!p||n.isAllIn)return;const t=n.coins;if(t<=0)return;const e=n.currentBetInRound+t;n.coins=0,E+=t,n.currentBetInRound=e,n.isAllIn=!0;const i=e>c,l=e===c&&c>0,s=c===0&&e>0;i?(n.lastAction="raise",L="human",v=e-c,c=e,r.textContent=`당신은 올인 레이즈하여 총 ${e}(으)로 만들었습니다!`):l?(n.lastAction="call",r.textContent=`당신은 올인 콜하여 총 ${e}을 맞췄습니다!`):s?(n.lastAction="bet",L="human",c=e,v=e,r.textContent=`당신은 올인 (${e}) 벳했습니다!`):(n.lastAction="call",r.textContent=`당신은 올인 (${t}) 했습니다. 총 ${e}.`),J("human",`올인 (${t})`),n.hasActedThisRound=!0,h="ai",b(),setTimeout(j,1e3)}function Rt(){if(!n||h!=="human"||!p||n.isAllIn)return;let t=0;if(n.coins>0){const l=parseInt(G.value);t=Math.min(n.coins,Math.max(1,Math.floor(n.coins*(l/100))))}if(t<=0){r.textContent="벳할 금액이 없습니다.";return}if(t>n.coins){r.textContent="코인이 부족합니다.";return}const e=c>0,i=n.currentBetInRound+t;if(e){if(t<n.coins&&i<c+v){r.textContent=`최소 레이즈는 총 ${c+v}이 되도록 해야 합니다. (현재 베팅액에서 ${v} 만큼 더 필요). 또는 올인하세요.`;return}}else{const l=y==="solo_ai"?F:Q;if(t<n.coins&&i<l){r.textContent=`최소 벳 금액은 ${l} 입니다. 또는 올인하세요.`;return}}n.coins-=t,E+=t,n.currentBetInRound=i,n.lastAction=e?"raise":"bet",n.hasActedThisRound=!0,n.coins===0&&(n.isAllIn=!0),n.lastAction==="bet"?(c=i,v=i,L="human"):n.lastAction==="raise"&&(v=i-c,c=i,L="human"),r.textContent=`당신이 ${t}을(를) ${ne(n.lastAction)}하여 총 ${i}(으)로 만들었습니다.`,J("human",`${ne(n.lastAction)}: ${t}`),h="ai",b(),setTimeout(j,1e3)}function xt(t,e,i,l,s,o,d,S){if(t===10)return st(e,i,l,s,o,d,S);const x=s-e.currentBetInRound<=0,R=s-e.currentBetInRound,B=X(e.holeCards,l).rankValue;if(t===1)if(x){if(B>=2&&Math.random()<.3){const g=Math.min(e.coins,d);if(g>0)return{type:"bet",amount:e.currentBetInRound+g}}return{type:"check"}}else return B<2&&R>e.coins*.05&&Math.random()<.95?{type:"fold"}:B<3&&R>e.coins*.15&&Math.random()<.8?{type:"fold"}:e.coins<=R?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"};const q=.5,u=t/20,f=t/25,I=re(e.holeCards.concat(l),4).some(g=>new Set(g.map(H=>H.suit)).size===1&&g.length===4),C=[...new Set(e.holeCards.concat(l).map(g=>g.value))].sort((g,H)=>g-H);let A=!1;if(C.length>=4)for(let g=0;g<=C.length-4;g++)C[g+3]-C[g]===3&&(A=!0),C.includes(14)&&C.includes(2)&&C.includes(3)&&C.includes(4)&&g===0&&(A=!0);const _=I||A;if(x){if(B>=4||_&&Math.random()<.6+f){const g=(Math.floor(Math.random()*(t*2))+5)*5;let H=Math.min(e.coins,Math.max(d,Math.floor(e.coins*(g/100))));if(H=Math.max(H,d),e.coins===H)return{type:"allin",amount:e.currentBetInRound+H};if(H>0)return{type:"bet",amount:e.currentBetInRound+H}}if(Math.random()<.2+u){const g=Math.min(e.coins,d);if(g>0)return{type:"bet",amount:e.currentBetInRound+g}}return{type:"check"}}else{if(B<2&&R>d*2&&Math.random()<q+.2-u)return{type:"fold"};if((B>=5||_&&Math.random()<.5+f)&&e.coins>R+o){const g=Math.min(e.coins+e.currentBetInRound,s+Math.max(o,d*(1+Math.floor(t/2))));return e.coins<=g-e.currentBetInRound?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"raise",amount:g}}return R>e.coins*(.4-u*.1)&&Math.random()<q-u?{type:"fold"}:e.coins<=R?{type:"allin",amount:e.currentBetInRound+e.coins}:{type:"call"}}}function Et(t,e){const i=[...t],l=[...e],s=5-l.length;for(let o=0;o<s&&!(i.length===0||(i.length>0&&i.shift(),i.length===0));o++)l.push(i.shift());return l}function st(t,e,i,l,s,o,d){const S=[...w],x=Et(S,i),R=X(t.holeCards,x),M=X(e.holeCards,x);let B="human_wins";if(R.rankValue>M.rankValue)B="ai_wins";else if(M.rankValue>R.rankValue)B="human_wins";else{const f=R.bestHandCards.map(A=>A.value).sort((A,_)=>_-A),I=M.bestHandCards.map(A=>A.value).sort((A,_)=>_-A);let C=!0;for(let A=0;A<5;A++){if(f[A]>I[A]){B="ai_wins",C=!1;break}if(I[A]>f[A]){B="human_wins",C=!1;break}}C&&(B="split")}const q=l-t.currentBetInRound<=0,u=l-t.currentBetInRound;if(B==="ai_wins"){if(e.isAllIn)return{type:t.coins<=u?"allin":"call",amount:t.currentBetInRound+Math.min(t.coins,u)};if(q){if(i.length<4&&Math.random()<.3)return{type:"check"};let f=Math.min(t.coins,Math.max(o,Math.floor(d*(.6+Math.random()*.4))));return f=Math.max(f,o),t.coins===f?{type:"allin",amount:t.currentBetInRound+f}:{type:"bet",amount:t.currentBetInRound+f}}else{if(u<=d*.5&&i.length<4&&Math.random()<.4)return t.coins<=u?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"};let f=.6+Math.random()*.6,I=Math.max(s,Math.floor(d*f)),C=u+I,A=Math.min(t.coins,C),_=t.currentBetInRound+A;return t.coins===A?{type:"allin",amount:_}:{type:"raise",amount:_}}}else return B==="human_wins"?q?{type:"check"}:{type:"fold"}:q?{type:"check"}:e.isAllIn||u<=o/2?t.coins<=u?{type:"allin",amount:t.currentBetInRound+t.coins}:{type:"call"}:{type:"fold"}}function j(){if(!a||h!=="ai"||!p||!n){p||console.warn("triggerAIAction called but hand is not in progress.");return}if(r.textContent="AI가 생각 중...",b(),a.isFolded||a.isAllIn){a.hasActedThisRound=!0,de();return}setTimeout(()=>{let t;T==="impossible"?t=st(a,n,m,c,v,F,E):T==="marathon"?t=xt(D,a,n,m,c,v,F,E):(console.error("알 수 없는 AI 난이도:",T),t={type:"check"});let e=0,i="";switch(t.type){case"fold":a.isFolded=!0,a.lastAction="fold",i="AI 폴드",r.textContent="AI가 폴드했습니다.",J("ai",i),fe(n),he();return;case"check":c-a.currentBetInRound>0?(e=Math.min(a.coins,c-a.currentBetInRound),a.lastAction="call",i=`AI 콜: ${e}`,r.textContent=`AI가 (강제) ${e}을 콜했습니다.`):(a.lastAction="check",i="AI 체크",r.textContent="AI가 체크했습니다.");break;case"call":e=Math.min(a.coins,c-a.currentBetInRound),e<0&&(e=0),a.lastAction="call",i=`AI 콜: ${e}`,r.textContent=`AI가 ${e}을 콜했습니다.`;break;case"bet":e=Math.min(a.coins,(t.amount||0)-a.currentBetInRound),e<0&&(e=0),e<F&&e<a.coins&&(e=Math.min(a.coins,F)),a.lastAction="bet",c=a.currentBetInRound+e,v=c,L="ai",i=`AI 벳: ${e}`,r.textContent=`AI가 ${e}을 벳하여 총 ${c}(으)로 만들었습니다.`;break;case"raise":e=Math.min(a.coins,(t.amount||0)-a.currentBetInRound),e<0&&(e=0);const l=a.currentBetInRound+e;l<c+v&&e<a.coins?(e=Math.min(a.coins,c-a.currentBetInRound),e<0&&(e=0),a.lastAction="call",i=`AI 콜: ${e}`,r.textContent=`AI가 (잘못된 레이즈 시도 후) ${e}을 콜했습니다.`):(a.lastAction="raise",v=l-c,c=l,L="ai",i=`AI 레이즈: ${e}`,r.textContent=`AI가 ${e}을 레이즈하여 총 ${c}(으)로 만들었습니다.`);break;case"allin":e=a.coins;const s=a.currentBetInRound+e;s>c?(a.lastAction=c===0?"bet":"raise",v=s-c,c=s,L="ai",r.textContent=`AI가 올인 ${ne(a.lastAction)} (${e}) 하여 총 ${c}(으)로 만들었습니다!`):(a.lastAction="call",r.textContent=`AI가 올인 콜 (${e}) 했습니다.`),i=`AI 올인 (${e})`;break}a.coins-=e,E+=e,a.currentBetInRound+=e,a.coins===0&&(a.isAllIn=!0),a.hasActedThisRound=!0,J("ai",i),de()},1500)}function de(){if(!n||!a||!p)return;const t=n,e=a,i=(t.hasActedThisRound||t.isAllIn||t.isFolded)&&(e.hasActedThisRound||e.isAllIn||e.isFolded),l=t.currentBetInRound===e.currentBetInRound||t.isAllIn||e.isAllIn||t.isFolded||e.isFolded;if(t.isFolded||e.isFolded){if(!p)return;const o=t.isFolded?e:t;fe(o),he();return}let s=!1;if(i&&l)if(L){const o=L==="human"?e:t;(o.hasActedThisRound||o.isAllIn||o.isFolded)&&(s=!0)}else t.hasActedThisRound&&e.hasActedThisRound&&(s=!0);if(s){$t();return}if(h=h==="human"?"ai":"human",h==="human"){if(n.isFolded||n.isAllIn){h="ai",de();return}r.textContent=`당신의 턴입니다. (${k})`,b()}else{if(a.isFolded||a.isAllIn){h="human",de();return}b(),setTimeout(j,100)}}function $t(){if(!n||!a)return;if(n.currentBetInRound=0,a.currentBetInRound=0,n.hasActedThisRound=!1,a.hasActedThisRound=!1,c=0,v=y==="solo_ai"?F:Q,L=null,(n.isAllIn||a.isAllIn)&&!(n.isFolded||a.isFolded)&&(n.isAllIn&&a.currentBetInRound>=n.currentBetInRound||a.isAllIn&&n.currentBetInRound>=a.currentBetInRound||n.isAllIn&&a.isAllIn)){r.textContent="한 명 이상 올인 상태. 남은 커뮤니티 카드를 모두 공개합니다.";const e=5-m.length;if(e>0){for(let i=0;i<e;i++){w.length>0&&W(1);const l=W(1);if(l.length>0)m.push(...l);else break}oe()}k="showdown"}switch(k){case"preflop":k="flop",O("flop",2),r.textContent="플랍 카드 (2장)가 공개되었습니다.";break;case"flop":k="turn",O("turn",1),r.textContent="3번째 커뮤니티 카드가 공개되었습니다.";break;case"turn":k="river",O("river",1),r.textContent="4번째 커뮤니티 카드가 공개되었습니다.";break;case"river":k="fifth_street",O("fifth_street",1),r.textContent="5번째 커뮤니티 카드가 공개되었습니다.";break;case"fifth_street":k="showdown";break;default:if(k!=="showdown")return}if(oe(),k==="showdown")Qe();else if(p){if(P==="ai"?h=n.isFolded||n.isAllIn?"ai":"human":h=a.isFolded||a.isAllIn?"human":"ai",h==="human"&&(n.isFolded||n.isAllIn)&&(h="ai"),h==="ai"&&(a.isFolded||a.isAllIn)&&(h="human"),(n.isFolded||n.isAllIn)&&(a.isFolded||a.isAllIn)){Qe();return}h==="ai"?(r.textContent+=` AI의 턴입니다. (${k})`,setTimeout(j,1e3)):r.textContent+=` 당신의 턴입니다. (${k})`,b()}}function O(t,e){w.length>0&&W(1);const i=W(e);i.length>0?m.push(...i):console.warn(`덱에 카드가 부족하여 ${t}에 카드를 딜할 수 없습니다. (요청: ${e}, 딜됨: ${i.length})`),m.length>5&&(m=m.slice(0,5))}function Qe(){if((!n||!a||!p&&k!=="showdown")&&k==="hand_over")return;k="showdown",r.textContent="쇼다운!",p=!1,Fe(!0);const t=n.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:X(n.holeCards,m),e=a.isFolded?{name:"Folded",rankValue:-1,detailedName:"폴드"}:X(a.holeCards,m);let i=null,l="";if(n.isFolded)i=a,l=`당신 폴드. AI 승리 (${ee(e.name)}${e.detailedName&&e.name!==e.detailedName?" - "+e.detailedName:""}).`;else if(a.isFolded)i=n,l=`AI 폴드. 당신 승리 (${ee(t.name)}${t.detailedName&&t.name!==t.detailedName?" - "+t.detailedName:""}).`;else{const s=te(t,e);s===t&&t.rankValue>e.rankValue?i=n:s===e&&e.rankValue>t.rankValue?i=a:te(t,e)===t&&te(e,t)===e?i="split":te(t,e)===t?i=n:i=a,l=`당신: ${ee(t.name)}${t.detailedName&&t.name!==t.detailedName?" ("+t.detailedName+")":""}. AI: ${ee(e.name)}${e.detailedName&&e.name!==e.detailedName?" ("+e.detailedName+")":""}. `,i===n?l+="당신 승리!":i===a?l+="AI 승리!":l+="무승부 (팟 분배)!"}r.textContent=l,fe(i),he()}function fe(t){if(t==="split"&&n&&a){const e=Math.floor(E/2);n.coins+=e,a.coins+=E-e,r.textContent+=` 각각 ${e} 코인 획득.`}else t&&t!=="split"&&(t.coins+=E,r.textContent+=` ${t.name}이(가) 팟 ${E}을(를) 획득했습니다.`);E=0,y==="solo_ai"&&T==="marathon"&&a&&a.coins===0&&n&&n.coins>0&&(D++,D>10?r.textContent='축하합니다! 마라톤 모드 (레벨 10) 클리어! "새 게임 설정"으로 다시 시작하세요.':(r.textContent=`AI 파산! 마라톤 레벨 ${D}(으)로 진입합니다. AI 코인이 초기화됩니다.`,a.coins=Ue)),we()}function he(){p=!1,k="hand_over",h=null,n&&(n.lastAction="none"),a&&(a.lastAction="none"),b()}function lt(){y==="practice"&&(p=!0,w=Ze(),w=et(w),n&&(n.holeCards=W(2),n.currentBetInRound=0,n.isFolded=!1,n.lastAction="none"),m=[],E=0,r.textContent="연습 모드: 개인 카드 2장이 지급되었습니다.",b(),$.disabled=!0,$.style.display="none")}function Mt(){y!=="practice"||m.length!==0||(O("flop",2),r.textContent="플랍 카드 (2장)가 공개되었습니다.",b())}function Ft(){y!=="practice"||m.length!==2||(O("turn",1),r.textContent="3번째 커뮤니티 카드가 공개되었습니다.",b())}function wt(){y!=="practice"||m.length!==3||(O("river",1),r.textContent="4번째 커뮤니티 카드가 공개되었습니다.",b())}function Tt(){y!=="practice"||m.length!==4||(O("fifth_street",1),r.textContent="5번째 커뮤니티 카드가 공개되었습니다.",b())}function Lt(){if(y!=="practice"||!n||n.holeCards.length===0||m.length<5){r.textContent="아직 카드가 충분하지 않습니다. 딜을 완료해주세요.";return}const t=X(n.holeCards,m),e=ee(t.name);r.textContent=`최고의 패: ${e}${t.detailedName&&t.name!==t.detailedName?` (${t.detailedName})`:""}`,p=!1,b(),$.disabled=!1,$.style.display="inline-block"}function St(){Oe.innerHTML="",qe.forEach(t=>{const e=document.createElement("li"),i=document.createElement("strong");i.textContent=`${t.kor} (${t.eng})`,e.appendChild(i);const l=document.createElement("div");l.classList.add("ranking-details-wrapper");const s=document.createElement("div");s.classList.add("ranking-example-cards"),t.exampleCards.forEach((d,S)=>{const x=t.highlightIndices?t.highlightIndices.includes(S):!1;s.appendChild(ce(d,!0,x))}),l.appendChild(s);const o=document.createElement("p");o.classList.add("ranking-description"),o.textContent=t.desc,l.appendChild(o),e.appendChild(l),Oe.appendChild(e)})}function Nt(){St(),ue.style.display="block",ze.focus()}function ot(){ue.style.display="none",je.focus()}function Dt(){nt(!0),$e.style.display="block",ve.checked=!0,Re.style.display="none",Xe.value="1000",Ye.value="marathon",ve.focus()}function Te(){$e.style.display="none",$.focus()}function rt(){Me.checked?Re.style.display="block":Re.style.display="none"}function Ht(){const t=Me.checked?"solo_ai":"practice";let e=0;if(t==="solo_ai"){if(e=parseInt(Xe.value,10),isNaN(e)){alert("유효한 코인 금액을 선택해주세요.");return}Ue=e,T=Ye.value,T==="marathon"&&(D=1),P="ai",F=Math.max(10,Math.floor(e/100)),le=Math.max(5,Math.floor(F/2))}else le=Ee,F=Q;y=t,n={name:"나",holeCards:[],coins:t==="solo_ai"?e:0,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"human",hasActedThisRound:!1},t==="solo_ai"?a={name:"AI 상대",holeCards:[],coins:e,isFolded:!1,currentBetInRound:0,isAllIn:!1,lastAction:"none",seat:"ai",hasActedThisRound:!1}:a=null,We.style.display="flex",Te(),t==="solo_ai"?at():lt(),$.disabled=!0,$.style.display="none"}$.addEventListener("click",Dt);pt.addEventListener("click",Te);ve.addEventListener("change",rt);Me.addEventListener("change",rt);It.addEventListener("click",Ht);pe.addEventListener("click",lt);Ie.addEventListener("click",Mt);ye.addEventListener("click",Ft);ge.addEventListener("click",wt);Ae.addEventListener("click",Tt);ke.addEventListener("click",Lt);Ce.addEventListener("click",Ct);Be.addEventListener("click",Bt);z.addEventListener("click",bt);V.addEventListener("click",Rt);be.addEventListener("click",vt);U.addEventListener("click",at);G.addEventListener("input",it);je.addEventListener("click",Nt);ze.addEventListener("click",ot);window.addEventListener("keydown",t=>{t.key==="Escape"&&(ue.style.display==="block"&&ot(),$e.style.display==="block"&&Te())});document.addEventListener("DOMContentLoaded",()=>{nt(!0),xe(),b(),r.textContent='환영합니다! "새 게임 설정" 버튼을 눌러 게임을 시작하세요.'});
